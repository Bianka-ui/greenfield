'use strict';(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,
name))Object.defineProperty(exports,name,{enumerable:true,get:getter})};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag)Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);
Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,
property)};__webpack_require__.p="/";return __webpack_require__(__webpack_require__.s=0)})([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _BrowserSession__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var _BrowserCompositor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6);var _lib_libpixman_1__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(17);var _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_3__=
__webpack_require__(43);var _BrowserRtcPeerConnectionFactory__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(44);var _BrowserRtcBufferFactory__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(36);var _BrowserShell__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(48);var _BrowserSeat__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(51);var _BrowserDataDeviceManager__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(58);var _BrowserOutput__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(60);var _BrowserSubcompositor__WEBPACK_IMPORTED_MODULE_10__=
__webpack_require__(61);var _style_greenfield_css__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(63);var _style_greenfield_css__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_style_greenfield_css__WEBPACK_IMPORTED_MODULE_11__);var _BrowserXdgWmBase__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(68);var _desktopshell_DesktopUserShell__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(74);function setupGlobals(browserSession){const browserOutput=_BrowserOutput__WEBPACK_IMPORTED_MODULE_9__["default"].create();
const browserSeat=_BrowserSeat__WEBPACK_IMPORTED_MODULE_7__["default"].create(browserSession);const browserCompositor=_BrowserCompositor__WEBPACK_IMPORTED_MODULE_1__["default"].create(browserSession,browserSeat);const browserDataDeviceManager=_BrowserDataDeviceManager__WEBPACK_IMPORTED_MODULE_8__["default"].create();const browserSubcompositor=_BrowserSubcompositor__WEBPACK_IMPORTED_MODULE_10__["default"].create();const browserRtcPeerConnectionFactory=_BrowserRtcPeerConnectionFactory__WEBPACK_IMPORTED_MODULE_4__["default"].create();
const browserRtcBufferFactory=_BrowserRtcBufferFactory__WEBPACK_IMPORTED_MODULE_5__["default"].create();const desktopUserShell=_desktopshell_DesktopUserShell__WEBPACK_IMPORTED_MODULE_13__["default"].create(browserSession,browserSeat);const browserShell=_BrowserShell__WEBPACK_IMPORTED_MODULE_6__["default"].create(browserSession,desktopUserShell);const browserXdgWmBase=_BrowserXdgWmBase__WEBPACK_IMPORTED_MODULE_12__["default"].create(browserSession,desktopUserShell,browserSeat);browserSession.wfsServer.registry.register(browserOutput);
browserSession.wfsServer.registry.register(browserCompositor);browserSession.wfsServer.registry.register(browserDataDeviceManager);browserSession.wfsServer.registry.register(browserSeat);browserSession.wfsServer.registry.register(browserShell);browserSession.wfsServer.registry.register(browserSubcompositor);browserSession.wfsServer.registry.register(browserRtcPeerConnectionFactory);browserSession.wfsServer.registry.register(browserRtcBufferFactory);browserSession.wfsServer.registry.register(browserXdgWmBase)}
async function main(){const sessionId=uuidv4();const browserSession=await _BrowserSession__WEBPACK_IMPORTED_MODULE_0__["default"].create(sessionId);setupGlobals(browserSession)}function loadNativeModule(module){return new Promise((resolve)=>{if(module.calledRun)resolve();else module.onRuntimeInitialized=()=>{resolve()}})}function uuidv4(){return([1E7]+-1E3+-4E3+-8E3+-1E11).replace(/[018]/g,(c)=>(c^window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16))}window.onload=async()=>{await loadNativeModule(_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_2__["default"]);
await loadNativeModule(_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_3__["default"]);await main()};(function(){const timeouts=[];const messageName="zero-timeout-message";function setZeroTimeout(fn){timeouts.push(fn);window.postMessage(messageName,"*")}function handleMessage(event){if(event.source===window&&event.data===messageName){event.stopPropagation();if(timeouts.length>0){const fn=timeouts.shift();fn()}}}window.addEventListener("message",handleMessage,true);window.setZeroTimeout=setZeroTimeout})()},
function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserSession});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_session_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4);
var _protocol_session_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_session_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _BrowserClientSession__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5);class BrowserSession extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static async create(sessionId){false&&console.log("Starting new browser session.");const wfsServer=new westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Server"];
const websocketProtocol=window.location.protocol==="https:"?"wss":"ws";const url=`${websocketProtocol}://${window.location.host}/${sessionId}`;const browserSession=new BrowserSession(url,wfsServer,sessionId);await browserSession._createConnection(url);wfsServer.registry.register(browserSession);return browserSession}constructor(url,wfsServer,sessionId){super(_protocol_session_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default.a.GrSession.name,1);this.url=url;this.wfsServer=wfsServer;this.sessionId=
sessionId;this._clients={};this._nextClientSessionId=1;this._ws=null;this._flushScheduled=false;this.resources=[]}_createConnection(url){return new Promise((resolve,reject)=>{const ws=new window.WebSocket(url);ws.binaryType="arraybuffer";ws.onerror=(event)=>{console.error(`Session web socket is in error.`);if(ws.readyState===window.WebSocket.CONNECTING)reject(event)};ws.onopen=()=>{try{false&&console.log("Session web socket is open.");this._ws=ws;this._setupWebsocket();this._primaryConnection=this._setupPrimaryConnection();
resolve()}catch(error){reject(error)}}})}bindClient(client,id,version){const grSessionResource=new _protocol_session_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default.a.GrSession(client,id,version);grSessionResource.implementation=this;this.resources.push(grSessionResource)}_setupWebsocket(){this._ws.onmessage=(event)=>{try{const buf=event.data;const sessionId=(new DataView(buf)).getUint32(0,true);const arrayBuffer=buf.slice(4,buf.byteLength);this._clients[sessionId].message(arrayBuffer);this.flush()}catch(error){console.error(`Session web socket failed to handle incoming message. \n${error.stack}`);
this._ws.close(4007,"Session web socket received an illegal message")}};this._ws.onclose=(event)=>{false&&console.log(`Web socket closed. ${event.code}:${event.reason}`)};window.onbeforeunload=(e)=>{const dialogText="dummytext";e.returnValue=dialogText;return dialogText}}_setupPrimaryConnection(){return this._setupConnection(0)}_setupConnection(clientSessionId){const client=this.wfsServer.createClient();this._clients[clientSessionId]=client;this._setupClientConnection(client,clientSessionId);return client}_setupClientConnection(client,
clientSessionId){client.onSend=(arrayBuffer)=>{try{const b=new Uint8Array(arrayBuffer.byteLength+4);(new window.DataView(b.buffer)).setUint32(0,clientSessionId,true);b.set(new Uint8Array(arrayBuffer),4);this._ws.send(b.buffer)}catch(error){console.error(error.stack);this._ws.close(4002,"Session web socket is in error.")}}}client(resource,id){false&&console.log("New client connected.");const clientSessionId=this._nextClientSessionId++;const clientConnection=this._setupConnection(clientSessionId);const grClientSessionResource=
new _protocol_session_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default.a.GrClientSession(resource.client,id,resource.version);grClientSessionResource.implementation=_BrowserClientSession__WEBPACK_IMPORTED_MODULE_2__["default"].create(clientConnection);grClientSessionResource.session(clientSessionId)}flush(){if(this._flushScheduled)return;this._flushScheduled=true;window.setZeroTimeout(()=>{this._flushScheduled=false;this.resources.forEach((resource)=>resource.flush())})}}},function(module,exports,
__webpack_require__){const wfs={};wfs.Fixed=class{asInt(){return this._raw/256>>0}asDouble(){return this._raw/256}constructor(raw){this._raw=raw}};wfs.parseFixed=function(number){return new wfs.Fixed(number*256>>0)};wfs._uint=function(arg){return{value:arg,type:"u",size:4,optional:false,_marshallArg:function(wireMsg){(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0]=this.value;wireMsg.readIndex+=this.size}}};wfs._uintOptional=function(arg){return{value:arg,type:"u",size:4,optional:true,_marshallArg:function(wireMsg){(new Uint32Array(wireMsg,
wireMsg.readIndex,1))[0]=arg===null?0:this.value;wireMsg.readIndex+=this.size}}};wfs._int=function(arg){return{value:arg,type:"i",size:4,optional:false,_marshallArg:function(wireMsg){(new Int32Array(wireMsg,wireMsg.readIndex,1))[0]=this.value;wireMsg.readIndex+=this.size}}};wfs._intOptional=function(arg){return{value:arg,type:"i",size:4,optional:true,_marshallArg:function(wireMsg){(new Int32Array(wireMsg,wireMsg.readIndex,1))[0]=arg===null?0:this.value;wireMsg.readIndex+=this.size}}};wfs._fixed=function(arg){return{value:arg,
type:"f",size:4,optional:false,_marshallArg:function(wireMsg){(new Int32Array(wireMsg,wireMsg.readIndex,1))[0]=this.value._raw;wireMsg.readIndex+=this.size}}};wfs._fixedOptional=function(arg){return{value:arg,type:"f",size:4,optional:true,_marshallArg:function(wireMsg){(new Int32Array(wireMsg,wireMsg.readIndex,1))[0]=arg===null?0:this.value._raw;wireMsg.readIndex+=this.size}}};wfs._object=function(arg){return{value:arg,type:"o",size:4,optional:false,_marshallArg:function(wireMsg){(new Uint32Array(wireMsg,
wireMsg.readIndex,1))[0]=this.value.id;wireMsg.readIndex+=this.size}}};wfs._objectOptional=function(arg){return{value:arg,type:"o",size:4,optional:true,_marshallArg:function(wireMsg){(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0]=arg===null?0:this.value.id;wireMsg.readIndex+=this.size}}};wfs._newObject=function(){return{value:null,type:"n",size:4,optional:false,_marshallArg:function(wireMsg){(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0]=this.value;wireMsg.readIndex+=this.size}}};wfs._string=
function(arg){return{value:arg,type:"s",size:4+function(){return arg.length+3&~3}(),optional:false,_marshallArg:function(wireMsg){(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0]=this.value.length;const strLen=this.value.length;const buf8=new Uint8Array(wireMsg,wireMsg.readIndex+4,strLen);for(let i=0;i<strLen;i++)buf8[i]=this.value[i].codePointAt(0);wireMsg.readIndex+=this.size}}};wfs._stringOptional=function(arg){return{value:arg,type:"s",size:4+function(){if(arg===null)return 0;else return arg.length+
3&~3}(),optional:true,_marshallArg:function(wireMsg){if(this.value===null)(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0]=0;else{(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0]=this.value.length;const strLen=this.value.length;const buf8=new Uint8Array(wireMsg,wireMsg.readIndex+4,strLen);for(let i=0;i<strLen;i++)buf8[i]=this.value[i].codePointAt(0)}wireMsg.readIndex+=this.size}}};wfs._array=function(arg){return{value:arg,type:"a",size:4+function(){return arg.byteLength+3&~3}(),optional:false,_marshallArg:function(wireMsg){(new Uint32Array(wireMsg,
wireMsg.readIndex,1))[0]=this.value.byteLength;const byteLength=this.value.byteLength;(new Uint8Array(wireMsg,wireMsg.readIndex+4,byteLength)).set(new Uint8Array(this.value.buffer,0,byteLength));wireMsg.readIndex+=this.size}}};wfs._arrayOptional=function(arg){return{value:arg,type:"a",size:4+function(){if(arg===null)return 0;else return arg.byteLength+3&~3}(),optional:true,_marshallArg:function(wireMsg){if(this.value===null)(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0]=0;else{(new Uint32Array(wireMsg,
wireMsg.readIndex,1))[0]=this.value.byteLength;const byteLength=this.value.byteLength;(new Uint8Array(wireMsg,wireMsg.readIndex+4,byteLength)).set(new Uint8Array(this.value.buffer,0,byteLength))}wireMsg.readIndex+=this.size}}};wfs.Global=class{constructor(interfaceName,version){this.interfaceName=interfaceName;this.version=version}bindClient(client,id,version){}};wfs.Resource=class{constructor(client,id,version,implementation){this.client=client;this.id=id;this.version=version;this.userData={};this.implementation=
implementation;this._destroyPromise=new Promise((resolve)=>{this._destroyResolver=resolve});this._destroyListeners=[];this._destroyPromise.then(()=>{this._destroyListeners.forEach((destroyListener)=>destroyListener(this))});this.client._registerResource(this)}destroy(){this._destroyResolver(this);this.client._unregisterResource(this)}addDestroyListener(destroyListener){this._destroyListeners.push(destroyListener)}removeDestroyListener(destroyListener){this._destroyListeners=this._destroyListeners.filter((item)=>
{return item!==destroyListener})}onDestroy(){return this._destroyPromise}};wfs.RegistryResource=class extends wfs.Resource{constructor(client,id,version){super(client,id,version,{})}global(name,interface_,version){this.client._marshall(this.id,1,[wfs._uint(name),wfs._string(interface_),wfs._uint(version)])}globalRemove(name){this.client._marshall(this.id,2,[wfs._uint(name)])}[1](message){const args=this.client._unmarshallArgs(message,"uuu");this.implementation._globals.get(args[0]).bindClient(this.client,
args[1],args[2])}};wfs.Registry=class{constructor(){this._registryResources=[];this._globals=new Map;this._nextGlobalName=0}register(global){if(!("_name"in global))global._name=++this._nextGlobalName;this._globals.set(global._name,global);this._registryResources.forEach((registryResource)=>registryResource.global(global._name,global.interfaceName,global.version))}unregister(global){if(this._globals.remove(global._name)!==false)this._registryResources.forEach((registryResource)=>registryResource.globalRemove(global._name))}_publishGlobals(registryResource){this._globals.forEach((global,
name)=>registryResource.global(name,global.interfaceName,global.version))}_createResource(client,id){const registryResource=new wfs.RegistryResource(client,id,1);registryResource.implementation=this;this._registryResources.push(registryResource);return registryResource}};wfs.ClientResource=class extends wfs.Resource{constructor(client,id,version){super(client,id,version,{create_registry(resource,id){}})}[1](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.create_registry.call(this.implementation,
this,args[0])}};wfs.Client=class{["u"](wireMsg){const arg=(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0];wireMsg.readIndex+=4;return arg}["i"](wireMsg){const arg=(new Int32Array(wireMsg,wireMsg.readIndex,1))[0];wireMsg.readIndex+=4;return arg}["f"](wireMsg){const arg=(new Int32Array(wireMsg,wireMsg.readIndex,1))[0];wireMsg.readIndex+=4;return new wfs.Fixed(arg>>0)}["o"](wireMsg,optional){const arg=(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0];wireMsg.readIndex+=4;if(optional&&arg===0)return null;
else return this._objects.get(arg)}["n"](wireMsg){const arg=(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0];wireMsg.readIndex+=4;return arg}["s"](wireMsg,optional){const stringSize=(new Uint32Array(wireMsg,wireMsg.readIndex,1))[0];wireMsg.readIndex+=4;if(optional&&stringSize===0)return null;else{const byteArray=new Uint8Array(wireMsg,wireMsg.readIndex,stringSize);wireMsg.readIndex+=stringSize+3&~3;return String.fromCharCode.apply(null,byteArray)}}["a"](wireMsg,optional){const arraySize=(new Uint32Array(wireMsg,
wireMsg.readIndex,1))[0];wireMsg.readIndex+=4;if(optional&&arraySize===0)return null;else{const arg=wireMsg.slice(wireMsg.readIndex,wireMsg.readIndex+arraySize);wireMsg.readIndex+=arraySize+3&~3;return arg}}_unmarshallArgs(message,argsSignature){const argsSigLength=argsSignature.length;const args=[];let optional=false;for(let i=0;i<argsSigLength;i++){let signature=argsSignature[i];optional=signature==="?";if(optional)signature=argsSignature[++i];args.push(this[signature](message,optional))}return args}_unmarshall(buffer){const bufu32=
new Uint32Array(buffer);const bufu16=new Uint16Array(buffer);const id=bufu32[0];const opcode=bufu16[3];buffer.readIndex=8;const obj=this._objects.get(id);if(obj)obj[opcode](buffer);else{console.error(`Object with id=${id} does not exist (opcode=${opcode}). Disconnecting client.`);this.close()}}onSend(wireMsg){}message(buffer){this._unmarshall(buffer)}close(){const index=this._server.clients.indexOf(this);if(index>-1){this._destroyedResolver(this);this._objects.forEach((object)=>{object.destroy()});
this._objects.clear();this._server.clients.splice(this._server.clients.indexOf(this),1);this._server=null}}onClose(){return this._destroyPromise}_registerResource(resource){this._objects.set(resource.id,resource)}_unregisterResource(resource){this._objects.delete(resource.id)}__marshallMsg(id,opcode,size,argsArray){const wireMsg=new ArrayBuffer(size);const bufu32=new Uint32Array(wireMsg);const bufu16=new Uint16Array(wireMsg);bufu32[0]=id;bufu16[2]=size;bufu16[3]=opcode;wireMsg.readIndex=8;argsArray.forEach(function(arg){arg._marshallArg(wireMsg)});
this.onSend(wireMsg)}_marshallConstructor(id,opcode,itfName,argsArray){const objectId=this._server.nextId;this._server.nextId++;let size=4+2+2;argsArray.forEach(function(arg){if(arg.type==="n")arg.value=objectId;size+=arg.size});this.__marshallMsg(id,opcode,size,argsArray);return objectId}_marshall(id,opcode,argsArray){let size=4+2+2;argsArray.forEach(function(arg){size+=arg.size});this.__marshallMsg(id,opcode,size,argsArray)}constructor(server){this._objects=new Map;this._server=server;this._destroyPromise=
new Promise((resolve)=>{this._destroyedResolver=resolve});const clientResource=new wfs.ClientResource(this,1,1);clientResource.implementation.create_registry=(resource,id)=>{this._server.registry._publishGlobals(this._server.registry._createResource(this,id))}}};wfs.Server=class{constructor(){this._destroyListeners=[];this.registry=new wfs.Registry;this.clients=[];this.nextId=4278190080}getNextId(){return++this.nextId}createClient(){const client=new wfs.Client(this);this.clients.push(client);return client}};
module.exports=wfs},function(module,exports,__webpack_require__){const wfs=__webpack_require__(3);wfs.GrClientSession=class GrClientSession extends wfs.Resource{session(sessionId){this.client._marshall(this.id,1,[wfs._uint(sessionId)])}constructor(client,id,version){super(client,id,version,{destroy(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}};wfs.GrSession=class GrSession extends wfs.Resource{flush(){this.client._marshall(this.id,
1,[])}constructor(client,id,version){super(client,id,version,{client(resource,id){}})}[1](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.client.call(this.implementation,this,args[0])}};module.exports=wfs},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserClientSession});class BrowserClientSession{static create(clientConnection){return new BrowserClientSession(clientConnection)}constructor(clientConnection){this._clientConnection=
clientConnection}destroy(resource){this._clientConnection.close();resource.destroy()}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserCompositor});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);
var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _BrowserSurface__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8);var _BrowserRegion__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(16);var _render_Renderer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(18);class BrowserCompositor extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(browserSession,
browserSeat){const glCanvasRenderer=_render_Renderer__WEBPACK_IMPORTED_MODULE_4__["default"].create(browserSession);return new BrowserCompositor(browserSession,glCanvasRenderer,browserSeat)}constructor(browserSession,renderer,browserSeat){super(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrCompositor"].name,4);this._browserSession=browserSession;this._renderer=renderer;this._browserSeat=browserSeat}bindClient(client,id,version){const grCompositorResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrCompositor"](client,
id,version);grCompositorResource.implementation=this}createSurface(resource,id){const grSurfaceResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrSurface"](resource.client,id,resource.version);_BrowserSurface__WEBPACK_IMPORTED_MODULE_2__["default"].create(grSurfaceResource,this._renderer,this._browserSeat,this._browserSession)}createRegion(resource,id){const grRegionResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrRegion"](resource.client,
id,resource.version);_BrowserRegion__WEBPACK_IMPORTED_MODULE_3__["default"].create(grRegionResource)}}},function(module,exports,__webpack_require__){const wfs=__webpack_require__(3);wfs.GrBlobTransfer=class GrBlobTransfer extends wfs.Resource{release(){this.client._marshall(this.id,1,[])}constructor(client,id,version){super(client,id,version,{close(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.close.call(this.implementation,this)}};wfs.GrCallback=
class GrCallback extends wfs.Resource{done(callbackData){this.client._marshall(this.id,1,[wfs._uint(callbackData)])}constructor(client,id,version){super(client,id,version,{})}};wfs.GrCompositor=class GrCompositor extends wfs.Resource{constructor(client,id,version){super(client,id,version,{createSurface(resource,id){},createRegion(resource,id){}})}[1](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.createSurface.call(this.implementation,this,args[0])}[2](message){const args=
this.client._unmarshallArgs(message,"n");this.implementation.createRegion.call(this.implementation,this,args[0])}};wfs.GrBuffer=class GrBuffer extends wfs.Resource{release(){this.client._marshall(this.id,1,[])}constructor(client,id,version){super(client,id,version,{destroy(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}};wfs.GrDataOffer=class GrDataOffer extends wfs.Resource{offer(mimeType){this.client._marshall(this.id,
1,[wfs._string(mimeType)])}sourceActions(sourceActions){this.client._marshall(this.id,2,[wfs._uint(sourceActions)])}action(dndAction){this.client._marshall(this.id,3,[wfs._uint(dndAction)])}constructor(client,id,version){super(client,id,version,{accept(resource,serial,mimeType){},receive(resource,mimeType,fd){},destroy(resource){},finish(resource){},setActions(resource,dndActions,preferredAction){}})}[1](message){const args=this.client._unmarshallArgs(message,"u?s");this.implementation.accept.call(this.implementation,
this,args[0],args[1])}[2](message){const args=this.client._unmarshallArgs(message,"su");this.implementation.receive.call(this.implementation,this,args[0],args[1])}[3](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[4](message){const args=this.client._unmarshallArgs(message,"");this.implementation.finish.call(this.implementation,this)}[5](message){const args=this.client._unmarshallArgs(message,"uu");this.implementation.setActions.call(this.implementation,
this,args[0],args[1])}};wfs.GrDataOffer.Error={invalidFinish:0,invalidActionMask:1,invalidAction:2,invalidOffer:3};wfs.GrDataSource=class GrDataSource extends wfs.Resource{target(mimeType){this.client._marshall(this.id,1,[wfs._stringOptional(mimeType)])}send(mimeType,fd){this.client._marshall(this.id,2,[wfs._string(mimeType),wfs._uint(fd)])}cancelled(){this.client._marshall(this.id,3,[])}dndDropPerformed(){this.client._marshall(this.id,4,[])}dndFinished(){this.client._marshall(this.id,5,[])}action(dndAction){this.client._marshall(this.id,
6,[wfs._uint(dndAction)])}constructor(client,id,version){super(client,id,version,{offer(resource,mimeType){},destroy(resource){},setActions(resource,dndActions){}})}[1](message){const args=this.client._unmarshallArgs(message,"s");this.implementation.offer.call(this.implementation,this,args[0])}[2](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[3](message){const args=this.client._unmarshallArgs(message,"u");this.implementation.setActions.call(this.implementation,
this,args[0])}};wfs.GrDataSource.Error={invalidActionMask:0,invalidSource:1};wfs.GrDataDevice=class GrDataDevice extends wfs.Resource{dataOffer(){return this.client._marshallConstructor(this.id,1,"GrDataOffer",[wfs._newObject()])}enter(serial,surface,x,y,id){this.client._marshall(this.id,2,[wfs._uint(serial),wfs._object(surface),wfs._fixed(x),wfs._fixed(y),wfs._objectOptional(id)])}leave(){this.client._marshall(this.id,3,[])}motion(time,x,y){this.client._marshall(this.id,4,[wfs._uint(time),wfs._fixed(x),
wfs._fixed(y)])}drop(){this.client._marshall(this.id,5,[])}selection(id){this.client._marshall(this.id,6,[wfs._objectOptional(id)])}constructor(client,id,version){super(client,id,version,{startDrag(resource,source,origin,icon,serial){},setSelection(resource,source,serial){},release(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"?oo?ou");this.implementation.startDrag.call(this.implementation,this,args[0],args[1],args[2],args[3])}[2](message){const args=this.client._unmarshallArgs(message,
"?ou");this.implementation.setSelection.call(this.implementation,this,args[0],args[1])}[3](message){const args=this.client._unmarshallArgs(message,"");this.implementation.release.call(this.implementation,this)}};wfs.GrDataDevice.Error={role:0};wfs.GrDataDeviceManager=class GrDataDeviceManager extends wfs.Resource{constructor(client,id,version){super(client,id,version,{createDataSource(resource,id){},getDataDevice(resource,id,seat){}})}[1](message){const args=this.client._unmarshallArgs(message,"n");
this.implementation.createDataSource.call(this.implementation,this,args[0])}[2](message){const args=this.client._unmarshallArgs(message,"no");this.implementation.getDataDevice.call(this.implementation,this,args[0],args[1])}};wfs.GrDataDeviceManager.DndAction={none:0,copy:1,move:2,ask:4};wfs.GrShell=class GrShell extends wfs.Resource{constructor(client,id,version){super(client,id,version,{getShellSurface(resource,id,surface){}})}[1](message){const args=this.client._unmarshallArgs(message,"no");this.implementation.getShellSurface.call(this.implementation,
this,args[0],args[1])}};wfs.GrShell.Error={role:0};wfs.GrShellSurface=class GrShellSurface extends wfs.Resource{ping(serial){this.client._marshall(this.id,1,[wfs._uint(serial)])}configure(edges,width,height){this.client._marshall(this.id,2,[wfs._uint(edges),wfs._int(width),wfs._int(height)])}popupDone(){this.client._marshall(this.id,3,[])}constructor(client,id,version){super(client,id,version,{pong(resource,serial){},move(resource,seat,serial){},resize(resource,seat,serial,edges){},setToplevel(resource){},
setTransient(resource,parent,x,y,flags){},setFullscreen(resource,method,framerate,output){},setPopup(resource,seat,serial,parent,x,y,flags){},setMaximized(resource,output){},setTitle(resource,title){},setClass(resource,clazz){}})}[1](message){const args=this.client._unmarshallArgs(message,"u");this.implementation.pong.call(this.implementation,this,args[0])}[2](message){const args=this.client._unmarshallArgs(message,"ou");this.implementation.move.call(this.implementation,this,args[0],args[1])}[3](message){const args=
this.client._unmarshallArgs(message,"ouu");this.implementation.resize.call(this.implementation,this,args[0],args[1],args[2])}[4](message){const args=this.client._unmarshallArgs(message,"");this.implementation.setToplevel.call(this.implementation,this)}[5](message){const args=this.client._unmarshallArgs(message,"oiiu");this.implementation.setTransient.call(this.implementation,this,args[0],args[1],args[2],args[3])}[6](message){const args=this.client._unmarshallArgs(message,"uu?o");this.implementation.setFullscreen.call(this.implementation,
this,args[0],args[1],args[2])}[7](message){const args=this.client._unmarshallArgs(message,"ouoiiu");this.implementation.setPopup.call(this.implementation,this,args[0],args[1],args[2],args[3],args[4],args[5])}[8](message){const args=this.client._unmarshallArgs(message,"?o");this.implementation.setMaximized.call(this.implementation,this,args[0])}[9](message){const args=this.client._unmarshallArgs(message,"s");this.implementation.setTitle.call(this.implementation,this,args[0])}[10](message){const args=
this.client._unmarshallArgs(message,"s");this.implementation.setClass.call(this.implementation,this,args[0])}};wfs.GrShellSurface.Resize={none:0,top:1,bottom:2,left:4,topLeft:5,bottomLeft:6,right:8,topRight:9,bottomRight:10};wfs.GrShellSurface.Transient={inactive:1};wfs.GrShellSurface.FullscreenMethod={default:0,scale:1,driver:2,fill:3};wfs.GrSurface=class GrSurface extends wfs.Resource{enter(output){this.client._marshall(this.id,1,[wfs._object(output)])}leave(output){this.client._marshall(this.id,
2,[wfs._object(output)])}constructor(client,id,version){super(client,id,version,{destroy(resource){},attach(resource,buffer,x,y){},damage(resource,x,y,width,height){},frame(resource,callback){},setOpaqueRegion(resource,region){},setInputRegion(resource,region){},commit(resource){},setBufferTransform(resource,transform){},setBufferScale(resource,scale){},damageBuffer(resource,x,y,width,height){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,
this)}[2](message){const args=this.client._unmarshallArgs(message,"?oii");this.implementation.attach.call(this.implementation,this,args[0],args[1],args[2])}[3](message){const args=this.client._unmarshallArgs(message,"iiii");this.implementation.damage.call(this.implementation,this,args[0],args[1],args[2],args[3])}[4](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.frame.call(this.implementation,this,args[0])}[5](message){const args=this.client._unmarshallArgs(message,
"?o");this.implementation.setOpaqueRegion.call(this.implementation,this,args[0])}[6](message){const args=this.client._unmarshallArgs(message,"?o");this.implementation.setInputRegion.call(this.implementation,this,args[0])}[7](message){const args=this.client._unmarshallArgs(message,"");this.implementation.commit.call(this.implementation,this)}[8](message){const args=this.client._unmarshallArgs(message,"i");this.implementation.setBufferTransform.call(this.implementation,this,args[0])}[9](message){const args=
this.client._unmarshallArgs(message,"i");this.implementation.setBufferScale.call(this.implementation,this,args[0])}[10](message){const args=this.client._unmarshallArgs(message,"iiii");this.implementation.damageBuffer.call(this.implementation,this,args[0],args[1],args[2],args[3])}};wfs.GrSurface.Error={invalidScale:0,invalidTransform:1};wfs.GrSeat=class GrSeat extends wfs.Resource{capabilities(capabilities){this.client._marshall(this.id,1,[wfs._uint(capabilities)])}name(name){this.client._marshall(this.id,
2,[wfs._string(name)])}constructor(client,id,version){super(client,id,version,{getPointer(resource,id){},getKeyboard(resource,id){},getTouch(resource,id){},release(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.getPointer.call(this.implementation,this,args[0])}[2](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.getKeyboard.call(this.implementation,this,args[0])}[3](message){const args=this.client._unmarshallArgs(message,
"n");this.implementation.getTouch.call(this.implementation,this,args[0])}[4](message){const args=this.client._unmarshallArgs(message,"");this.implementation.release.call(this.implementation,this)}};wfs.GrSeat.Capability={pointer:1,keyboard:2,touch:4};wfs.GrPointer=class GrPointer extends wfs.Resource{enter(serial,surface,surfaceX,surfaceY){this.client._marshall(this.id,1,[wfs._uint(serial),wfs._object(surface),wfs._fixed(surfaceX),wfs._fixed(surfaceY)])}leave(serial,surface){this.client._marshall(this.id,
2,[wfs._uint(serial),wfs._object(surface)])}motion(time,surfaceX,surfaceY){this.client._marshall(this.id,3,[wfs._uint(time),wfs._fixed(surfaceX),wfs._fixed(surfaceY)])}button(serial,time,button,state){this.client._marshall(this.id,4,[wfs._uint(serial),wfs._uint(time),wfs._uint(button),wfs._uint(state)])}axis(time,axis,value){this.client._marshall(this.id,5,[wfs._uint(time),wfs._uint(axis),wfs._fixed(value)])}frame(){this.client._marshall(this.id,6,[])}axisSource(axisSource){this.client._marshall(this.id,
7,[wfs._uint(axisSource)])}axisStop(time,axis){this.client._marshall(this.id,8,[wfs._uint(time),wfs._uint(axis)])}axisDiscrete(axis,discrete){this.client._marshall(this.id,9,[wfs._uint(axis),wfs._int(discrete)])}constructor(client,id,version){super(client,id,version,{setCursor(resource,serial,surface,hotspotX,hotspotY){},release(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"u?oii");this.implementation.setCursor.call(this.implementation,this,args[0],args[1],args[2],args[3])}[2](message){const args=
this.client._unmarshallArgs(message,"");this.implementation.release.call(this.implementation,this)}};wfs.GrPointer.Error={role:0};wfs.GrPointer.ButtonState={released:0,pressed:1};wfs.GrPointer.Axis={verticalScroll:0,horizontalScroll:1};wfs.GrPointer.AxisSource={wheel:0,finger:1,continuous:2,wheelTilt:3};wfs.GrKeyboard=class GrKeyboard extends wfs.Resource{keymap(format,transfer,size){this.client._marshall(this.id,1,[wfs._uint(format),wfs._string(transfer),wfs._uint(size)])}enter(serial,surface,keys){this.client._marshall(this.id,
2,[wfs._uint(serial),wfs._object(surface),wfs._array(keys)])}leave(serial,surface){this.client._marshall(this.id,3,[wfs._uint(serial),wfs._object(surface)])}key(serial,time,key,state){this.client._marshall(this.id,4,[wfs._uint(serial),wfs._uint(time),wfs._uint(key),wfs._uint(state)])}modifiers(serial,modsDepressed,modsLatched,modsLocked,group){this.client._marshall(this.id,5,[wfs._uint(serial),wfs._uint(modsDepressed),wfs._uint(modsLatched),wfs._uint(modsLocked),wfs._uint(group)])}repeatInfo(rate,
delay){this.client._marshall(this.id,6,[wfs._int(rate),wfs._int(delay)])}constructor(client,id,version){super(client,id,version,{release(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.release.call(this.implementation,this)}};wfs.GrKeyboard.KeymapFormat={noKeymap:0,xkbV1:1};wfs.GrKeyboard.KeyState={released:0,pressed:1};wfs.GrTouch=class GrTouch extends wfs.Resource{down(serial,time,surface,id,x,y){this.client._marshall(this.id,1,[wfs._uint(serial),
wfs._uint(time),wfs._object(surface),wfs._int(id),wfs._fixed(x),wfs._fixed(y)])}up(serial,time,id){this.client._marshall(this.id,2,[wfs._uint(serial),wfs._uint(time),wfs._int(id)])}motion(time,id,x,y){this.client._marshall(this.id,3,[wfs._uint(time),wfs._int(id),wfs._fixed(x),wfs._fixed(y)])}frame(){this.client._marshall(this.id,4,[])}cancel(){this.client._marshall(this.id,5,[])}shape(id,major,minor){this.client._marshall(this.id,6,[wfs._int(id),wfs._fixed(major),wfs._fixed(minor)])}orientation(id,
orientation){this.client._marshall(this.id,7,[wfs._int(id),wfs._fixed(orientation)])}constructor(client,id,version){super(client,id,version,{release(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.release.call(this.implementation,this)}};wfs.GrOutput=class GrOutput extends wfs.Resource{geometry(x,y,physicalWidth,physicalHeight,subpixel,make,model,transform){this.client._marshall(this.id,1,[wfs._int(x),wfs._int(y),wfs._int(physicalWidth),wfs._int(physicalHeight),
wfs._int(subpixel),wfs._string(make),wfs._string(model),wfs._int(transform)])}mode(flags,width,height,refresh){this.client._marshall(this.id,2,[wfs._uint(flags),wfs._int(width),wfs._int(height),wfs._int(refresh)])}done(){this.client._marshall(this.id,3,[])}scale(factor){this.client._marshall(this.id,4,[wfs._int(factor)])}constructor(client,id,version){super(client,id,version,{release(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.release.call(this.implementation,
this)}};wfs.GrOutput.Subpixel={unknown:0,none:1,horizontalRgb:2,horizontalBgr:3,verticalRgb:4,verticalBgr:5};wfs.GrOutput.Transform={normal:0,90:1,180:2,270:3,flipped:4,flipped90:5,flipped180:6,flipped270:7};wfs.GrOutput.Mode={current:1,preferred:2};wfs.GrRegion=class GrRegion extends wfs.Resource{constructor(client,id,version){super(client,id,version,{destroy(resource){},add(resource,x,y,width,height){},subtract(resource,x,y,width,height){}})}[1](message){const args=this.client._unmarshallArgs(message,
"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"iiii");this.implementation.add.call(this.implementation,this,args[0],args[1],args[2],args[3])}[3](message){const args=this.client._unmarshallArgs(message,"iiii");this.implementation.subtract.call(this.implementation,this,args[0],args[1],args[2],args[3])}};wfs.GrSubcompositor=class GrSubcompositor extends wfs.Resource{constructor(client,id,version){super(client,id,version,{destroy(resource){},
getSubsurface(resource,id,surface,parent){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"noo");this.implementation.getSubsurface.call(this.implementation,this,args[0],args[1],args[2])}};wfs.GrSubcompositor.Error={badSurface:0};wfs.GrSubsurface=class GrSubsurface extends wfs.Resource{constructor(client,id,version){super(client,id,version,{destroy(resource){},
setPosition(resource,x,y){},placeAbove(resource,sibling){},placeBelow(resource,sibling){},setSync(resource){},setDesync(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"ii");this.implementation.setPosition.call(this.implementation,this,args[0],args[1])}[3](message){const args=this.client._unmarshallArgs(message,"o");this.implementation.placeAbove.call(this.implementation,
this,args[0])}[4](message){const args=this.client._unmarshallArgs(message,"o");this.implementation.placeBelow.call(this.implementation,this,args[0])}[5](message){const args=this.client._unmarshallArgs(message,"");this.implementation.setSync.call(this.implementation,this)}[6](message){const args=this.client._unmarshallArgs(message,"");this.implementation.setDesync.call(this.implementation,this)}};wfs.GrSubsurface.Error={badSurface:0};module.exports=wfs},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserSurface});var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);var _BrowserSurfaceView__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9);var _BrowserCallback__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(33);var _math_Rect__WEBPACK_IMPORTED_MODULE_3__=
__webpack_require__(13);var _math_Mat4__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(10);var _math_Transformations__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(34);var _Size__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14);var _BrowserRegion__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(16);var _BrowserSurfaceChild__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(35);var _render_Renderer__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(18);var _BrowserRtcBufferFactory__WEBPACK_IMPORTED_MODULE_10__=
__webpack_require__(36);var _math_Point__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(12);const bufferTransformations=[{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["NORMAL"],inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["NORMAL"].invert()},{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["_90"],inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["_90"].invert()},{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["_180"],
inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["_180"].invert()},{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["_270"],inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["_270"].invert()},{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED"],inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED"].invert()},{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED_90"],
inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED_90"].invert()},{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED_180"],inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED_180"].invert()},{transformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED_270"],inverseTransformation:_math_Transformations__WEBPACK_IMPORTED_MODULE_5__["FLIPPED_270"].invert()}];class BrowserSurface{static create(grSurfaceResource,
renderer,browserSeat,browserSession){const bufferDamage=_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].createPixmanRegion();const opaquePixmanRegion=_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].createPixmanRegion();const inputPixmanRegion=_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].createPixmanRegion();const surfacePixmanRegion=_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].createPixmanRegion();_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].initInfinite(bufferDamage);
_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].initInfinite(opaquePixmanRegion);_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].initInfinite(inputPixmanRegion);const browserSurface=new BrowserSurface(grSurfaceResource,renderer,browserSeat,browserSession,bufferDamage,opaquePixmanRegion,inputPixmanRegion,surfacePixmanRegion);grSurfaceResource.implementation=browserSurface;grSurfaceResource.onDestroy().then(()=>{_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].destroyPixmanRegion(bufferDamage);
_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].destroyPixmanRegion(opaquePixmanRegion);_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].destroyPixmanRegion(inputPixmanRegion);_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].destroyPixmanRegion(surfacePixmanRegion);browserSurface._handleDestruction()});return browserSurface}constructor(grSurfaceResource,renderer,browserSeat,browserSession,bufferDamage,opaquePixmanRegion,inputPixmanRegion,surfacePixmanRegion){this.resource=grSurfaceResource;
this.renderer=renderer;this.renderState=null;this.state={bufferContents:null,bufferDamageRects:[],opaquePixmanRegion:opaquePixmanRegion,inputPixmanRegion:inputPixmanRegion,dx:0,dy:0,bufferTransform:0,bufferScale:1,frameCallbacks:[],roleState:{}};this.pendingGrBuffer=null;this.pendingBrowserBufferDestroyListener=()=>{this.pendingGrBuffer=null};this._pendingDamageRects=[];this._pendingBufferDamageRects=[];this._pendingOpaqueRegion=0;this._pendingInputRegion=0;this._pendingDx=0;this._pendingDy=0;this._pendingBufferTransform=
0;this._pendingBufferScale=1;this.browserSurfaceViews=[];this.browserSeat=browserSeat;this.browserSession=browserSession;this.hasKeyboardInput=true;this.hasPointerInput=true;this.hasTouchInput=true;this.role=null;this.browserSurfaceChildSelf=_BrowserSurfaceChild__WEBPACK_IMPORTED_MODULE_8__["default"].create(this);this._browserSurfaceChildren=[];this.browserSubsurfaceChildren=[this.browserSurfaceChildSelf];this.pendingBrowserSubsurfaceChildren=[this.browserSurfaceChildSelf];this._pendingFrameCallbacks=
[];this.inverseBufferTransformation=_math_Mat4__WEBPACK_IMPORTED_MODULE_4__["default"].IDENTITY();this.bufferTransformation=_math_Mat4__WEBPACK_IMPORTED_MODULE_4__["default"].IDENTITY();this.pixmanRegion=surfacePixmanRegion;this.size=_Size__WEBPACK_IMPORTED_MODULE_6__["default"].create(0,0);this._count=0;this._total=0;this._start=0;this._bufferCompletionTotal=0;this._postRenderTotal=0;this._bufferSizeTotal=0}get browserSurfaceChildren(){return this.browserSubsurfaceChildren.concat(this._browserSurfaceChildren)}isWithinInputRegion(surfacePoint){const withinInput=
_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].contains(this.state.inputPixmanRegion,surfacePoint);const withinSurface=_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].contains(this.pixmanRegion,surfacePoint);return withinSurface&&withinInput}_applyBufferTransformWithPositionCorrection(newBufferTransform,bufferTransformation){switch(newBufferTransform){case 3:case 4:{this.bufferTransformation=bufferTransformation.timesMat4(_math_Mat4__WEBPACK_IMPORTED_MODULE_4__["default"].translation(this.size.w,
0).invert());this.inverseBufferTransformation=this.bufferTransformation.invert();break}case 2:case 5:{this.bufferTransformation=bufferTransformation.timesMat4(_math_Mat4__WEBPACK_IMPORTED_MODULE_4__["default"].translation(this.size.w,this.size.h).invert());this.inverseBufferTransformation=this.bufferTransformation.invert();break}case 1:case 6:{this.bufferTransformation=bufferTransformation.timesMat4(_math_Mat4__WEBPACK_IMPORTED_MODULE_4__["default"].translation(0,this.size.h).invert());this.inverseBufferTransformation=
this.bufferTransformation.invert();break}case 0:case 7:{this.bufferTransformation=bufferTransformation.timesMat4(_math_Mat4__WEBPACK_IMPORTED_MODULE_4__["default"].translation(0,0));this.inverseBufferTransformation=this.bufferTransformation.invert();break}}}_updateDerivedState(newState){const oldBufferSize=this.state.bufferContents?this.state.bufferContents.size:_Size__WEBPACK_IMPORTED_MODULE_6__["default"].create(0,0);const newBufferSize=newState.bufferContents?newState.bufferContents.size:_Size__WEBPACK_IMPORTED_MODULE_6__["default"].create(0,
0);if(newState.bufferScale!==this.state.bufferScale||newState.bufferTransform!==this.state.bufferTransform||oldBufferSize.w!==newBufferSize.w||oldBufferSize.h!==newBufferSize.h){const transformations=bufferTransformations[newState.bufferTransform];const bufferTransformation=newState.bufferScale===1?transformations.transformation:transformations.transformation.timesMat4(_math_Mat4__WEBPACK_IMPORTED_MODULE_4__["default"].scalar(newState.bufferScale));const inverseBufferTransformation=newState.bufferScale===
1?transformations.inverseTransformation:bufferTransformation.invert();const surfacePoint=inverseBufferTransformation.timesPoint(_math_Point__WEBPACK_IMPORTED_MODULE_11__["default"].create(newBufferSize.w,newBufferSize.h));this.size=_Size__WEBPACK_IMPORTED_MODULE_6__["default"].create(Math.abs(surfacePoint.x),Math.abs(surfacePoint.y));_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].fini(this.pixmanRegion);_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].initRect(this.pixmanRegion,_math_Rect__WEBPACK_IMPORTED_MODULE_3__["default"].create(0,
0,this.size.w,this.size.h));this._applyBufferTransformWithPositionCorrection(newState.bufferTransform,bufferTransformation)}}updateChildViewsZIndexes(){let parentPosition=this.browserSurfaceChildren.indexOf(this.browserSurfaceChildSelf);this.browserSurfaceViews.forEach((view)=>{const parentViewZIndex=view.zIndex;const zIndexOffset=parentViewZIndex-parentPosition;this._updateZIndex(view,zIndexOffset)})}_updateZIndex(parentView,zIndexOffset){let newZIndex=0;let newZIndexOffset=zIndexOffset;this.browserSurfaceChildren.forEach((browserSurfaceChild,
index)=>{newZIndex=newZIndexOffset+index;if(browserSurfaceChild.browserSurface===this)parentView.zIndex=newZIndex;else{const childView=browserSurfaceChild.browserSurface.browserSurfaceViews.find((view)=>{return view.parent===parentView});if(childView)newZIndexOffset=browserSurfaceChild.browserSurface._updateZIndex(childView,newZIndex)}});return newZIndex}onViewCreated(browserSurfaceView){}createView(){const bufferSize=this.state.bufferContents?this.state.bufferContents.size:_Size__WEBPACK_IMPORTED_MODULE_6__["default"].create(0,
0);const browserSurfaceView=_BrowserSurfaceView__WEBPACK_IMPORTED_MODULE_1__["default"].create(this,bufferSize.w,bufferSize.h);if(this.browserSurfaceViews.length===0)browserSurfaceView.primary=true;this.browserSurfaceViews.push(browserSurfaceView);browserSurfaceView.onDestroy().then(()=>{const idx=this.browserSurfaceViews.indexOf(browserSurfaceView);if(idx>-1)this.browserSurfaceViews.splice(idx,1)});this.browserSurfaceChildren.forEach((browserSurfaceChild)=>{this._ensureChildView(browserSurfaceChild,
browserSurfaceView)});this.updateChildViewsZIndexes();this.onViewCreated(browserSurfaceView);return browserSurfaceView}_ensureChildView(browserSurfaceChild,browserSurfaceView){if(browserSurfaceChild.browserSurface===this)return null;const childView=browserSurfaceChild.browserSurface.createView();const zIndexOrder=this.browserSurfaceChildren.indexOf(browserSurfaceChild);childView.zIndex=browserSurfaceView.zIndex+zIndexOrder;childView.parent=browserSurfaceView;return childView}addSubsurface(browserSurfaceChild){const childViews=
this._addChild(browserSurfaceChild,this.browserSubsurfaceChildren);this.pendingBrowserSubsurfaceChildren.push(browserSurfaceChild);browserSurfaceChild.browserSurface.resource.onDestroy().then(()=>{this.removeSubsurface(browserSurfaceChild)});return childViews}removeSubsurface(browserSurfaceChild){this._removeChild(browserSurfaceChild,this.browserSubsurfaceChildren);this._removeChild(browserSurfaceChild,this.pendingBrowserSubsurfaceChildren)}addChild(browserSurfaceChild){return this._addChild(browserSurfaceChild,
this._browserSurfaceChildren)}addToplevelChild(browserSurfaceChild){this._browserSurfaceChildren.push(browserSurfaceChild);const primaryChildView=browserSurfaceChild.browserSurface.browserSurfaceViews.find((view)=>view.primary);const primaryView=this.browserSurfaceViews.find((view)=>view.primary);const zIndexOrder=this.browserSurfaceChildren.indexOf(browserSurfaceChild);primaryChildView.zIndex=primaryView.zIndex+zIndexOrder;primaryChildView.parent=primaryView;browserSurfaceChild.browserSurface.resource.onDestroy().then(()=>
{this.removeChild(browserSurfaceChild)});this.updateChildViewsZIndexes()}removeChild(browserSurfaceChild){this._removeChild(browserSurfaceChild,this._browserSurfaceChildren)}_addChild(browserSurfaceChild,siblings){siblings.push(browserSurfaceChild);const childViews=[];this.browserSurfaceViews.forEach((browserSurfaceView)=>{const childView=this._ensureChildView(browserSurfaceChild,browserSurfaceView);if(childView)childViews.push(childView)});browserSurfaceChild.browserSurface.resource.onDestroy().then(()=>
{this.removeChild(browserSurfaceChild)});this.updateChildViewsZIndexes();return childViews}_removeChild(browserSurfaceChild,siblings){const index=siblings.indexOf(browserSurfaceChild);if(index>-1){siblings.splice(index,1);this.updateChildViewsZIndexes()}}destroy(resource){resource.destroy();if(this.renderState){this.renderState.destroy();this.renderState=null}}_handleDestruction(){this.browserSurfaceViews.forEach((browserSurfaceView)=>{delete browserSurfaceView.browserSurface;browserSurfaceView.destroy()})}attach(resource,
buffer,x,y){this._pendingDx=x;this._pendingDy=y;if(this.pendingGrBuffer)this.pendingGrBuffer.removeDestroyListener(this.pendingBrowserBufferDestroyListener);this.pendingGrBuffer=buffer;if(this.pendingGrBuffer)this.pendingGrBuffer.addDestroyListener(this.pendingBrowserBufferDestroyListener)}damage(resource,x,y,width,height){this._pendingDamageRects.push(_math_Rect__WEBPACK_IMPORTED_MODULE_3__["default"].create(x,y,x+width,y+height))}frame(resource,callback){this._pendingFrameCallbacks.push(_BrowserCallback__WEBPACK_IMPORTED_MODULE_2__["default"].create(new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrCallback"](resource.client,
callback,1)))}setOpaqueRegion(resource,region){this._pendingOpaqueRegion=_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].createPixmanRegion();if(region){const browserRegion=region.implementation;_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].copyTo(this._pendingOpaqueRegion,browserRegion.pixmanRegion)}else _BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].initInfinite(this._pendingOpaqueRegion)}setInputRegion(resource,region){this._pendingInputRegion=_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].createPixmanRegion();
if(region){const browserRegion=region.implementation;_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].copyTo(this._pendingInputRegion,browserRegion.pixmanRegion)}else _BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].initInfinite(this._pendingInputRegion)}toSurfaceSpace(bufferPoint){return this.inverseBufferTransformation.timesPoint(bufferPoint)}async commit(resource){this._start=Date.now();this._count++;if(this.pendingGrBuffer)this.pendingGrBuffer.removeDestroyListener(this.pendingBrowserBufferDestroyListener);
const pendingGrBuffer=this.pendingGrBuffer;const newState=await this._captureState(pendingGrBuffer);if(this.role&&typeof this.role.onCommit==="function"){const animationFrame=_render_Renderer__WEBPACK_IMPORTED_MODULE_9__["default"].createRenderFrame();await this.role.onCommit(this,animationFrame,newState);if(newState.inputPixmanRegion)_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].destroyPixmanRegion(newState.inputPixmanRegion);if(newState.opaquePixmanRegion)_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].destroyPixmanRegion(newState.opaquePixmanRegion)}}async render(renderFrame,
newState,skipDraw){if(skipDraw==null)skipDraw=false;renderFrame.then((timestamp)=>{this.state.frameCallbacks.forEach((frameCallback)=>{frameCallback.done(timestamp&2147483647)});this.state.frameCallbacks=[]});if(this.browserSubsurfaceChildren.length>1){this.browserSubsurfaceChildren=this.pendingBrowserSubsurfaceChildren.slice();this.updateChildViewsZIndexes();this.browserSubsurfaceChildren.forEach((browserSurfaceChild)=>{const siblingBrowserSurface=browserSurfaceChild.browserSurface;if(siblingBrowserSurface!==
this){const siblingSubsurface=siblingBrowserSurface.role;if(siblingSubsurface.pendingPosition){browserSurfaceChild.position=siblingSubsurface.pendingPosition;siblingSubsurface.pendingPosition=null}siblingSubsurface.onParentCommit(this,renderFrame)}})}if(!skipDraw)await this.renderer.render(this,newState);const postRenderStart=Date.now();const {w:oldWidth,h:oldHeight}=this.size;this._updateDerivedState(newState);BrowserSurface.mergeState(this.state,newState);if(this.role&&this.role.setRoleState)this.role.setRoleState(newState.roleState);
if(newState.inputPixmanRegion||oldWidth!==this.size.w||oldHeight!==this.size.h)this.browserSurfaceViews.forEach((browserSurfaceView)=>{browserSurfaceView.updateInputRegion()});this.browserSurfaceViews.forEach((browserSurfaceView)=>{browserSurfaceView.swapBuffers(renderFrame)});const now=Date.now();this._postRenderTotal+=now-postRenderStart;this._total+=now-this._start;false&&console.log("post-render avg",this._postRenderTotal/this._count);false&&console.log("---\x3e commit avg",this._total/this._count)}static mergeState(targetState,
sourceState){targetState.dx=sourceState.dx;targetState.dy=sourceState.dy;_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].copyTo(targetState.inputPixmanRegion,sourceState.inputPixmanRegion);_BrowserRegion__WEBPACK_IMPORTED_MODULE_7__["default"].copyTo(targetState.opaquePixmanRegion,sourceState.opaquePixmanRegion);targetState.bufferDamageRects=sourceState.bufferDamageRects.slice();targetState.bufferTransform=sourceState.bufferTransform;targetState.bufferScale=sourceState.bufferScale;targetState.bufferContents=
sourceState.bufferContents;targetState.frameCallbacks=targetState.frameCallbacks.concat(sourceState.frameCallbacks)}async _captureState(pendingGrBuffer){const self=this;const newState={bufferContents:null,bufferDamageRects:[],opaquePixmanRegion:self._pendingOpaqueRegion,inputPixmanRegion:self._pendingInputRegion,dx:self._pendingDx,dy:self._pendingDy,bufferTransform:self._pendingBufferTransform,bufferScale:self._pendingBufferScale,frameCallbacks:self._pendingFrameCallbacks,roleState:{}};this._pendingFrameCallbacks=
[];this._pendingInputRegion=0;this._pendingOpaqueRegion=0;newState.bufferDamageRects=this._pendingDamageRects.map((rect)=>this.bufferTransformation.timesRect(rect)).concat(this._pendingBufferDamageRects);this._pendingDamageRects=[];this._pendingBufferDamageRects=[];if(this.role&&this.role.captureRoleState)newState.roleState=this.role.captureRoleState();const bufferReceiveStart=Date.now();if(pendingGrBuffer){const browserRtcDcBuffer=_BrowserRtcBufferFactory__WEBPACK_IMPORTED_MODULE_10__["default"].get(pendingGrBuffer);
newState.bufferContents=await browserRtcDcBuffer.whenComplete();const bufferCompletion=Date.now()-bufferReceiveStart;this._bufferCompletionTotal+=bufferCompletion;false&&console.log("buffer completion avg",this._bufferCompletionTotal/this._count,"current",bufferCompletion);let bufferSize=0;newState.bufferContents.fragments.forEach((fragment)=>{bufferSize+=fragment.opaque.byteLength;bufferSize+=fragment.alpha.byteLength});this._bufferSizeTotal+=bufferSize;false&&console.log("buffer transfer avg (kb/s)",
this._bufferSizeTotal/1024/(this._bufferCompletionTotal/1E3),"current",bufferSize/1024/(bufferCompletion/1E3))}else newState.bufferContents=null;return newState}setBufferTransform(resource,transform){if(Object.values(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrOutput"].Transform).includes(transform))this._pendingBufferTransform=transform;else;}setBufferScale(resource,scale){if(scale<1);this._pendingBufferScale=scale}damageBuffer(resource,x,y,width,height){this._pendingBufferDamageRects.push(_math_Rect__WEBPACK_IMPORTED_MODULE_3__["default"].create(x,
y,x+width,y+height))}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserSurfaceView});var _math_Mat4__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var _BufferedCanvas__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(15);var _math_Vec4__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11);var _BrowserRegion__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(16);var _render_Renderer__WEBPACK_IMPORTED_MODULE_4__=
__webpack_require__(18);class BrowserSurfaceView{static create(browserSurface,width,height){const bufferedCanvas=_BufferedCanvas__WEBPACK_IMPORTED_MODULE_1__["default"].create(width,height);const browserSurfaceView=new BrowserSurfaceView(bufferedCanvas,browserSurface,_math_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].IDENTITY());bufferedCanvas.view=browserSurfaceView;browserSurfaceView.updateInputRegion();return browserSurfaceView}static _nextTopZIndex(){this._topZIndex++;return this._topZIndex}constructor(bufferedCanvas,
browserSurface,transformation){this.bufferedCanvas=bufferedCanvas;this.browserSurface=browserSurface;this._transformation=transformation;this._backBufferTransformation=transformation;this._inverseTransformation=transformation.invert();this._destroyPromise=new Promise((resolve)=>{this._destroyResolve=resolve});this.destroyed=false;this._parent=null;this._primary=false}set parent(parent){if(this.destroyed)return;this._parent=parent;if(this._parent){this.primary=parent.primary;parent.onDestroy().then(()=>
{if(this.parent===parent){this.destroy();this.parent=null}});const renderFrame=_render_Renderer__WEBPACK_IMPORTED_MODULE_4__["default"].createRenderFrame();this.applyTransformations(renderFrame);renderFrame.fire();if(this._parent.isAttached())this.attachTo(this._parent.parentElement());else this.detach()}}set primary(primary){if(this.destroyed)return;this._primary=primary;this.browserSurface.browserSurfaceChildren.forEach((browserSurfaceChild)=>{if(browserSurfaceChild===this.browserSurface.browserSurfaceChildSelf)return;
browserSurfaceChild.browserSurface.browserSurfaceViews.filter((browserSurfaceView)=>{return browserSurfaceView.parent===this}).forEach((browserSurfaceView)=>{browserSurfaceView.primary=primary})})}get primary(){return this._primary}get parent(){return this._parent}set transformation(transformation){if(this.destroyed)return;this._transformation=transformation;this._inverseTransformation=transformation.invert()}get transformation(){return this._transformation}applyTransformations(renderFrame){if(this.destroyed)return;
const transformation=this._calculateTransformation();this.transformation=transformation;const bufferToViewTransformation=transformation.timesMat4(this.browserSurface.inverseBufferTransformation);const newCssTransform=bufferToViewTransformation.toCssMatrix();renderFrame.then(()=>{this.bufferedCanvas.setElementTransformation(newCssTransform)});this._applyTransformationsChild(renderFrame)}_applyTransformationsChild(renderFrame){this.browserSurface.browserSurfaceChildren.forEach((browserSurfaceChild)=>
{if(browserSurfaceChild.browserSurface===this.browserSurface)return;browserSurfaceChild.browserSurface.browserSurfaceViews.filter((browserSurfaceView)=>{return browserSurfaceView.parent===this}).forEach((childView)=>{childView.applyTransformations(renderFrame)})})}_applyTransformationsBackBuffer(){const transformation=this._calculateTransformation();this._backBufferTransformation=transformation;const bufferToViewTransformation=transformation.timesMat4(this.browserSurface.inverseBufferTransformation);
const newCssTransform=bufferToViewTransformation.toCssMatrix();this.bufferedCanvas.setBackBufferElementTransformation(newCssTransform)}_calculateTransformation(){let parentTransformation=_math_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].IDENTITY();if(this._parent)parentTransformation=this._parent.transformation;const browserSurfaceChild=this.browserSurface.browserSurfaceChildSelf;const {x,y}=browserSurfaceChild.position;const positionTransformation=_math_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].translation(x,
y);return parentTransformation.timesMat4(positionTransformation)}raise(){if(this.destroyed)return;this.zIndex=BrowserSurfaceView._nextTopZIndex();this.browserSurface.updateChildViewsZIndexes()}set zIndex(index){if(this.destroyed)return;if(index>=BrowserSurfaceView._topZIndex)BrowserSurfaceView._topZIndex=index;this.bufferedCanvas.zIndex=index}get zIndex(){return window.parseInt(this.bufferedCanvas.frontContext.canvas.style.zIndex,10)}draw(image){if(this.destroyed)return;this._applyTransformationsBackBuffer();
this.bufferedCanvas.drawBackBuffer(image)}swapBuffers(renderFrame){if(this.destroyed)return;this.transformation=this._backBufferTransformation;renderFrame.then(()=>{this.bufferedCanvas.swapBuffers()});this._applyTransformationsChild(renderFrame)}toBrowserSpace(viewPoint){return this.transformation.timesPoint(viewPoint)}toViewSpace(browserPoint){return this._inverseTransformation.timesPoint(browserPoint)}toSurfaceSpace(browserPoint){const viewPoint=this.toViewSpace(browserPoint);const canvas=this.bufferedCanvas.frontContext.canvas;
const boundingRect=canvas.getBoundingClientRect();const canvasWidth=Math.round(boundingRect.width);const canvasHeight=Math.round(boundingRect.height);const surfaceSize=this.browserSurface.size;const surfaceWidth=surfaceSize.w;const surfaceHeight=surfaceSize.h;if(surfaceWidth===canvasWidth&&surfaceHeight===canvasHeight)return viewPoint;else return _math_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].scalarVector(_math_Vec4__WEBPACK_IMPORTED_MODULE_2__["default"].create2D(surfaceWidth/canvasWidth,surfaceHeight/
canvasHeight)).timesPoint(viewPoint)}fadeOut(){this.bufferedCanvas.addCssClass("fadeToHidden")}show(){if(this.destroyed)return;this.bufferedCanvas.removeCssClass("fadeToHidden")}destroy(){this.destroyed=true;this._destroyResolve()}onDestroy(){return this._destroyPromise}isAttached(){return this.bufferedCanvas.isAttachedToElement()}attachTo(element){if(this.destroyed)return;this.bufferedCanvas.attachToElement(element);this.browserSurface.browserSurfaceChildren.forEach((browserSurfaceChild)=>{browserSurfaceChild.browserSurface.browserSurfaceViews.filter((childView)=>
{return childView.parent===this}).forEach((childView)=>{childView.attachTo(element)})})}parentElement(){return this.bufferedCanvas.frontContext.canvas.parentElement}detach(){this.bufferedCanvas.detachFromElement()}updateInputRegion(){if(this.destroyed)return;const inputPixmanRegion=this.browserSurface.state.inputPixmanRegion;const surfacePixmanRegion=this.browserSurface.pixmanRegion;_BrowserRegion__WEBPACK_IMPORTED_MODULE_3__["default"].intersect(inputPixmanRegion,inputPixmanRegion,surfacePixmanRegion);
const inputRectangles=_BrowserRegion__WEBPACK_IMPORTED_MODULE_3__["default"].rectangles(inputPixmanRegion);this.bufferedCanvas.updateInputRegionElements(inputRectangles)}}BrowserSurfaceView._topZIndex=20},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return Mat4});var _Vec4__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11);var _Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);
var _Rect__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(13);class Mat4{static create(m00,m10,m20,m30,m01,m11,m21,m31,m02,m12,m22,m32,m03,m13,m23,m33){return new Mat4(m00,m10,m20,m30,m01,m11,m21,m31,m02,m12,m22,m32,m03,m13,m23,m33)}static IDENTITY(){return this.create(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static scalar(scale){return this.create(scale,0,0,0,0,scale,0,0,0,0,1,0,0,0,0,1)}static scalarVector(vect4){return this.create(vect4.x,0,0,0,0,vect4.y,0,0,0,0,vect4.z,0,0,0,0,vect4.w)}static translation(x,
y){return this.create(1,0,0,x,0,1,0,y,0,0,1,0,0,0,0,1)}constructor(m00,m10,m20,m30,m01,m11,m21,m31,m02,m12,m22,m32,m03,m13,m23,m33){this.m00=m00;this.m10=m10;this.m20=m20;this.m30=m30;this.m01=m01;this.m11=m11;this.m21=m21;this.m31=m31;this.m02=m02;this.m12=m12;this.m22=m22;this.m32=m32;this.m03=m03;this.m13=m13;this.m23=m23;this.m33=m33}plus(other){return Mat4.create(this.m00+other.m00,this.m10+other.m10,this.m20+other.m20,this.m30+other.m30,this.m01+other.m01,this.m11+other.m11,this.m21+other.m21,
this.m31+other.m31,this.m02+other.m02,this.m12+other.m12,this.m22+other.m22,this.m32+other.m32,this.m03+other.m03,this.m13+other.m13,this.m23+other.m23,this.m33+other.m33)}timesPoint(right){return this.timesVec4(right.toVec4()).toPoint()}timesVec4(right){const rightX=right.x;const rightY=right.y;const rightZ=right.z;const rightW=right.w;return _Vec4__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.m00*rightX+this.m10*rightY+this.m20*rightZ+this.m30*rightW,this.m01*rightX+this.m11*rightY+this.m21*
rightZ+this.m31*rightW,this.m02*rightX+this.m12*rightY+this.m22*rightZ+this.m32*rightW,this.m03*rightX+this.m13*rightY+this.m23*rightZ+this.m33*rightW)}timesMat4(right){const nm00=this.m00*right.m00+this.m10*right.m01+this.m20*right.m02+this.m30*right.m03;const nm01=this.m01*right.m00+this.m11*right.m01+this.m21*right.m02+this.m31*right.m03;const nm02=this.m02*right.m00+this.m12*right.m01+this.m22*right.m02+this.m32*right.m03;const nm03=this.m03*right.m00+this.m13*right.m01+this.m23*right.m02+this.m33*
right.m03;const nm10=this.m00*right.m10+this.m10*right.m11+this.m20*right.m12+this.m30*right.m13;const nm11=this.m01*right.m10+this.m11*right.m11+this.m21*right.m12+this.m31*right.m13;const nm12=this.m02*right.m10+this.m12*right.m11+this.m22*right.m12+this.m32*right.m13;const nm13=this.m03*right.m10+this.m13*right.m11+this.m23*right.m12+this.m33*right.m13;const nm20=this.m00*right.m20+this.m10*right.m21+this.m20*right.m22+this.m30*right.m23;const nm21=this.m01*right.m20+this.m11*right.m21+this.m21*
right.m22+this.m31*right.m23;const nm22=this.m02*right.m20+this.m12*right.m21+this.m22*right.m22+this.m32*right.m23;const nm23=this.m03*right.m20+this.m13*right.m21+this.m23*right.m22+this.m33*right.m23;const nm30=this.m00*right.m30+this.m10*right.m31+this.m20*right.m32+this.m30*right.m33;const nm31=this.m01*right.m30+this.m11*right.m31+this.m21*right.m32+this.m31*right.m33;const nm32=this.m02*right.m30+this.m12*right.m31+this.m22*right.m32+this.m32*right.m33;const nm33=this.m03*right.m30+this.m13*
right.m31+this.m23*right.m32+this.m33*right.m33;return Mat4.create(nm00,nm10,nm20,nm30,nm01,nm11,nm21,nm31,nm02,nm12,nm22,nm32,nm03,nm13,nm23,nm33)}timesRect(right){const topLeft=this.timesPoint(_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(right.x0,right.y0));const bottomRight=this.timesPoint(_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(right.x1,right.y1));return _Rect__WEBPACK_IMPORTED_MODULE_2__["default"].create(topLeft.x,topLeft.y,bottomRight.x,bottomRight.y)}invert(){const M=
[[this.m00,this.m01,this.m02,this.m03],[this.m10,this.m11,this.m12,this.m13],[this.m20,this.m21,this.m22,this.m23],[this.m30,this.m31,this.m32,this.m33]];let i;let ii=0;let j=0;const dim=M.length;let e=0;const I=[];const C=[];for(i=0;i<dim;i+=1){I[I.length]=[];C[C.length]=[];for(j=0;j<dim;j+=1){if(i===j)I[i][j]=1;else I[i][j]=0;C[i][j]=M[i][j]}}for(i=0;i<dim;i+=1){e=C[i][i];if(e===0){for(ii=i+1;ii<dim;ii+=1)if(C[ii][i]!==0){for(j=0;j<dim;j++){e=C[i][j];C[i][j]=C[ii][j];C[ii][j]=e;e=I[i][j];I[i][j]=
I[ii][j];I[ii][j]=e}break}e=C[i][i];if(e===0)return}for(j=0;j<dim;j++){C[i][j]=C[i][j]/e;I[i][j]=I[i][j]/e}for(ii=0;ii<dim;ii++){if(ii===i)continue;e=C[ii][i];for(j=0;j<dim;j++){C[ii][j]-=e*C[i][j];I[ii][j]-=e*I[i][j]}}}return Mat4.create(I[0][0],I[1][0],I[2][0],I[3][0],I[0][1],I[1][1],I[2][1],I[3][1],I[0][2],I[1][2],I[2][2],I[3][2],I[0][3],I[1][3],I[2][3],I[3][3])}clone(){return Mat4.create(this.m00,this.m10,this.m20,this.m30,this.m01,this.m11,this.m21,this.m31,this.m02,this.m12,this.m22,this.m32,
this.m03,this.m13,this.m23,this.m33)}toCssMatrix(){return`matrix3d(${this.m00}, ${this.m01}, ${this.m02}, ${this.m03}, ${this.m10}, ${this.m11}, ${this.m12}, ${this.m13}, ${this.m20}, ${this.m21}, ${this.m22}, ${this.m23}, ${this.m30}, ${this.m31}, ${this.m32}, ${this.m33})`}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return Vec4});var _Point__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);
class Vec4{static create(x,y,z,w){return new Vec4(x,y,z,w)}static create2D(x,y){return this.create(x,y,1,1)}constructor(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w}plus(right){return Vec4.create(this.x+right.x,this.y+right.y,this.z+right.z,this.w+right.w)}minus(right){return Vec4.create(this.x-right.x,this.y-right.y,this.z-right.z,this.w-right.w)}toPoint(){return _Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.x,this.y)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return Point});var _Vec4__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11);class Point{static create(x,y){return new Point(x,y)}constructor(x,y){this.x=x;this.y=y}toVec4(){return _Vec4__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.x,this.y,0,1)}plus(right){return Point.create(this.x+right.x,this.y+right.y)}minus(right){return Point.create(this.x-right.x,this.y-right.y)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return Rect});var _Size__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14);var _Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);class Rect{static create(x0,y0,x1,y1){return new Rect(x0,y0,x1,y1)}constructor(x0,y0,x1,y1){this.x0=x0;this.y0=y0;this.x1=x1;this.y1=y1}get width(){return Math.abs(this.x1-this.x0)}get height(){return Math.abs(this.y1-this.y0)}get size(){return _Size__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.width,
this.height)}get position(){return _Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(this.x0,this.y0)}intersect(other){const r1=this;const r2=other;const leftX=Math.max(r1.x0,r2.x0);const rightX=Math.min(r1.x1,r2.x1);const topY=Math.max(r1.y0,r2.y0);const bottomY=Math.min(r1.y1,r2.y1);let intersectionRect;if(leftX<rightX&&topY<bottomY)intersectionRect=Rect.create(leftX,topY,rightX,bottomY);else intersectionRect=Rect.create(0,0,0,0);return intersectionRect}}},function(module,__webpack_exports__,
__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return Size});class Size{static create(width,height){return new Size(width,height)}constructor(w,h){this.w=w;this.h=h}toString(){return"("+this.w+", "+this.h+")"}getHalfSize(){return new Size(this.w>>>1,this.h>>>1)}equals(size){return size.w===this.w&&size.h===this.h}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,
"default",function(){return BufferedCanvas});var _Size__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14);class BufferedCanvas{static create(width,height){const frontCanvas=document.createElement("canvas");frontCanvas.width=width;frontCanvas.height=height;frontCanvas.style.display="inline";frontCanvas.style.zIndex="0";const frontContext=frontCanvas.getContext("2d");if(!frontContext.canvas)frontContext.canvas=frontCanvas;const backCanvas=document.createElement("canvas");backCanvas.width=width;backCanvas.height=
height;backCanvas.style.display="none";backCanvas.style.zIndex="0";const backContext=backCanvas.getContext("2d");if(!backContext.canvas)backContext.canvas=backCanvas;const containerDiv=document.createElement("div");containerDiv.style.display="contents";containerDiv.appendChild(frontCanvas);containerDiv.appendChild(backCanvas);return new BufferedCanvas(frontContext,backContext,containerDiv)}constructor(frontContext,backContext,containerDiv){this.frontContext=frontContext;this.backContext=backContext;
this.inputDivs=[];this.containerDiv=containerDiv;this.view=null;this._backBufferSync=null}drawBackBuffer(image){this._draw(this.backContext,image)}_draw(renderingContext,image){const canvas=renderingContext.canvas;if(canvas.width!==image.width||canvas.height!==image.height){canvas.width=image.width;canvas.height=image.height}else renderingContext.clearRect(0,0,canvas.width,canvas.height);renderingContext.drawImage(image,0,0)}swapBuffers(){const oldFront=this.frontContext;this.frontContext=this.backContext;
this.backContext=oldFront;this.backContext.canvas.style.display="none";this.frontContext.canvas.style.display="inline";this.containerDiv.style.transform=this.frontContext.canvas.style.transform;this.frontContext.canvas.style.transform="inherit";this.backContext.canvas.style.transform=this.containerDiv.style.transform}set zIndex(index){const zIndex=index.toString(10);this.frontContext.canvas.style.zIndex=zIndex;this.backContext.canvas.style.zIndex=zIndex;this.inputDivs.forEach((inputDiv)=>{inputDiv.style.zIndex=
zIndex+1})}size(){return _Size__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.frontContext.canvas.width,this.frontContext.canvas.height)}addCssClass(cssClass){this.containerDiv.classList.add(cssClass)}removeCssClass(cssClass){this.containerDiv.classList.remove(cssClass)}_detachInputDivs(){this.inputDivs.forEach((inputDiv)=>{if(inputDiv.parentElement)inputDiv.parentElement.removeChild(inputDiv)})}_syncDivToRect(divElement,rectangle){const rectangleSize=rectangle.size;divElement.style.left=`${rectangle.x0}px`;
divElement.style.top=`${rectangle.y0}px`;divElement.style.width=`${rectangleSize.w}px`;divElement.style.height=`${rectangleSize.h}px`}updateInputRegionElements(rectangles){if(this.inputDivs.length!==rectangles.length){this._detachInputDivs();this.inputDivs=[];rectangles.forEach((rectangle)=>{const inputDiv=document.createElement("div");inputDiv.view=this.view;inputDiv.classList.add("inputRegion");inputDiv.style.zIndex=this.frontContext.canvas.style.zIndex+1;this._syncDivToRect(inputDiv,rectangle);
this.containerDiv.appendChild(inputDiv);this.inputDivs.push(inputDiv)})}else for(let i=0;i<rectangles.length;i++){const rectangle=rectangles[i];const inputDiv=this.inputDivs[i];this._syncDivToRect(inputDiv,rectangle)}}attachToElement(element){element.appendChild(this.containerDiv)}isAttachedToElement(){return this.containerDiv.parentElement!==null}detachFromElement(){if(this.containerDiv.parentElement)this.containerDiv.parentElement.removeChild(this.containerDiv)}setElementTransformation(cssTransformation){this.containerDiv.style.transform=
cssTransformation}setBackBufferElementTransformation(cssTransformation){this.backContext.canvas.style.transform=cssTransformation}getParentElement(){return this.containerDiv.parentElement}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _math_Rect__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13);class BrowserRegion{static create(grRegionResource){const pixmanRegion=
BrowserRegion.createPixmanRegion();const browserRegion=new BrowserRegion(grRegionResource,pixmanRegion);grRegionResource.implementation=browserRegion;grRegionResource.onDestroy().then(()=>{BrowserRegion.destroyPixmanRegion(pixmanRegion)});return browserRegion}static createPixmanRegion(){const pixmanRegion=_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._malloc(20);_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_init(pixmanRegion);return pixmanRegion}static fini(pixmanRegion){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_fini(pixmanRegion)}static initInfinite(pixmanRegion){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_init_rect(pixmanRegion,
-1073741823,-1073741823,2147483647,2147483647)}static initRect(pixmanRegion,rect){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_init_rect(pixmanRegion,rect.x0,rect.y0,rect.x1-rect.x0,rect.y1-rect.y0)}static union(result,left,right){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_union(result,left,right)}static intersect(result,left,right){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_intersect(result,left,right)}static unionRect(result,
left,x,y,width,height){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_union_rect(result,left,x,y,width,height)}static destroyPixmanRegion(pixmanRegion){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_fini(pixmanRegion);_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._free(pixmanRegion)}static rectangles(pixmanRegion){const nroRectsPtr=_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._malloc(4);const pixmanBoxPtr=_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_rectangles(pixmanRegion,
nroRectsPtr);const rectangles=[];const nroRects=(new DataView(_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"].HEAPU8.buffer,nroRectsPtr,4)).getUint32(0,true);const rectangleStructs=new DataView(_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"].HEAPU8.buffer,pixmanBoxPtr,4*4*nroRects);for(let i=0;i<nroRects;i++){const x0=rectangleStructs.getUint32(i*16,true);const y0=rectangleStructs.getUint32(i*16+4,true);const x1=rectangleStructs.getUint32(i*16+8,true);const y1=rectangleStructs.getUint32(i*
16+12,true);rectangles.push(_math_Rect__WEBPACK_IMPORTED_MODULE_1__["default"].create(x0,y0,x1,y1))}_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._free(nroRectsPtr);return rectangles}constructor(grRegionResource,pixmanRegion){this.resource=grRegionResource;this.pixmanRegion=pixmanRegion}destroy(resource){resource.destroy()}add(resource,x,y,width,height){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_union_rect(this.pixmanRegion,this.pixmanRegion,x,y,width,height)}subtract(resource,
x,y,width,height){const deltaPixmanRegion=_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._malloc(20);_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_init_rect(deltaPixmanRegion,x,y,width,height);_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_subtract(this.pixmanRegion,this.pixmanRegion,deltaPixmanRegion);BrowserRegion.destroyPixmanRegion(deltaPixmanRegion)}static contains(pixmanRegion,point){return _lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_contains_point(pixmanRegion,
point.x,point.y,null)!==0}static copyTo(destination,source){_lib_libpixman_1__WEBPACK_IMPORTED_MODULE_0__["default"]._pixman_region32_copy(destination,source)}}__webpack_exports__["default"]=BrowserRegion},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);let Module=function(Module){const FS=null;const ERRNO_CODES=null;Module=Module||{};var Module=typeof Module!=="undefined"?Module:{};Module["ENVIRONMENT"]="WEB";let moduleOverrides={};let key;for(key in Module)if(Module.hasOwnProperty(key))moduleOverrides[key]=
Module[key];Module["arguments"]=[];Module["thisProgram"]="./this.program";Module["quit"]=function(status,toThrow){throw toThrow;};Module["preRun"]=[];Module["postRun"]=[];let ENVIRONMENT_IS_WEB=false;let ENVIRONMENT_IS_WORKER=false;if(Module["ENVIRONMENT"])if(Module["ENVIRONMENT"]==="WEB")ENVIRONMENT_IS_WEB=true;else if(Module["ENVIRONMENT"]==="WORKER")ENVIRONMENT_IS_WORKER=true;else throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER.");else{ENVIRONMENT_IS_WEB=typeof window===
"object";ENVIRONMENT_IS_WORKER=typeof importScripts==="function"}if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){Module["read"]=function shell_read(url){const xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(ENVIRONMENT_IS_WORKER)Module["readBinary"]=function readBinary(url){const xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)};Module["readAsync"]=function readAsync(url,onload,
onerror){const xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function xhr_onload(){if(xhr.status==200||xhr.status==0&&xhr.response){onload(xhr.response);return}onerror()};xhr.onerror=onerror;xhr.send(null)};if(typeof arguments!=="undefined")Module["arguments"]=arguments;Module["setWindowTitle"]=function(title){document.title=title}}Module["print"]=console.log.bind(console);Module["printErr"]=console.warn.bind(console)||Module["print"];Module.print=Module["print"];
Module.printErr=Module["printErr"];for(key in moduleOverrides)if(moduleOverrides.hasOwnProperty(key))Module[key]=moduleOverrides[key];moduleOverrides=undefined;const STACK_ALIGN=16;function staticAlloc(size){assert(!staticSealed);const ret=STATICTOP;STATICTOP=STATICTOP+size+15&-16;return ret}function alignMemory(size,factor){if(!factor)factor=STACK_ALIGN;const ret=size=Math.ceil(size/factor)*factor;return ret}const functionPointers=new Array(0);const GLOBAL_BASE=1024;let ABORT=0;let EXITSTATUS=0;
function assert(condition,text){if(!condition)abort("Assertion failed: "+text)}function Pointer_stringify(ptr,length){if(length===0||!ptr)return"";let hasUtf=0;let t;let i=0;while(1){t=HEAPU8[ptr+i>>0];hasUtf|=t;if(t==0&&!length)break;i++;if(length&&i==length)break}if(!length)length=i;let ret="";if(hasUtf<128){const MAX_CHUNK=1024;let curr;while(length>0){curr=String.fromCharCode.apply(String,HEAPU8.subarray(ptr,ptr+Math.min(length,MAX_CHUNK)));ret=ret?ret+curr:curr;ptr+=MAX_CHUNK;length-=MAX_CHUNK}return ret}return UTF8ToString(ptr)}
const UTF8Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):undefined;function UTF8ArrayToString(u8Array,idx){let endPtr=idx;while(u8Array[endPtr])++endPtr;if(endPtr-idx>16&&u8Array.subarray&&UTF8Decoder)return UTF8Decoder.decode(u8Array.subarray(idx,endPtr));else{let u0,u1,u2,u3,u4,u5;let str="";while(1){u0=u8Array[idx++];if(!u0)return str;if(!(u0&128)){str+=String.fromCharCode(u0);continue}u1=u8Array[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}u2=
u8Array[idx++]&63;if((u0&240)==224)u0=(u0&15)<<12|u1<<6|u2;else{u3=u8Array[idx++]&63;if((u0&248)==240)u0=(u0&7)<<18|u1<<12|u2<<6|u3;else{u4=u8Array[idx++]&63;if((u0&252)==248)u0=(u0&3)<<24|u1<<18|u2<<12|u3<<6|u4;else{u5=u8Array[idx++]&63;u0=(u0&1)<<30|u1<<24|u2<<18|u3<<12|u4<<6|u5}}}if(u0<65536)str+=String.fromCharCode(u0);else{const ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}}}function UTF8ToString(ptr){return UTF8ArrayToString(HEAPU8,ptr)}function stringToUTF8Array(str,outU8Array,
outIdx,maxBytesToWrite){if(!(maxBytesToWrite>0))return 0;const startIdx=outIdx;const endIdx=outIdx+maxBytesToWrite-1;for(let i=0;i<str.length;++i){let u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127){if(outIdx>=endIdx)break;outU8Array[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;outU8Array[outIdx++]=192|u>>6;outU8Array[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;outU8Array[outIdx++]=224|u>>12;outU8Array[outIdx++]=128|
u>>6&63;outU8Array[outIdx++]=128|u&63}else if(u<=2097151){if(outIdx+3>=endIdx)break;outU8Array[outIdx++]=240|u>>18;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}else if(u<=67108863){if(outIdx+4>=endIdx)break;outU8Array[outIdx++]=248|u>>24;outU8Array[outIdx++]=128|u>>18&63;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}else{if(outIdx+5>=endIdx)break;outU8Array[outIdx++]=252|u>>30;outU8Array[outIdx++]=
128|u>>24&63;outU8Array[outIdx++]=128|u>>18&63;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}}outU8Array[outIdx]=0;return outIdx-startIdx}function lengthBytesUTF8(str){let len=0;for(let i=0;i<str.length;++i){let u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127)++len;else if(u<=2047)len+=2;else if(u<=65535)len+=3;else if(u<=2097151)len+=4;else if(u<=67108863)len+=5;else len+=6}return len}const UTF16Decoder=
typeof TextDecoder!=="undefined"?new TextDecoder("utf-16le"):undefined;function allocateUTF8(str){const size=lengthBytesUTF8(str)+1;const ret=_malloc(size);if(ret)stringToUTF8Array(str,HEAP8,ret,size);return ret}const WASM_PAGE_SIZE=65536;const ASMJS_PAGE_SIZE=16777216;function alignUp(x,multiple){if(x%multiple>0)x+=multiple-x%multiple;return x}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function updateGlobalBuffer(buf){Module["buffer"]=buffer=buf}function updateGlobalBufferViews(){Module["HEAP8"]=
HEAP8=new Int8Array(buffer);Module["HEAP16"]=HEAP16=new Int16Array(buffer);Module["HEAP32"]=HEAP32=new Int32Array(buffer);Module["HEAPU8"]=HEAPU8=new Uint8Array(buffer);Module["HEAPU16"]=HEAPU16=new Uint16Array(buffer);Module["HEAPU32"]=HEAPU32=new Uint32Array(buffer);Module["HEAPF32"]=HEAPF32=new Float32Array(buffer);Module["HEAPF64"]=HEAPF64=new Float64Array(buffer)}var STATIC_BASE,STATICTOP,staticSealed;let STACK_BASE,STACKTOP,STACK_MAX;let DYNAMIC_BASE,DYNAMICTOP_PTR;STATIC_BASE=STATICTOP=STACK_BASE=
STACKTOP=STACK_MAX=DYNAMIC_BASE=DYNAMICTOP_PTR=0;staticSealed=false;function abortOnCannotGrowMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+TOTAL_MEMORY+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function enlargeMemory(){abortOnCannotGrowMemory()}const TOTAL_STACK=
Module["TOTAL_STACK"]||5242880;var TOTAL_MEMORY=Module["TOTAL_MEMORY"]||16777216;if(TOTAL_MEMORY<TOTAL_STACK)Module.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+TOTAL_MEMORY+"! (TOTAL_STACK="+TOTAL_STACK+")");if(Module["buffer"])buffer=Module["buffer"];else{if(typeof window.WebAssembly==="object"&&typeof window.WebAssembly.Memory==="function"){Module["wasmMemory"]=new window.WebAssembly.Memory({"initial":TOTAL_MEMORY/WASM_PAGE_SIZE,"maximum":TOTAL_MEMORY/WASM_PAGE_SIZE});buffer=
Module["wasmMemory"].buffer}else buffer=new ArrayBuffer(TOTAL_MEMORY);Module["buffer"]=buffer}updateGlobalBufferViews();function getTotalMemory(){return TOTAL_MEMORY}HEAP32[0]=1668509029;HEAP16[1]=25459;if(HEAPU8[2]!==115||HEAPU8[3]!==99)throw new Error("Runtime error: expected the system to be little-endian!");function callRuntimeCallbacks(callbacks){while(callbacks.length>0){let callback=callbacks.shift();if(typeof callback==="function"){callback();continue}let func=callback.func;if(typeof func===
"number")if(callback.arg===undefined)Module["dynCall_v"](func);else Module["dynCall_vi"](func,callback.arg);else func(callback.arg===undefined?null:callback.arg)}}const __ATPRERUN__=[];const __ATINIT__=[];const __ATMAIN__=[];const __ATEXIT__=[];const __ATPOSTRUN__=[];let runtimeInitialized=false;let runtimeExited=false;function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]==="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length)addOnPreRun(Module["preRun"].shift())}callRuntimeCallbacks(__ATPRERUN__)}
function ensureInitRuntime(){if(runtimeInitialized)return;runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__);runtimeExited=true}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]==="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length)addOnPostRun(Module["postRun"].shift())}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}
function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}function writeAsciiToMemory(str,buffer,dontAddNull){for(let i=0;i<str.length;++i)HEAP8[buffer++>>0]=str.charCodeAt(i);if(!dontAddNull)HEAP8[buffer>>0]=0}const Math_abs=Math.abs;const Math_cos=Math.cos;const Math_sin=Math.sin;const Math_tan=Math.tan;const Math_acos=Math.acos;const Math_asin=Math.asin;const Math_atan=Math.atan;const Math_atan2=Math.atan2;const Math_exp=Math.exp;const Math_log=Math.log;const Math_sqrt=Math.sqrt;const Math_ceil=Math.ceil;
const Math_floor=Math.floor;const Math_pow=Math.pow;const Math_imul=Math.imul;const Math_fround=Math.fround;const Math_round=Math.round;const Math_min=Math.min;const Math_max=Math.max;const Math_clz32=Math.clz32;const Math_trunc=Math.trunc;let runDependencies=0;let runDependencyWatcher=null;let dependenciesFulfilled=null;function addRunDependency(id){runDependencies++;if(Module["monitorRunDependencies"])Module["monitorRunDependencies"](runDependencies)}function removeRunDependency(id){runDependencies--;
if(Module["monitorRunDependencies"])Module["monitorRunDependencies"](runDependencies);if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){const callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["preloadedImages"]={};Module["preloadedAudios"]={};const dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(filename){return String.prototype.startsWith?filename.startsWith(dataURIPrefix):
filename.indexOf(dataURIPrefix)===0}function integrateWasmJS(){let wasmTextFile="libpixman-1.wast";let wasmBinaryFile="libpixman-1.wasm";let asmjsCodeFile="libpixman-1.temp.asm.js";if(typeof Module["locateFile"]==="function"){if(!isDataURI(wasmTextFile))wasmTextFile=Module["locateFile"](wasmTextFile);if(!isDataURI(wasmBinaryFile))wasmBinaryFile=Module["locateFile"](wasmBinaryFile);if(!isDataURI(asmjsCodeFile))asmjsCodeFile=Module["locateFile"](asmjsCodeFile)}const wasmPageSize=64*1024;const info=
{"global":null,"env":null,"asm2wasm":{"f64-rem":function(x,y){return x%y},"debugger":function(){debugger}},"parent":Module};let exports=null;function mergeMemory(newBuffer){const oldBuffer=Module["buffer"];if(newBuffer.byteLength<oldBuffer.byteLength)Module["printErr"]("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here");const oldView=new Int8Array(oldBuffer);const newView=new Int8Array(newBuffer);newView.set(oldView);updateGlobalBuffer(newBuffer);
updateGlobalBufferViews()}function fixImports(imports){return imports}function getBinary(){try{if(Module["wasmBinary"])return new Uint8Array(Module["wasmBinary"]);if(Module["readBinary"])return Module["readBinary"](wasmBinaryFile);else throw new Error("on the web, we need the wasm binary to be preloaded and set on Module['wasmBinary']. emcc.py will do that for you when generating HTML (but not JS)");}catch(err){abort(err)}}function getBinaryPromise(){if(!Module["wasmBinary"]&&(ENVIRONMENT_IS_WEB||
ENVIRONMENT_IS_WORKER)&&typeof fetch==="function")return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(!response["ok"])throw new Error("failed to load wasm binary file at '"+wasmBinaryFile+"'");return response["arrayBuffer"]()}).catch(function(){return getBinary()});return new Promise(function(resolve,reject){resolve(getBinary())})}function doNativeWasm(global,env,providedBuffer){if(typeof window.WebAssembly!=="object"){Module["printErr"]("no native wasm support detected");
return false}if(!(Module["wasmMemory"]instanceof window.WebAssembly.Memory)){Module["printErr"]("no native wasm Memory in use");return false}env["memory"]=Module["wasmMemory"];info["global"]={"NaN":NaN,"Infinity":Infinity};info["global.Math"]=Math;info["env"]=env;function receiveInstance(instance,module){exports=instance.exports;if(exports.memory)mergeMemory(exports.memory);Module["asm"]=exports;Module["usingWasm"]=true;removeRunDependency("wasm-instantiate")}addRunDependency("wasm-instantiate");
if(Module["instantiateWasm"])try{return Module["instantiateWasm"](info,receiveInstance)}catch(e){Module["printErr"]("Module.instantiateWasm callback failed with error: "+e);return false}function receiveInstantiatedSource(output){receiveInstance(output["instance"],output["module"])}function instantiateArrayBuffer(receiver){getBinaryPromise().then(function(binary){return window.WebAssembly.instantiate(binary,info)}).then(receiver).catch(function(reason){Module["printErr"]("failed to asynchronously prepare wasm: "+
reason);abort(reason)})}if(!Module["wasmBinary"]&&typeof window.WebAssembly.instantiateStreaming==="function"&&!isDataURI(wasmBinaryFile)&&typeof fetch==="function")window.WebAssembly.instantiateStreaming(fetch(wasmBinaryFile,{credentials:"same-origin"}),info).then(receiveInstantiatedSource).catch(function(reason){Module["printErr"]("wasm streaming compile failed: "+reason);Module["printErr"]("falling back to ArrayBuffer instantiation");instantiateArrayBuffer(receiveInstantiatedSource)});else instantiateArrayBuffer(receiveInstantiatedSource);
return{}}Module["asmPreload"]=Module["asm"];const asmjsReallocBuffer=Module["reallocBuffer"];const wasmReallocBuffer=function(size){const PAGE_MULTIPLE=Module["usingWasm"]?WASM_PAGE_SIZE:ASMJS_PAGE_SIZE;size=alignUp(size,PAGE_MULTIPLE);const old=Module["buffer"];const oldSize=old.byteLength;if(Module["usingWasm"])try{const result=Module["wasmMemory"].grow((size-oldSize)/wasmPageSize);if(result!==(-1|0))return Module["buffer"]=Module["wasmMemory"].buffer;else return null}catch(e){return null}};Module["reallocBuffer"]=
function(size){if(finalMethod==="asmjs")return asmjsReallocBuffer(size);else return wasmReallocBuffer(size)};var finalMethod="";Module["asm"]=function(global,env,providedBuffer){env=fixImports(env);if(!env["table"]){let TABLE_SIZE=Module["wasmTableSize"];if(TABLE_SIZE===undefined)TABLE_SIZE=1024;const MAX_TABLE_SIZE=Module["wasmMaxTableSize"];if(typeof window.WebAssembly==="object"&&typeof window.WebAssembly.Table==="function")if(MAX_TABLE_SIZE!==undefined)env["table"]=new window.WebAssembly.Table({"initial":TABLE_SIZE,
"maximum":MAX_TABLE_SIZE,"element":"anyfunc"});else env["table"]=new window.WebAssembly.Table({"initial":TABLE_SIZE,element:"anyfunc"});else env["table"]=new Array(TABLE_SIZE);Module["wasmTable"]=env["table"]}if(!env["memoryBase"])env["memoryBase"]=Module["STATIC_BASE"];if(!env["tableBase"])env["tableBase"]=0;let exports;exports=doNativeWasm(global,env,providedBuffer);if(!exports)abort("no binaryen method succeeded. consider enabling more options, like interpreting, if you want that: https://github.com/kripken/emscripten/wiki/WebAssembly#binaryen-methods");
return exports}}integrateWasmJS();STATIC_BASE=GLOBAL_BASE;STATICTOP=STATIC_BASE+19344;__ATINIT__.push({func:function(){_pixman_constructor()}});const STATIC_BUMP=19344;Module["STATIC_BASE"]=STATIC_BASE;Module["STATIC_BUMP"]=STATIC_BUMP;STATICTOP+=16;function ___assert_fail(condition,filename,line,func){abort("Assertion failed: "+Pointer_stringify(condition)+", at: "+[filename?Pointer_stringify(filename):"unknown filename",line,func?Pointer_stringify(func):"unknown function"])}const SYSCALLS={varargs:0,
get:function(varargs){SYSCALLS.varargs+=4;const ret=HEAP32[SYSCALLS.varargs-4>>2];return ret},getStr:function(){const ret=Pointer_stringify(SYSCALLS.get());return ret},get64:function(){const low=SYSCALLS.get(),high=SYSCALLS.get();if(low>=0)assert(high===0);else assert(high===-1);return low},getZero:function(){assert(SYSCALLS.get()===0)}};function ___syscall140(which,varargs){SYSCALLS.varargs=varargs;const FS=null;try{const stream=SYSCALLS.getStreamFromFD(),offset_high=SYSCALLS.get(),offset_low=SYSCALLS.get(),
result=SYSCALLS.get(),whence=SYSCALLS.get();const offset=offset_low;FS.llseek(stream,offset,whence);HEAP32[result>>2]=stream.position;if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall146(which,varargs){SYSCALLS.varargs=varargs;try{const stream=SYSCALLS.get(),iov=SYSCALLS.get(),iovcnt=SYSCALLS.get();let ret=0;if(!___syscall146.buffers){___syscall146.buffers=[null,[],
[]];___syscall146.printChar=function(stream,curr){const buffer=___syscall146.buffers[stream];assert(buffer);if(curr===0||curr===10){(stream===1?Module["print"]:Module["printErr"])(UTF8ArrayToString(buffer,0));buffer.length=0}else buffer.push(curr)}}for(let i=0;i<iovcnt;i++){const ptr=HEAP32[iov+i*8>>2];const len=HEAP32[iov+(i*8+4)>>2];for(let j=0;j<len;j++)___syscall146.printChar(stream,HEAPU8[ptr+j]);ret+=len}return ret}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);
return-e.errno}}function ___syscall54(which,varargs){SYSCALLS.varargs=varargs;try{return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall6(which,varargs){SYSCALLS.varargs=varargs;try{const stream=SYSCALLS.getStreamFromFD();FS.close(stream);return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function _abort(){Module["abort"]()}const _environ=STATICTOP;STATICTOP+=16;function ___buildEnvironment(env){const MAX_ENV_VALUES=
64;const TOTAL_ENV_SIZE=1024;let poolPtr;let envPtr;if(!___buildEnvironment.called){___buildEnvironment.called=true;ENV["USER"]=ENV["LOGNAME"]="web_user";ENV["PATH"]="/";ENV["PWD"]="/";ENV["HOME"]="/home/web_user";ENV["LANG"]="C.UTF-8";ENV["_"]=Module["thisProgram"];poolPtr=staticAlloc(TOTAL_ENV_SIZE);envPtr=staticAlloc(MAX_ENV_VALUES*4);HEAP32[envPtr>>2]=poolPtr;HEAP32[_environ>>2]=envPtr}else{envPtr=HEAP32[_environ>>2];poolPtr=HEAP32[envPtr>>2]}const strings=[];let totalSize=0;for(let key in env)if(typeof env[key]===
"string"){var line=key+"="+env[key];strings.push(line);totalSize+=line.length}if(totalSize>TOTAL_ENV_SIZE)throw new Error("Environment size exceeded TOTAL_ENV_SIZE!");const ptrSize=4;for(let i=0;i<strings.length;i++){var line=strings[i];writeAsciiToMemory(line,poolPtr);HEAP32[envPtr+i*ptrSize>>2]=poolPtr;poolPtr+=line.length+1}HEAP32[envPtr+strings.length*ptrSize>>2]=0}var ENV={};function _getenv(name){if(name===0)return 0;name=Pointer_stringify(name);if(!ENV.hasOwnProperty(name))return 0;if(_getenv.ret)_free(_getenv.ret);
_getenv.ret=allocateUTF8(ENV[name]);return _getenv.ret}function _emscripten_memcpy_big(dest,src,num){HEAPU8.set(HEAPU8.subarray(src,src+num),dest);return dest}function ___setErrNo(value){if(Module["___errno_location"])HEAP32[Module["___errno_location"]()>>2]=value;return value}___buildEnvironment(ENV);DYNAMICTOP_PTR=staticAlloc(4);STACK_BASE=STACKTOP=alignMemory(STATICTOP);STACK_MAX=STACK_BASE+TOTAL_STACK;DYNAMIC_BASE=alignMemory(STACK_MAX);HEAP32[DYNAMICTOP_PTR>>2]=DYNAMIC_BASE;staticSealed=true;
Module["wasmTableSize"]=737;Module["wasmMaxTableSize"]=737;Module.asmGlobalArg={};Module.asmLibraryArg={"abort":abort,"enlargeMemory":enlargeMemory,"getTotalMemory":getTotalMemory,"abortOnCannotGrowMemory":abortOnCannotGrowMemory,"___assert_fail":___assert_fail,"___setErrNo":___setErrNo,"___syscall140":___syscall140,"___syscall146":___syscall146,"___syscall54":___syscall54,"___syscall6":___syscall6,"_abort":_abort,"_emscripten_memcpy_big":_emscripten_memcpy_big,"_getenv":_getenv,"DYNAMICTOP_PTR":DYNAMICTOP_PTR,
"STACKTOP":STACKTOP};const asm=Module["asm"](Module.asmGlobalArg,Module.asmLibraryArg,buffer);Module["asm"]=asm;var _free=Module["_free"]=function(){return Module["asm"]["_free"].apply(null,arguments)};var _malloc=Module["_malloc"]=function(){return Module["asm"]["_malloc"].apply(null,arguments)};var _pixman_constructor=Module["_pixman_constructor"]=function(){return Module["asm"]["_pixman_constructor"].apply(null,arguments)};const _pixman_region32_clear=Module["_pixman_region32_clear"]=function(){return Module["asm"]["_pixman_region32_clear"].apply(null,
arguments)};const _pixman_region32_contains_point=Module["_pixman_region32_contains_point"]=function(){return Module["asm"]["_pixman_region32_contains_point"].apply(null,arguments)};const _pixman_region32_copy=Module["_pixman_region32_copy"]=function(){return Module["asm"]["_pixman_region32_copy"].apply(null,arguments)};const _pixman_region32_fini=Module["_pixman_region32_fini"]=function(){return Module["asm"]["_pixman_region32_fini"].apply(null,arguments)};const _pixman_region32_init=Module["_pixman_region32_init"]=
function(){return Module["asm"]["_pixman_region32_init"].apply(null,arguments)};const _pixman_region32_intersect=Module["_pixman_region32_intersect"]=function(){return Module["asm"]["_pixman_region32_intersect"].apply(null,arguments)};const _pixman_region32_init_rect=Module["_pixman_region32_init_rect"]=function(){return Module["asm"]["_pixman_region32_init_rect"].apply(null,arguments)};const _pixman_region32_rectangles=Module["_pixman_region32_rectangles"]=function(){return Module["asm"]["_pixman_region32_rectangles"].apply(null,
arguments)};const _pixman_region32_subtract=Module["_pixman_region32_subtract"]=function(){return Module["asm"]["_pixman_region32_subtract"].apply(null,arguments)};const _pixman_region32_union=Module["_pixman_region32_union"]=function(){return Module["asm"]["_pixman_region32_union"].apply(null,arguments)};const _pixman_region32_union_rect=Module["_pixman_region32_union_rect"]=function(){return Module["asm"]["_pixman_region32_union_rect"].apply(null,arguments)};const dynCall_vi=Module["dynCall_vi"]=
function(){return Module["asm"]["dynCall_vi"].apply(null,arguments)};Module["asm"]=asm;Module["then"]=function(func){if(Module["calledRun"])func(Module);else{const old=Module["onRuntimeInitialized"];Module["onRuntimeInitialized"]=function(){if(old)old();func(Module)}}return Module};function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}ExitStatus.prototype=new Error;ExitStatus.prototype.constructor=ExitStatus;let initialStackTop;
dependenciesFulfilled=function runCaller(){if(!Module["calledRun"])run();if(!Module["calledRun"])dependenciesFulfilled=runCaller};function run(args){args=args||Module["arguments"];if(runDependencies>0)return;preRun();if(runDependencies>0)return;if(Module["calledRun"])return;function doRun(){if(Module["calledRun"])return;Module["calledRun"]=true;if(ABORT)return;ensureInitRuntime();preMain();if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");
setTimeout(function(){setTimeout(function(){Module["setStatus"]("")},1);doRun()},1)}else doRun()}Module["run"]=run;function exit(status,implicit){if(implicit&&Module["noExitRuntime"]&&status===0)return;if(Module["noExitRuntime"]);else{ABORT=true;EXITSTATUS=status;STACKTOP=initialStackTop;exitRuntime();if(Module["onExit"])Module["onExit"](status)}Module["quit"](status,new ExitStatus(status))}Module["exit"]=exit;function abort(what){if(Module["onAbort"])Module["onAbort"](what);if(what!==undefined){Module.print(what);
Module.printErr(what);what=JSON.stringify(what)}else what="";ABORT=true;EXITSTATUS=1;throw new Error("abort("+what+"). Build with -s ASSERTIONS=1 for more info.");}Module["abort"]=abort;if(Module["preInit"]){if(typeof Module["preInit"]==="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0)Module["preInit"].pop()()}Module["noExitRuntime"]=true;run();return Module};__webpack_exports__["default"]=Module()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return Renderer});var _JpegRenderState__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(19);var _JpegAlphaSurfaceShader__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23);var _BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(22);var _JpegSurfaceShader__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(27);var _H264RenderState__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(28);var _YUVASurfaceShader__WEBPACK_IMPORTED_MODULE_5__=
__webpack_require__(31);var _YUVSurfaceShader__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(32);class Renderer{static create(){const canvas=document.createElement("canvas");let gl=canvas.getContext("webgl2",{antialias:false,depth:false,alpha:true,preserveDrawingBuffer:false});if(!gl)throw new Error("This browser doesn't support WebGL2!");gl.clearColor(0,0,0,0);const jpegAlphaSurfaceShader=_JpegAlphaSurfaceShader__WEBPACK_IMPORTED_MODULE_1__["default"].create(gl);const jpegSurfaceShader=_JpegSurfaceShader__WEBPACK_IMPORTED_MODULE_3__["default"].create(gl);
const yuvaSurfaceShader=_YUVASurfaceShader__WEBPACK_IMPORTED_MODULE_5__["default"].create(gl);const yuvSurfaceShader=_YUVSurfaceShader__WEBPACK_IMPORTED_MODULE_6__["default"].create(gl);return new Renderer(gl,jpegAlphaSurfaceShader,jpegSurfaceShader,yuvaSurfaceShader,yuvSurfaceShader,canvas)}static createRenderFrame(){let animationResolve=null;const animationPromise=new Promise((resolve)=>{animationResolve=resolve});animationPromise._animationResolve=animationResolve;animationPromise.fire=()=>{window.requestAnimationFrame((time)=>
{animationPromise._animationResolve(time)})};return animationPromise}constructor(gl,jpegAlphaSurfaceShader,jpegSurfaceShader,yuvaSurfaceShader,yuvSurfaceShader,canvas){this._gl=gl;this._jpegAlphaSurfaceShader=jpegAlphaSurfaceShader;this._jpegSurfaceShader=jpegSurfaceShader;this._yuvaSurfaceShader=yuvaSurfaceShader;this._yuvSurfaceShader=yuvSurfaceShader;this._canvas=canvas;this._emptyImage=new window.Image(0,0);this._emptyImage.src="//:0";this._viewDrawTotal=0;this._textureUpdateTotal=0;this._shaderInvocationTotal=
0;this._count=0}async render(browserSurface,newState){const views=browserSurface.browserSurfaceViews;const bufferContents=newState.bufferContents;if(bufferContents)await this._draw(bufferContents,browserSurface,views);else views.forEach((view)=>{view.draw(this._emptyImage)})}async["image/jpeg"](browserEncodedFrame,browserSurface,views){let renderState=browserSurface.renderState;if(!(renderState instanceof _JpegRenderState__WEBPACK_IMPORTED_MODULE_0__["default"])){if(renderState)renderState.destroy();
renderState=_JpegRenderState__WEBPACK_IMPORTED_MODULE_0__["default"].create(this._gl);browserSurface.renderState=renderState}const jpegRenderState=renderState;const {w:frameWidth,h:frameHeight}=browserEncodedFrame.size;let start=Date.now();await jpegRenderState.update(browserEncodedFrame);this._textureUpdateTotal+=Date.now()-start;false&&console.log("updating textures avg",this._textureUpdateTotal/this._count);if(_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__["default"].splitAlpha(browserEncodedFrame.encodingOptions)){this._jpegAlphaSurfaceShader.use();
this._jpegAlphaSurfaceShader.setTexture(jpegRenderState.opaqueTexture,jpegRenderState.alphaTexture);start=Date.now();const canvasSizeChanged=this._canvas.width!==frameWidth||this._canvas.height!==frameHeight;if(canvasSizeChanged){this._canvas.width=frameWidth;this._canvas.height=frameHeight;this._jpegAlphaSurfaceShader.updatePerspective(browserEncodedFrame.size)}this._jpegAlphaSurfaceShader.draw(browserEncodedFrame.size,canvasSizeChanged);this._jpegAlphaSurfaceShader.release();this._shaderInvocationTotal+=
Date.now()-start;false&&console.log("shader invocation avg",this._shaderInvocationTotal/this._count);start=Date.now();const image=await window.createImageBitmap(this._canvas);views.forEach((view)=>{view.draw(image)});this._viewDrawTotal+=Date.now()-start;false&&console.log("drawing views avg",this._viewDrawTotal/this._count)}else{this._jpegSurfaceShader.use();this._jpegSurfaceShader.setTexture(jpegRenderState.opaqueTexture);const canvasSizeChanged=this._canvas.width!==frameWidth||this._canvas.height!==
frameHeight;if(canvasSizeChanged){this._canvas.width=frameWidth;this._canvas.height=frameHeight;this._jpegSurfaceShader.updatePerspective(browserEncodedFrame.size)}this._jpegSurfaceShader.draw(browserEncodedFrame.size,canvasSizeChanged);this._jpegSurfaceShader.release();views.forEach((view)=>{view.draw(this._canvas)})}}async["image/png"](browserEncodedFrame,browserSurface,views){const fullFrame=_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__["default"].fullFrame(browserEncodedFrame.encodingOptions);
const splitAlpha=_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__["default"].splitAlpha(browserEncodedFrame.encodingOptions);if(fullFrame&&!splitAlpha){const frame=browserEncodedFrame.fragments[0];const opaqueImageBlob=new window.Blob([frame.opaque],{"type":"image/png"});const opaqueImageBitmap=await window.createImageBitmap(opaqueImageBlob,0,0,frame.geo.width,frame.geo.height);views.forEach((view)=>{view.draw(opaqueImageBitmap)})}else throw new Error(`Unsupported buffer. Encoding type: ${browserEncodedFrame.encodingType}, full frame:${fullFrame}, split alpha: ${splitAlpha}`);
}async["video/h264"](browserEncodedFrame,browserSurface,views){let renderState=browserSurface.renderState;if(!(renderState instanceof _H264RenderState__WEBPACK_IMPORTED_MODULE_4__["default"])){if(renderState)renderState.destroy();renderState=_H264RenderState__WEBPACK_IMPORTED_MODULE_4__["default"].create(this._gl);browserSurface.renderState=renderState}const h264RenderState=renderState;const {w:frameWidth,h:frameHeight}=browserEncodedFrame.size;let start=Date.now();await h264RenderState.update(browserEncodedFrame);
this._textureUpdateTotal+=Date.now()-start;false&&console.log("updating textures avg",this._textureUpdateTotal/this._count);if(_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__["default"].splitAlpha(browserEncodedFrame.encodingOptions)){this._yuvaSurfaceShader.use();this._yuvaSurfaceShader.setTexture(h264RenderState.yTexture,h264RenderState.uTexture,h264RenderState.vTexture,h264RenderState.alphaTexture);start=Date.now();const canvasSizeChanged=this._canvas.width!==frameWidth||this._canvas.height!==
frameHeight;if(canvasSizeChanged){this._canvas.width=frameWidth;this._canvas.height=frameHeight;this._yuvaSurfaceShader.updatePerspective(browserEncodedFrame.size)}this._yuvaSurfaceShader.draw(browserEncodedFrame.size,canvasSizeChanged);this._yuvaSurfaceShader.release();this._shaderInvocationTotal+=Date.now()-start;false&&console.log("shader invocation avg",this._shaderInvocationTotal/this._count);start=Date.now();const image=await window.createImageBitmap(this._canvas);views.forEach((view)=>{view.draw(image)});
this._viewDrawTotal+=Date.now()-start;false&&console.log("drawing views avg",this._viewDrawTotal/this._count)}else{this._yuvSurfaceShader.use();this._yuvSurfaceShader.setTexture(h264RenderState.yTexture,h264RenderState.uTexture,h264RenderState.vTexture);const canvasSizeChanged=this._canvas.width!==frameWidth||this._canvas.height!==frameHeight;if(canvasSizeChanged){this._canvas.width=frameWidth;this._canvas.height=frameHeight;this._yuvSurfaceShader.updatePerspective(browserEncodedFrame.size)}this._yuvSurfaceShader.draw(browserEncodedFrame.size,
canvasSizeChanged);this._yuvSurfaceShader.release();views.forEach((view)=>{view.draw(this._canvas)})}}async _draw(bufferContents,browserSurface,views){this._count++;await this[bufferContents.encodingType](bufferContents,browserSurface,views)}}Renderer._animationPromise=null;Renderer._animationResolve=null},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return JpegRenderState});var _Texture__WEBPACK_IMPORTED_MODULE_0__=
__webpack_require__(20);var _Size__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(14);var _RenderState__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(21);var _BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(22);class JpegRenderState extends _RenderState__WEBPACK_IMPORTED_MODULE_2__["default"]{static create(gl){return new JpegRenderState(gl)}constructor(gl){super();this.gl=gl;this.opaqueTexture=_Texture__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.gl,this.gl.RGBA);
this.alphaTexture=_Texture__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.gl,this.gl.RGBA);this.size=_Size__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,0)}async update(browserEncodedFrame){const hasAlpha=_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_3__["default"].splitAlpha(browserEncodedFrame.encodingOptions);const sizeChanged=!this.size.equals(browserEncodedFrame.size);if(sizeChanged)this.size=browserEncodedFrame.size;await Promise.all(browserEncodedFrame.fragments.map(async(fragment)=>
{const opaqueImageBitmapPromise=window.createImageBitmap(new window.Blob([fragment.opaque],{"type":"image/jpeg"}),0,0,fragment.geo.width,fragment.geo.height);let alphaImageBitmapPromise=null;if(hasAlpha)alphaImageBitmapPromise=window.createImageBitmap(new window.Blob([fragment.alpha],{"type":"image/jpeg"}),0,0,fragment.geo.width,fragment.geo.height);if(sizeChanged){this.opaqueTexture.image2dElement(await opaqueImageBitmapPromise);if(hasAlpha)this.alphaTexture.image2dElement(await alphaImageBitmapPromise)}else{this.opaqueTexture.subImage2dElement(await opaqueImageBitmapPromise,
fragment.geo);if(hasAlpha)this.alphaTexture.subImage2dElement(await alphaImageBitmapPromise,fragment.geo)}}))}destroy(){this.opaqueTexture.delete();this.alphaTexture.delete()}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return Texture});class Texture{static create(gl,format){const texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,
gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindTexture(gl.TEXTURE_2D,null);return new Texture(gl,format,texture)}constructor(gl,format,texture){this.gl=gl;this.texture=texture;this.format=format}subImage2dBuffer(buffer,geo,stride){const gl=this.gl;gl.pixelStorei(gl.UNPACK_ROW_LENGTH,stride);gl.bindTexture(gl.TEXTURE_2D,this.texture);
gl.texSubImage2D(gl.TEXTURE_2D,0,geo.x0,geo.y0,geo.width,geo.height,this.format,gl.UNSIGNED_BYTE,buffer);gl.bindTexture(gl.TEXTURE_2D,null);gl.pixelStorei(gl.UNPACK_ROW_LENGTH,0)}image2dBuffer(buffer,width,height,stride){const gl=this.gl;gl.pixelStorei(gl.UNPACK_ROW_LENGTH,stride);gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texImage2D(gl.TEXTURE_2D,0,this.format,width,height,0,this.format,gl.UNSIGNED_BYTE,buffer);gl.bindTexture(gl.TEXTURE_2D,null);gl.pixelStorei(gl.UNPACK_ROW_LENGTH,0)}subImage2dElement(imageElement,
geo){const gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texSubImage2D(gl.TEXTURE_2D,0,geo.x0,geo.y0,this.format,gl.UNSIGNED_BYTE,imageElement);gl.bindTexture(gl.TEXTURE_2D,null)}image2dElement(imageElement){const gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texImage2D(gl.TEXTURE_2D,0,this.format,this.format,gl.UNSIGNED_BYTE,imageElement);gl.bindTexture(gl.TEXTURE_2D,null)}delete(){this.gl.deleteTexture(this.texture);this.texture=null}}},function(module,__webpack_exports__,
__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return RenderState});class RenderState{update(browserEncodedFrame){}destroy(){}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);class BrowserEncodingOptions{static splitAlpha(encodingOptions){return(encodingOptions&BrowserEncodingOptions._ALPHA)!==0}static fullFrame(encodingOptions){return(encodingOptions&BrowserEncodingOptions._FULL_FRAME)!==
0}}BrowserEncodingOptions._ALPHA=1<<0;BrowserEncodingOptions._FULL_FRAME=1<<1;__webpack_exports__["default"]=BrowserEncodingOptions},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return JpegAlphaSurfaceShader});var _Program__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24);var _ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25);var _ShaderSources__WEBPACK_IMPORTED_MODULE_2__=
__webpack_require__(26);class JpegAlphaSurfaceShader{static create(gl){const program=this._initShaders(gl);const shaderArgs=this._initShaderArgs(gl,program);const vertexBuffer=this._initBuffers(gl);return new JpegAlphaSurfaceShader(gl,vertexBuffer,shaderArgs,program)}static _initShaders(gl){const program=new _Program__WEBPACK_IMPORTED_MODULE_0__["default"](gl);program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["vertexQuad"]));
program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["fragmentJpegAlpha"]));program.link();program.use();return program}static _initShaderArgs(gl,program){const shaderArgs={};shaderArgs.opaqueTexture=program.getUniformLocation("opaqueTexture");shaderArgs.alphaTexture=program.getUniformLocation("alphaTexture");shaderArgs.u_projection=program.getUniformLocation("u_projection");shaderArgs.a_position=program.getAttributeLocation("a_position");
gl.enableVertexAttribArray(shaderArgs.a_position);shaderArgs.a_texCoord=program.getAttributeLocation("a_texCoord");gl.enableVertexAttribArray(shaderArgs.a_texCoord);return shaderArgs}static _initBuffers(gl){return gl.createBuffer()}constructor(gl,vertexBuffer,shaderArgs,program){this.gl=gl;this.vertexBuffer=vertexBuffer;this.shaderArgs=shaderArgs;this.program=program}setTexture(textureOpaque,textureAlpha){const gl=this.gl;gl.uniform1i(this.shaderArgs.opaqueTexture,0);gl.uniform1i(this.shaderArgs.alphaTexture,
1);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,textureOpaque.texture);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,textureAlpha.texture)}use(){this.program.use()}release(){const gl=this.gl;gl.useProgram(null)}updatePerspective(viewportSize){const gl=this.gl;const {w,h}=viewportSize;gl.viewport(0,0,w,h);this.program.setUniformM4(this.shaderArgs.u_projection,[2/w,0,0,0,0,2/-h,0,0,0,0,1,0,-1,1,0,1]);gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(this.gl.ARRAY_BUFFER,
new Float32Array([0,0,0,0,w,0,1,0,w,h,1,1,w,h,1,1,0,h,0,1,0,0,0,0]),this.gl.DYNAMIC_DRAW);gl.vertexAttribPointer(this.shaderArgs.a_position,2,gl.FLOAT,false,16,0);gl.vertexAttribPointer(this.shaderArgs.a_texCoord,2,gl.FLOAT,false,16,8)}draw(){const gl=this.gl;gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT);gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6);gl.bindTexture(gl.TEXTURE_2D,null)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return Program});class Program{constructor(gl){this.gl=gl;this.program=this.gl.createProgram()}attach(shader){this.gl.attachShader(this.program,shader)}link(){this.gl.linkProgram(this.program);if(!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))console.error("Unable to initialize the shader program.")}use(){this.gl.useProgram(this.program)}getAttributeLocation(name){return this.gl.getAttribLocation(this.program,name)}getUniformLocation(name){return this.gl.getUniformLocation(this.program,
name)}setUniformM4(uniformLocation,array){this.gl.uniformMatrix4fv(uniformLocation,false,array)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return ShaderCompiler});class ShaderCompiler{static compile(gl,script){let shader;if(script.type==="x-shader/x-fragment")shader=gl.createShader(gl.FRAGMENT_SHADER);else if(script.type==="x-shader/x-vertex")shader=gl.createShader(gl.VERTEX_SHADER);
else throw new Error("Unknown shader type: "+script.type);gl.shaderSource(shader,script.source);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS))throw new Error("An error occurred compiling the shaders: "+gl.getShaderInfoLog(shader));return shader}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"vertexQuad",function(){return vertexQuad});__webpack_require__.d(__webpack_exports__,
"fragmentJpegAlpha",function(){return fragmentJpegAlpha});__webpack_require__.d(__webpack_exports__,"fragmentJpeg",function(){return fragmentJpeg});__webpack_require__.d(__webpack_exports__,"fragmentYUVA",function(){return fragmentYUVA});__webpack_require__.d(__webpack_exports__,"fragmentYUV",function(){return fragmentYUV});const vertexQuad={type:"x-shader/x-vertex",source:`\n  precision mediump float;\n\n  uniform mat4 u_projection;\n  attribute vec2 a_position;\n  attribute vec2 a_texCoord;\n  varying vec2 v_texCoord;\n  void main(){\n      v_texCoord = a_texCoord;\n      gl_Position = u_projection * vec4(a_position, 0.0, 1.0);\n  }\n`};
const fragmentJpegAlpha={type:"x-shader/x-fragment",source:`\n  precision mediump float;\n  \n  varying vec2 v_texCoord;\n  \n  uniform sampler2D opaqueTexture;\n  uniform sampler2D alphaTexture;\n\n  void main(void) {\n   vec4 pix = texture2D(opaqueTexture, v_texCoord);\n   vec4 alphaPix = texture2D(alphaTexture, v_texCoord);\n   pix.a = alphaPix.r * 1.1644 - 0.07312;\n   pix.r = pix.r * 1.1644 - 0.07312;\n   pix.g = pix.g * 1.1644 - 0.07312;\n   pix.b = pix.b * 1.1644 - 0.07312;\n   gl_FragColor = pix;\n  }\n`};
const fragmentJpeg={type:"x-shader/x-fragment",source:`\n  precision mediump float;\n  \n  varying vec2 v_texCoord;\n  \n  uniform sampler2D opaqueTexture;\n\n  void main(void) {\n   gl_FragColor = texture2D(opaqueTexture, v_texCoord);\n  }\n`};const fragmentYUVA={type:"x-shader/x-fragment",source:`\n  precision lowp float;\n  \n  varying vec2 v_texCoord;\n  \n  uniform sampler2D yTexture;\n  uniform sampler2D uTexture;\n  uniform sampler2D vTexture;\n  uniform sampler2D alphaYTexture;\n    \n  const mat4 YUV2RGB = mat4\n  (\n   1.1643828125,             0, 1.59602734375, -.87078515625,\n   1.1643828125, -.39176171875,    -.81296875,     .52959375,\n   1.1643828125,   2.017234375,             0,  -1.081390625,\n              0,             0,             0,             1\n  );\n\n  void main(void) {\n   vec4 pix = vec4(texture2D(yTexture,  v_texCoord).x, texture2D(uTexture, v_texCoord).x, texture2D(vTexture, v_texCoord).x, 1) * YUV2RGB;\n   pix.w = (vec4(texture2D(alphaYTexture,  v_texCoord).x, 0.5019607843137255, 0.5019607843137255, 1) * YUV2RGB).x;\n   gl_FragColor = pix;\n  }\n`};
const fragmentYUV={type:"x-shader/x-fragment",source:`\n  precision lowp float;\n  \n  varying vec2 v_texCoord;\n  \n  uniform sampler2D yTexture;\n  uniform sampler2D uTexture;\n  uniform sampler2D vTexture;\n    \n  const mat4 YUV2RGB = mat4\n  (\n   1.1643828125,             0, 1.59602734375, -.87078515625,\n   1.1643828125, -.39176171875,    -.81296875,     .52959375,\n   1.1643828125,   2.017234375,             0,  -1.081390625,\n              0,             0,             0,             1\n  );\n\n  void main(void) {\n   vec4 pix = vec4(texture2D(yTexture,  v_texCoord).x, texture2D(uTexture, v_texCoord).x, texture2D(vTexture, v_texCoord).x, 1) * YUV2RGB;\n   pix.w = 1.0;\n   // pix.w = 1.0;\n   gl_FragColor = pix;\n  }\n`}},
function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return JpegSurfaceShader});var _Program__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24);var _ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25);var _ShaderSources__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26);class JpegSurfaceShader{static create(gl){const program=this._initShaders(gl);const shaderArgs=this._initShaderArgs(gl,
program);const vertexBuffer=this._initBuffers(gl);return new JpegSurfaceShader(gl,vertexBuffer,shaderArgs,program)}static _initShaders(gl){const program=new _Program__WEBPACK_IMPORTED_MODULE_0__["default"](gl);program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["vertexQuad"]));program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["fragmentJpeg"]));program.link();
program.use();return program}static _initShaderArgs(gl,program){const shaderArgs={};shaderArgs.opaqueTexture=program.getUniformLocation("opaqueTexture");shaderArgs.u_projection=program.getUniformLocation("u_projection");shaderArgs.a_position=program.getAttributeLocation("a_position");gl.enableVertexAttribArray(shaderArgs.a_position);shaderArgs.a_texCoord=program.getAttributeLocation("a_texCoord");gl.enableVertexAttribArray(shaderArgs.a_texCoord);return shaderArgs}static _initBuffers(gl){return gl.createBuffer()}constructor(gl,
vertexBuffer,shaderArgs,program){this.gl=gl;this.vertexBuffer=vertexBuffer;this.shaderArgs=shaderArgs;this.program=program}setTexture(textureOpaque){const gl=this.gl;gl.uniform1i(this.shaderArgs.opaqueTexture,0);gl.uniform1i(this.shaderArgs.alphaTexture,1);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,textureOpaque.texture)}use(){this.program.use()}release(){const gl=this.gl;gl.useProgram(null)}updatePerspective(viewportSize){const gl=this.gl;const {w,h}=viewportSize;gl.viewport(0,0,
w,h);this.program.setUniformM4(this.shaderArgs.u_projection,[2/w,0,0,0,0,2/-h,0,0,0,0,1,0,-1,1,0,1]);gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,0,w,0,1,0,w,h,1,1,w,h,1,1,0,h,0,1,0,0,0,0]),this.gl.DYNAMIC_DRAW);gl.vertexAttribPointer(this.shaderArgs.a_position,2,gl.FLOAT,false,16,0);gl.vertexAttribPointer(this.shaderArgs.a_texCoord,2,gl.FLOAT,false,16,8)}draw(){const gl=this.gl;gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT);
gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6);gl.bindTexture(gl.TEXTURE_2D,null)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return H264RenderState});var _Texture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20);var _Size__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(14);var _RenderState__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(21);var _H264BufferContentDecoder__WEBPACK_IMPORTED_MODULE_3__=
__webpack_require__(29);var _math_Rect__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(13);class H264RenderState extends _RenderState__WEBPACK_IMPORTED_MODULE_2__["default"]{static create(gl){const h264BufferContentDecoder=_H264BufferContentDecoder__WEBPACK_IMPORTED_MODULE_3__["default"].create();return new H264RenderState(gl,h264BufferContentDecoder)}constructor(gl,h264BufferContentDecoder){super();this.gl=gl;this.yTexture=_Texture__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.gl,this.gl.LUMINANCE);
this.uTexture=_Texture__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.gl,this.gl.LUMINANCE);this.vTexture=_Texture__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.gl,this.gl.LUMINANCE);this.alphaTexture=_Texture__WEBPACK_IMPORTED_MODULE_0__["default"].create(this.gl,this.gl.LUMINANCE);this.size=_Size__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,0);this._h264BufferContentDecoder=h264BufferContentDecoder}async update(browserEncodedFrame){const {alpha,opaque}=await this._h264BufferContentDecoder.decode(browserEncodedFrame);
const opaqueBuffer=opaque.buffer;const opaqueWidth=opaque.width;const opaqueHeight=opaque.height;const lumaSize=opaqueWidth*opaqueHeight;const chromaSize=lumaSize>>2;const yBuffer=opaqueBuffer.subarray(0,lumaSize);const uBuffer=opaqueBuffer.subarray(lumaSize,lumaSize+chromaSize);const vBuffer=opaqueBuffer.subarray(lumaSize+chromaSize,lumaSize+2*chromaSize);const isSubImage=browserEncodedFrame.size.equals(this.size);const chromaWidth=browserEncodedFrame.size.w>>1;const chromaHeight=browserEncodedFrame.size.h>>
1;const chromaStride=opaqueWidth>>1;if(isSubImage){this.yTexture.subImage2dBuffer(yBuffer,_math_Rect__WEBPACK_IMPORTED_MODULE_4__["default"].create(0,0,browserEncodedFrame.size.w,browserEncodedFrame.size.h),opaqueWidth);this.uTexture.subImage2dBuffer(uBuffer,_math_Rect__WEBPACK_IMPORTED_MODULE_4__["default"].create(0,0,chromaWidth,chromaHeight),chromaStride);this.vTexture.subImage2dBuffer(vBuffer,_math_Rect__WEBPACK_IMPORTED_MODULE_4__["default"].create(0,0,chromaWidth,chromaHeight),chromaStride)}else{this.yTexture.image2dBuffer(yBuffer,
browserEncodedFrame.size.w,browserEncodedFrame.size.h,opaqueWidth);this.uTexture.image2dBuffer(uBuffer,chromaWidth,chromaHeight,chromaStride);this.vTexture.image2dBuffer(vBuffer,chromaWidth,chromaHeight,chromaStride)}if(alpha){const alphaWidth=alpha.width;const alphaHeight=alpha.height;const alphaLumaSize=alphaWidth*alphaHeight;const alphaBuffer=alpha.buffer.subarray(0,alphaLumaSize);if(isSubImage)this.alphaTexture.subImage2dBuffer(alphaBuffer,_math_Rect__WEBPACK_IMPORTED_MODULE_4__["default"].create(0,
0,browserEncodedFrame.size.w,browserEncodedFrame.size.h),alphaWidth);else this.alphaTexture.image2dBuffer(alphaBuffer,browserEncodedFrame.size.w,browserEncodedFrame.size.h,alphaWidth)}}destroy(){this.yTexture.delete();this.uTexture.delete();this.vTexture.delete();this.alphaTexture.delete();this._h264BufferContentDecoder.destroy()}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return H264BufferContentDecoder});
var _H264NALDecoder__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(30);var _BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(22);class H264BufferContentDecoder{static create(){return new H264BufferContentDecoder}constructor(){this._decoder=null;this._decoderFactory=null;this._decodingSerialsQueue=[];this._alphaDecoder=null;this._alphaDecoderFactory=null;this._decodingAlphaSerialsQueue=[];this._frameStates={}}async decode(bufferContents){return new Promise((resolve)=>{this._frameStates[bufferContents.serial]=
{serial:bufferContents.serial,resolve:resolve,state:"pending",result:{opaque:null,alpha:null}};this._decodeH264(bufferContents)})}async _ensureH264Decoders(hasAlpha){if(!this._decoder){if(!this._decoderFactory)this._decoderFactory=_H264NALDecoder__WEBPACK_IMPORTED_MODULE_0__["default"].create(H264BufferContentDecoder._nextDecoderId++);const decoder=await this._decoderFactory;decoder.onPicture=(buffer,width,height)=>{this._onPictureDecoded(buffer,width,height)};this._decoder=decoder}if(hasAlpha&&!this._alphaDecoder){if(!this._alphaDecoderFactory)this._alphaDecoderFactory=
_H264NALDecoder__WEBPACK_IMPORTED_MODULE_0__["default"].create(H264BufferContentDecoder._nextDecoderId++);const alphaDecoder=await this._alphaDecoderFactory;alphaDecoder.onPicture=(buffer,width,height)=>{this._onAlphaPictureDecoded(buffer,width,height)};this._alphaDecoder=alphaDecoder}if(!hasAlpha&&this._alphaDecoder){this._alphaDecoder.release();this._alphaDecoder=null;this._alphaDecoderFactory=null}}async _decodeH264(bufferContents){const fullFrame=_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_1__["default"].fullFrame(bufferContents.encodingOptions);
if(!fullFrame)throw new Error("h264 encoded buffers must contain the full frame.");const hasAlpha=_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_1__["default"].splitAlpha(bufferContents.encodingOptions);await this._ensureH264Decoders(hasAlpha);if(hasAlpha){this._decodingAlphaSerialsQueue.push(bufferContents.serial);const alphaH264Nal=new Uint8Array(bufferContents.fragments[0].alpha.slice());this._alphaDecoder.decode(alphaH264Nal)}else this._frameStates[bufferContents.serial].state="pending_opaque";
this._decodingSerialsQueue.push(bufferContents.serial);const opaqueH264Nal=new Uint8Array(bufferContents.fragments[0].opaque);this._decoder.decode(opaqueH264Nal)}_onComplete(frameState){frameState.state="complete";delete this._frameStates[frameState.serial];frameState.resolve(frameState.result)}_onPictureDecoded(buffer,width,height){const frameSerial=this._decodingSerialsQueue.shift();const frameState=this._frameStates[frameSerial];frameState.result.opaque={buffer:buffer,width:width,height:height};
if(frameState.state==="pending_opaque")this._onComplete(frameState);else frameState.state="pending_alpha"}_onAlphaPictureDecoded(buffer,width,height){const frameSerial=this._decodingAlphaSerialsQueue.shift();const frameState=this._frameStates[frameSerial];frameState.result.alpha={buffer:buffer,width:width,height:height};if(frameState.state==="pending_alpha")this._onComplete(frameState);else this._frameStates[frameSerial].state="pending_opaque"}destroy(){if(this._decoder){this._decoder.release();this._decoderFactory=
null;this._decoder=null}if(this._alphaDecoder){this._alphaDecoder.release();this._alphaDecoderFactory=null;this._alphaDecoder=null}}}H264BufferContentDecoder._nextDecoderId=0},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return H264NALDecoder});class H264NALDecoder{static async create(renderStateId){const tinyH264Worker=await H264NALDecoder._tinyH264WorkerPromise;const h264NALDecoder=
new H264NALDecoder(tinyH264Worker,renderStateId);H264NALDecoder.h264NalDecoders[renderStateId]=h264NALDecoder;return h264NALDecoder}constructor(tinyH264Worker,renderStateId){this._tinyH264Worker=tinyH264Worker;this._renderStateId=renderStateId;this._busy=false;this._decodeQueue=[]}decode(h264Nal){if(this._busy){false&&console.log("Decoder busy. Queueing h264 NAL");this._decodeQueue.push(h264Nal);return}this._tinyH264Worker.postMessage({type:"decode",data:h264Nal.buffer,renderStateId:this._renderStateId},
[h264Nal.buffer]);this._busy=true}onPictureReady(message){const {width,height,data}=message;if(this._decodeQueue.length>0){const h264Nal=this._decodeQueue.shift();this._tinyH264Worker.postMessage({type:"decode",data:h264Nal.buffer,renderStateId:this._renderStateId},[h264Nal.buffer])}else this._busy=false;this.onPicture(new Uint8Array(data),width,height)}onPicture(buffer,width,height){}release(){if(this._tinyH264Worker){this._tinyH264Worker.postMessage({type:"release",renderStateId:this._renderStateId});
this._tinyH264Worker=null}}}H264NALDecoder.h264NalDecoders={};H264NALDecoder._tinyH264WorkerPromise=new Promise((resolve)=>{const tinyH264Worker=new window.Worker("TinyH264Worker.js");tinyH264Worker.addEventListener("message",(e)=>{const message=e.data;switch(message.type){case "pictureReady":H264NALDecoder.h264NalDecoders[message.renderStateId].onPictureReady(message);break;case "decoderReady":resolve(tinyH264Worker);break}})})},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return YUVASurfaceShader});var _Program__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24);var _ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25);var _ShaderSources__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26);class YUVASurfaceShader{static create(gl){const program=this._initShaders(gl);const shaderArgs=this._initShaderArgs(gl,program);const vertexBuffer=this._initBuffers(gl);return new YUVASurfaceShader(gl,
vertexBuffer,shaderArgs,program)}static _initShaders(gl){const program=new _Program__WEBPACK_IMPORTED_MODULE_0__["default"](gl);program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["vertexQuad"]));program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["fragmentYUVA"]));program.link();program.use();return program}static _initShaderArgs(gl,program){const shaderArgs=
{};shaderArgs.yTexture=program.getUniformLocation("yTexture");shaderArgs.uTexture=program.getUniformLocation("uTexture");shaderArgs.vTexture=program.getUniformLocation("vTexture");shaderArgs.alphaYTexture=program.getUniformLocation("alphaYTexture");shaderArgs.u_projection=program.getUniformLocation("u_projection");shaderArgs.a_position=program.getAttributeLocation("a_position");gl.enableVertexAttribArray(shaderArgs.a_position);shaderArgs.a_texCoord=program.getAttributeLocation("a_texCoord");gl.enableVertexAttribArray(shaderArgs.a_texCoord);
return shaderArgs}static _initBuffers(gl){return gl.createBuffer()}constructor(gl,vertexBuffer,shaderArgs,program){this.gl=gl;this.vertexBuffer=vertexBuffer;this.shaderArgs=shaderArgs;this.program=program}setTexture(textureY,textureU,textureV,textureAlphaY){const gl=this.gl;gl.uniform1i(this.shaderArgs.yTexture,0);gl.uniform1i(this.shaderArgs.uTexture,1);gl.uniform1i(this.shaderArgs.vTexture,2);gl.uniform1i(this.shaderArgs.alphaYTexture,3);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,
textureY.texture);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,textureU.texture);gl.activeTexture(gl.TEXTURE2);gl.bindTexture(gl.TEXTURE_2D,textureV.texture);gl.activeTexture(gl.TEXTURE3);gl.bindTexture(gl.TEXTURE_2D,textureAlphaY.texture)}use(){this.program.use()}release(){const gl=this.gl;gl.useProgram(null)}updatePerspective(viewportSize){const gl=this.gl;const {w,h}=viewportSize;gl.viewport(0,0,w,h);this.program.setUniformM4(this.shaderArgs.u_projection,[2/w,0,0,0,0,2/-h,0,0,0,0,
1,0,-1,1,0,1]);gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,0,w,0,1,0,w,h,1,1,w,h,1,1,0,h,0,1,0,0,0,0]),this.gl.DYNAMIC_DRAW);gl.vertexAttribPointer(this.shaderArgs.a_position,2,gl.FLOAT,false,16,0);gl.vertexAttribPointer(this.shaderArgs.a_texCoord,2,gl.FLOAT,false,16,8)}draw(){const gl=this.gl;gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT);gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6);gl.bindTexture(gl.TEXTURE_2D,
null)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return YUVSurfaceShader});var _Program__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24);var _ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25);var _ShaderSources__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26);class YUVSurfaceShader{static create(gl){const program=this._initShaders(gl);const shaderArgs=
this._initShaderArgs(gl,program);const vertexBuffer=this._initBuffers(gl);return new YUVSurfaceShader(gl,vertexBuffer,shaderArgs,program)}static _initShaders(gl){const program=new _Program__WEBPACK_IMPORTED_MODULE_0__["default"](gl);program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["vertexQuad"]));program.attach(_ShaderCompiler__WEBPACK_IMPORTED_MODULE_1__["default"].compile(gl,_ShaderSources__WEBPACK_IMPORTED_MODULE_2__["fragmentYUV"]));
program.link();program.use();return program}static _initShaderArgs(gl,program){const shaderArgs={};shaderArgs.yTexture=program.getUniformLocation("yTexture");shaderArgs.uTexture=program.getUniformLocation("uTexture");shaderArgs.vTexture=program.getUniformLocation("vTexture");shaderArgs.u_projection=program.getUniformLocation("u_projection");shaderArgs.a_position=program.getAttributeLocation("a_position");gl.enableVertexAttribArray(shaderArgs.a_position);shaderArgs.a_texCoord=program.getAttributeLocation("a_texCoord");
gl.enableVertexAttribArray(shaderArgs.a_texCoord);return shaderArgs}static _initBuffers(gl){return gl.createBuffer()}constructor(gl,vertexBuffer,shaderArgs,program){this.gl=gl;this.vertexBuffer=vertexBuffer;this.shaderArgs=shaderArgs;this.program=program}setTexture(textureY,textureU,textureV){const gl=this.gl;gl.uniform1i(this.shaderArgs.yTexture,0);gl.uniform1i(this.shaderArgs.uTexture,1);gl.uniform1i(this.shaderArgs.vTexture,2);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,textureY.texture);
gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,textureU.texture);gl.activeTexture(gl.TEXTURE2);gl.bindTexture(gl.TEXTURE_2D,textureV.texture)}use(){this.program.use()}release(){const gl=this.gl;gl.useProgram(null)}updatePerspective(viewportSize){const gl=this.gl;const {w,h}=viewportSize;gl.viewport(0,0,w,h);this.program.setUniformM4(this.shaderArgs.u_projection,[2/w,0,0,0,0,2/-h,0,0,0,0,1,0,-1,1,0,1]);gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(this.gl.ARRAY_BUFFER,
new Float32Array([0,0,0,0,w,0,1,0,w,h,1,1,w,h,1,1,0,h,0,1,0,0,0,0]),this.gl.DYNAMIC_DRAW);gl.vertexAttribPointer(this.shaderArgs.a_position,2,gl.FLOAT,false,16,0);gl.vertexAttribPointer(this.shaderArgs.a_texCoord,2,gl.FLOAT,false,16,8)}draw(){const gl=this.gl;gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT);gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6);gl.bindTexture(gl.TEXTURE_2D,null)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserCallback});class BrowserCallback{static create(grCallbackResource){return new BrowserCallback(grCallbackResource)}constructor(grCallbackResource){this.resource=grCallbackResource}done(data){if(this.resource){this.resource.done(data);this.resource.destroy();this.resource=null}}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"NORMAL",
function(){return NORMAL});__webpack_require__.d(__webpack_exports__,"_90",function(){return _90});__webpack_require__.d(__webpack_exports__,"_180",function(){return _180});__webpack_require__.d(__webpack_exports__,"_270",function(){return _270});__webpack_require__.d(__webpack_exports__,"FLIPPED",function(){return FLIPPED});__webpack_require__.d(__webpack_exports__,"FLIPPED_90",function(){return FLIPPED_90});__webpack_require__.d(__webpack_exports__,"FLIPPED_180",function(){return FLIPPED_180});
__webpack_require__.d(__webpack_exports__,"FLIPPED_270",function(){return FLIPPED_270});var _Mat4__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);const NORMAL=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].IDENTITY();const _90=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,-1,0,0,1,0,0,0,0,0,1,0,0,0,0,1);const _180=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].create(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1);const _270=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,1,0,0,-1,0,0,0,0,0,
1,0,0,0,0,1);const FLIPPED=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].create(-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);const FLIPPED_90=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,-1,0,0,-1,0,0,0,0,0,1,0,0,0,0,1);const FLIPPED_180=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].create(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1);const FLIPPED_270=_Mat4__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,1)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserSurfaceChild});var _math_Point__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);class BrowserSurfaceChild{static create(browserSurface){return new BrowserSurfaceChild(browserSurface)}constructor(browserSurface){this.browserSurface=browserSurface;this._position=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,0)}set position(relativePoint){this._position=relativePoint}get position(){return this._position}}
},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserRtcBufferFactory});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);
var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(37);var _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_2__);var _BrowserBuffer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(38);var _BrowserRtcDcBuffer__WEBPACK_IMPORTED_MODULE_4__=
__webpack_require__(39);class BrowserRtcBufferFactory extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static get(grBufferResource){return grBufferResource.implementation.browserRtcDcBuffer}static create(){return new BrowserRtcBufferFactory}constructor(){super(_protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_2__["RtcBufferFactory"].name,1)}bindClient(client,id,version){const rtcBufferFactoryResource=new _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_2__["RtcBufferFactory"](client,
id,version);rtcBufferFactoryResource.implementation=this}createBuffer(resource,id){const grBufferResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrBuffer"](resource.client,id,resource.version);_BrowserBuffer__WEBPACK_IMPORTED_MODULE_3__["default"].create(grBufferResource)}createDcBuffer(resource,id,blobTransferResource,grBufferResource){blobTransferResource.implementation.browserRtcPeerConnection.ensureP2S();const rtcDcBufferResource=new _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_2__["RtcDcBuffer"](resource.client,
id,resource.version);_BrowserRtcDcBuffer__WEBPACK_IMPORTED_MODULE_4__["default"].create(grBufferResource,rtcDcBufferResource,blobTransferResource)}}},function(module,exports,__webpack_require__){const wfs=__webpack_require__(3);wfs.RtcBufferFactory=class RtcBufferFactory extends wfs.Resource{constructor(client,id,version){super(client,id,version,{createBuffer(resource,id){},createDcBuffer(resource,id,blobTransfer,buffer){}})}[1](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.createBuffer.call(this.implementation,
this,args[0])}[2](message){const args=this.client._unmarshallArgs(message,"noo");this.implementation.createDcBuffer.call(this.implementation,this,args[0],args[1],args[2])}};wfs.RtcDcBuffer=class RtcDcBuffer extends wfs.Resource{ack(serial){this.client._marshall(this.id,1,[wfs._uint(serial)])}latency(serial,duration){this.client._marshall(this.id,2,[wfs._uint(serial),wfs._uint(duration)])}constructor(client,id,version){super(client,id,version,{destroy(resource){},syn(resource,serial){}})}[1](message){const args=
this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"u");this.implementation.syn.call(this.implementation,this,args[0])}};wfs.RtcPeerConnectionFactory=class RtcPeerConnectionFactory extends wfs.Resource{constructor(client,id,version){super(client,id,version,{createRtcPeerConnection(resource,id){}})}[1](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.createRtcPeerConnection.call(this.implementation,
this,args[0])}};wfs.RtcPeerConnection=class RtcPeerConnection extends wfs.Resource{init(){this.client._marshall(this.id,1,[])}serverSdpReply(description){this.client._marshall(this.id,2,[wfs._string(description)])}serverSdpOffer(description){this.client._marshall(this.id,3,[wfs._string(description)])}serverIceCandidates(description){this.client._marshall(this.id,4,[wfs._string(description)])}constructor(client,id,version){super(client,id,version,{createBlobTransfer(resource,id,descriptor){},clientIceCandidates(resource,
description){},clientSdpOffer(resource,description){},clientSdpReply(resource,description){},close(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"ns");this.implementation.createBlobTransfer.call(this.implementation,this,args[0],args[1])}[2](message){const args=this.client._unmarshallArgs(message,"s");this.implementation.clientIceCandidates.call(this.implementation,this,args[0])}[3](message){const args=this.client._unmarshallArgs(message,"s");this.implementation.clientSdpOffer.call(this.implementation,
this,args[0])}[4](message){const args=this.client._unmarshallArgs(message,"s");this.implementation.clientSdpReply.call(this.implementation,this,args[0])}[5](message){const args=this.client._unmarshallArgs(message,"");this.implementation.close.call(this.implementation,this)}};module.exports=wfs},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserBuffer});class BrowserBuffer{static create(grBufferResource){const browserBuffer=
new BrowserBuffer(grBufferResource);grBufferResource.implementation=browserBuffer;return browserBuffer}constructor(grBufferResource){this.resource=grBufferResource}destroy(resource){resource.destroy()}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserRtcDcBuffer});var _BrowserEncodedFrame__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(40);class BrowserRtcDcBuffer{static create(grBufferResource,
rtcDcBufferResource,blobTransferResource){const browserRtcDcBuffer=new BrowserRtcDcBuffer(rtcDcBufferResource,blobTransferResource);rtcDcBufferResource.implementation=browserRtcDcBuffer;grBufferResource.implementation.browserRtcDcBuffer=browserRtcDcBuffer;blobTransferResource.implementation.open().then((dataChannel)=>{dataChannel.onmessage=browserRtcDcBuffer._onMessage.bind(browserRtcDcBuffer);dataChannel.onerror=browserRtcDcBuffer._onError.bind(browserRtcDcBuffer)});return browserRtcDcBuffer}constructor(rtcDcBufferResource,
blobTransferResource){this.resource=rtcDcBufferResource;this._blobTransferResource=blobTransferResource;this._syncSerial=0;this._lastCompleteSerial=0;this._bufferStates={};this._bufferChunks={}}_onComplete(serial,browserEncodedFrame){if(serial<this._lastCompleteSerial)return;const bufferState=this._bufferStates[serial];bufferState.state="complete";this._lastCompleteSerial=serial;for(const oldSerial in this._bufferStates)if(oldSerial<serial){if(this._bufferStates[serial].state!=="complete")this._bufferStates[oldSerial].completionReject(new Error("Buffer contents expired "+
oldSerial));delete this._bufferStates[oldSerial]}bufferState.completionResolve(browserEncodedFrame)}_newBufferState(syncSerial){const bufferState={completionPromise:null,completionResolve:null,completionReject:null,state:"pending",browserEncodedFrame:null};bufferState.completionPromise=new Promise((resolve,reject)=>{bufferState.completionResolve=resolve;bufferState.completionReject=reject});this._bufferStates[syncSerial]=bufferState;return bufferState}whenComplete(){const bufferState=this._bufferStates[this._syncSerial];
return bufferState.completionPromise}async syn(resource,serial){if(serial<this._syncSerial)throw new Error("Buffer sync serial was not sequential.");this._syncSerial=serial;if(this._bufferStates[serial]&&this._bufferStates[serial].browserEncodedFrame)this._onComplete(serial,this._bufferStates[serial].browserEncodedFrame);else this._newBufferState(serial)}async _checkBufferState(browserEncodedFrame){if(this._bufferStates[browserEncodedFrame.serial]){this._bufferStates[browserEncodedFrame.serial].browserEncodedFrame=
browserEncodedFrame;this._onComplete(browserEncodedFrame.serial,browserEncodedFrame)}else if(browserEncodedFrame.serial>=this._lastCompleteSerial)this._newBufferState(browserEncodedFrame.serial).browserEncodedFrame=browserEncodedFrame}_checkChunk(chunk){const headerSize=12;const chunkHeader=new DataView(chunk,0,headerSize);const synSerial=chunkHeader.getUint32(0,false);const nroChunks=chunkHeader.getUint32(4,false);const chunkIdx=chunkHeader.getUint32(8,false);let bufferChunk=this._bufferChunks[synSerial];
if(!bufferChunk){bufferChunk={chunks:new Array(nroChunks),received:0,totalSize:0};this._bufferChunks[synSerial]=bufferChunk}const headerlessChunk=chunk.slice(headerSize);if(bufferChunk.chunks[chunkIdx])return null;bufferChunk.chunks[chunkIdx]=headerlessChunk;bufferChunk.received++;bufferChunk.totalSize+=headerlessChunk.byteLength;const chunkSize=16*(1024-12);if(bufferChunk.received===nroChunks){const bufferContents=new Uint8Array(bufferChunk.totalSize);bufferChunk.chunks.forEach((chunk,idx)=>{bufferContents.set(new Uint8Array(chunk),
idx*chunkSize)});delete this._bufferChunks[synSerial];return bufferContents.buffer}else return null}async _onMessage(event){try{const arrayBuffer=this._checkChunk(event.data);if(arrayBuffer){const browserEncodedFrame=_BrowserEncodedFrame__WEBPACK_IMPORTED_MODULE_0__["default"].create(arrayBuffer);if(this.resource)this.resource.ack(browserEncodedFrame.serial);await this._checkBufferState(browserEncodedFrame)}}catch(e){console.error(e)}}_onError(event){}destroy(){this._blobTransferResource.release();
this.resource=null}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserEncodedFrame});var _BrowserEncodedFrameFragment__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(41);var _BrowserEncodingTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(42);var _BrowserEncodingTypes__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_BrowserEncodingTypes__WEBPACK_IMPORTED_MODULE_1__);
var _Size__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(14);class BrowserEncodedFrame{static create(buffer){const dataView=new window.DataView(buffer);let offset=0;const serial=dataView.getUint32(offset,true);offset+=4;const encodingType=_BrowserEncodingTypes__WEBPACK_IMPORTED_MODULE_1___default.a[dataView.getUint16(offset,true)];offset+=2;const encodingOptions=dataView.getUint16(offset,true);offset+=2;const width=dataView.getUint16(offset,true);offset+=2;const height=dataView.getUint16(offset,
true);offset+=2;const encodedFragmentElements=dataView.getUint32(offset,true);offset+=4;const encodedFragments=[];for(let i=0;i<encodedFragmentElements;i++){const fragmentX=dataView.getUint16(offset,true);offset+=2;const fragmentY=dataView.getUint16(offset,true);offset+=2;const fragmentWidth=dataView.getUint16(offset,true);offset+=2;const fragmentHeight=dataView.getUint16(offset,true);offset+=2;const opaqueLength=dataView.getUint32(offset,true);offset+=4;const opaque=new Uint8Array(buffer,offset,
opaqueLength);offset+=opaqueLength;const alphaLength=dataView.getUint32(offset,true);offset+=4;const alpha=new Uint8Array(buffer,offset,alphaLength);offset+=alphaLength;encodedFragments.push(_BrowserEncodedFrameFragment__WEBPACK_IMPORTED_MODULE_0__["default"].create(encodingType,fragmentX,fragmentY,fragmentWidth,fragmentHeight,opaque,alpha))}return new BrowserEncodedFrame(serial,encodingType,encodingOptions,_Size__WEBPACK_IMPORTED_MODULE_2__["default"].create(width,height),encodedFragments)}constructor(serial,
encodingType,encodingOptions,size,fragments){this.serial=serial;this.encodingType=encodingType;this.encodingOptions=encodingOptions;this.size=size;this.fragments=fragments}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserEncodedFrameFragment});var _math_Rect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13);class BrowserEncodedFrameFragment{static create(encodingType,
fragmentX,fragmentY,fragmentWidth,fragmentHeight,opaque,alpha){const geo=_math_Rect__WEBPACK_IMPORTED_MODULE_0__["default"].create(fragmentX,fragmentY,fragmentX+fragmentWidth,fragmentY+fragmentHeight);return new BrowserEncodedFrameFragment(encodingType,geo,opaque,alpha)}constructor(encodingType,geo,opaque,alpha){this.encodingType=encodingType;this.geo=geo;this.opaque=opaque;this.alpha=alpha}}},function(module,exports){module.exports={0:"video/h264",1:"image/png",2:"image/jpeg"}},function(module,__webpack_exports__,
__webpack_require__){__webpack_require__.r(__webpack_exports__);let Module=function(Module){const FS=null;const ERRNO_CODES=null;Module=Module||{};var Module=typeof Module!=="undefined"?Module:{};Module["ENVIRONMENT"]="WEB";let moduleOverrides={};let key;for(key in Module)if(Module.hasOwnProperty(key))moduleOverrides[key]=Module[key];Module["arguments"]=[];Module["thisProgram"]="./this.program";Module["quit"]=function(status,toThrow){throw toThrow;};Module["preRun"]=[];Module["postRun"]=[];let ENVIRONMENT_IS_WEB=
false;let ENVIRONMENT_IS_WORKER=false;if(Module["ENVIRONMENT"])if(Module["ENVIRONMENT"]==="WEB")ENVIRONMENT_IS_WEB=true;else if(Module["ENVIRONMENT"]==="WORKER")ENVIRONMENT_IS_WORKER=true;else throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");else{ENVIRONMENT_IS_WEB=typeof window==="object";ENVIRONMENT_IS_WORKER=typeof importScripts==="function"}if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){Module["read"]=function shell_read(url){const xhr=new XMLHttpRequest;
xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(ENVIRONMENT_IS_WORKER)Module["readBinary"]=function readBinary(url){const xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)};Module["readAsync"]=function readAsync(url,onload,onerror){const xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function xhr_onload(){if(xhr.status==200||xhr.status==0&&xhr.response){onload(xhr.response);
return}onerror()};xhr.onerror=onerror;xhr.send(null)};if(typeof arguments!="undefined")Module["arguments"]=arguments;Module["setWindowTitle"]=function(title){document.title=title}}Module["print"]=console.log.bind(console);Module["printErr"]=console.warn.bind(console)||Module["print"];Module.print=Module["print"];Module.printErr=Module["printErr"];for(key in moduleOverrides)if(moduleOverrides.hasOwnProperty(key))Module[key]=moduleOverrides[key];moduleOverrides=undefined;const STACK_ALIGN=16;function staticAlloc(size){assert(!staticSealed);
const ret=STATICTOP;STATICTOP=STATICTOP+size+15&-16;return ret}function alignMemory(size,factor){if(!factor)factor=STACK_ALIGN;const ret=size=Math.ceil(size/factor)*factor;return ret}const functionPointers=new Array(0);const GLOBAL_BASE=1024;let ABORT=0;let EXITSTATUS=0;function assert(condition,text){if(!condition)abort("Assertion failed: "+text)}function Pointer_stringify(ptr,length){if(length===0||!ptr)return"";let hasUtf=0;let t;let i=0;while(1){t=HEAPU8[ptr+i>>0];hasUtf|=t;if(t==0&&!length)break;
i++;if(length&&i==length)break}if(!length)length=i;let ret="";if(hasUtf<128){const MAX_CHUNK=1024;let curr;while(length>0){curr=String.fromCharCode.apply(String,HEAPU8.subarray(ptr,ptr+Math.min(length,MAX_CHUNK)));ret=ret?ret+curr:curr;ptr+=MAX_CHUNK;length-=MAX_CHUNK}return ret}return UTF8ToString(ptr)}const UTF8Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):undefined;function UTF8ArrayToString(u8Array,idx){let endPtr=idx;while(u8Array[endPtr])++endPtr;if(endPtr-idx>16&&u8Array.subarray&&
UTF8Decoder)return UTF8Decoder.decode(u8Array.subarray(idx,endPtr));else{let u0,u1,u2,u3,u4,u5;let str="";while(1){u0=u8Array[idx++];if(!u0)return str;if(!(u0&128)){str+=String.fromCharCode(u0);continue}u1=u8Array[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}u2=u8Array[idx++]&63;if((u0&240)==224)u0=(u0&15)<<12|u1<<6|u2;else{u3=u8Array[idx++]&63;if((u0&248)==240)u0=(u0&7)<<18|u1<<12|u2<<6|u3;else{u4=u8Array[idx++]&63;if((u0&252)==248)u0=(u0&3)<<24|u1<<18|u2<<12|u3<<
6|u4;else{u5=u8Array[idx++]&63;u0=(u0&1)<<30|u1<<24|u2<<18|u3<<12|u4<<6|u5}}}if(u0<65536)str+=String.fromCharCode(u0);else{const ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}}}function UTF8ToString(ptr){return UTF8ArrayToString(HEAPU8,ptr)}function stringToUTF8Array(str,outU8Array,outIdx,maxBytesToWrite){if(!(maxBytesToWrite>0))return 0;const startIdx=outIdx;const endIdx=outIdx+maxBytesToWrite-1;for(let i=0;i<str.length;++i){let u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+
((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127){if(outIdx>=endIdx)break;outU8Array[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;outU8Array[outIdx++]=192|u>>6;outU8Array[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;outU8Array[outIdx++]=224|u>>12;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}else if(u<=2097151){if(outIdx+3>=endIdx)break;outU8Array[outIdx++]=240|u>>18;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=
128|u&63}else if(u<=67108863){if(outIdx+4>=endIdx)break;outU8Array[outIdx++]=248|u>>24;outU8Array[outIdx++]=128|u>>18&63;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}else{if(outIdx+5>=endIdx)break;outU8Array[outIdx++]=252|u>>30;outU8Array[outIdx++]=128|u>>24&63;outU8Array[outIdx++]=128|u>>18&63;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}}outU8Array[outIdx]=0;return outIdx-startIdx}function stringToUTF8(str,
outPtr,maxBytesToWrite){return stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite)}function lengthBytesUTF8(str){let len=0;for(let i=0;i<str.length;++i){let u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127)++len;else if(u<=2047)len+=2;else if(u<=65535)len+=3;else if(u<=2097151)len+=4;else if(u<=67108863)len+=5;else len+=6}return len}const UTF16Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf-16le"):undefined;function allocateUTF8(str){const size=
lengthBytesUTF8(str)+1;const ret=_malloc(size);if(ret)stringToUTF8Array(str,HEAP8,ret,size);return ret}const PAGE_SIZE=16384;const WASM_PAGE_SIZE=65536;const ASMJS_PAGE_SIZE=16777216;function alignUp(x,multiple){if(x%multiple>0)x+=multiple-x%multiple;return x}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function updateGlobalBuffer(buf){Module["buffer"]=buffer=buf}function updateGlobalBufferViews(){Module["HEAP8"]=HEAP8=new Int8Array(buffer);Module["HEAP16"]=HEAP16=new Int16Array(buffer);
Module["HEAP32"]=HEAP32=new Int32Array(buffer);Module["HEAPU8"]=HEAPU8=new Uint8Array(buffer);Module["HEAPU16"]=HEAPU16=new Uint16Array(buffer);Module["HEAPU32"]=HEAPU32=new Uint32Array(buffer);Module["HEAPF32"]=HEAPF32=new Float32Array(buffer);Module["HEAPF64"]=HEAPF64=new Float64Array(buffer)}var STATIC_BASE,STATICTOP,staticSealed;let STACK_BASE,STACKTOP,STACK_MAX;let DYNAMIC_BASE,DYNAMICTOP_PTR;STATIC_BASE=STATICTOP=STACK_BASE=STACKTOP=STACK_MAX=DYNAMIC_BASE=DYNAMICTOP_PTR=0;staticSealed=false;
function abortOnCannotGrowMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+TOTAL_MEMORY+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function enlargeMemory(){abortOnCannotGrowMemory()}const TOTAL_STACK=Module["TOTAL_STACK"]||5242880;var TOTAL_MEMORY=Module["TOTAL_MEMORY"]||
16777216;if(TOTAL_MEMORY<TOTAL_STACK)Module.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+TOTAL_MEMORY+"! (TOTAL_STACK="+TOTAL_STACK+")");if(Module["buffer"])buffer=Module["buffer"];else{if(typeof window.WebAssembly==="object"&&typeof window.WebAssembly.Memory==="function"){Module["wasmMemory"]=new window.WebAssembly.Memory({"initial":TOTAL_MEMORY/WASM_PAGE_SIZE,"maximum":TOTAL_MEMORY/WASM_PAGE_SIZE});buffer=Module["wasmMemory"].buffer}else buffer=new ArrayBuffer(TOTAL_MEMORY);Module["buffer"]=
buffer}updateGlobalBufferViews();function getTotalMemory(){return TOTAL_MEMORY}HEAP32[0]=1668509029;HEAP16[1]=25459;if(HEAPU8[2]!==115||HEAPU8[3]!==99)throw"Runtime error: expected the system to be little-endian!";function callRuntimeCallbacks(callbacks){while(callbacks.length>0){let callback=callbacks.shift();if(typeof callback=="function"){callback();continue}let func=callback.func;if(typeof func==="number")if(callback.arg===undefined)Module["dynCall_v"](func);else Module["dynCall_vi"](func,callback.arg);
else func(callback.arg===undefined?null:callback.arg)}}const __ATPRERUN__=[];const __ATINIT__=[];const __ATMAIN__=[];const __ATEXIT__=[];const __ATPOSTRUN__=[];let runtimeInitialized=false;let runtimeExited=false;function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length)addOnPreRun(Module["preRun"].shift())}callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){if(runtimeInitialized)return;runtimeInitialized=
true;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__);runtimeExited=true}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length)addOnPostRun(Module["postRun"].shift())}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}function writeAsciiToMemory(str,
buffer,dontAddNull){for(let i=0;i<str.length;++i)HEAP8[buffer++>>0]=str.charCodeAt(i);if(!dontAddNull)HEAP8[buffer>>0]=0}const Math_abs=Math.abs;const Math_cos=Math.cos;const Math_sin=Math.sin;const Math_tan=Math.tan;const Math_acos=Math.acos;const Math_asin=Math.asin;const Math_atan=Math.atan;const Math_atan2=Math.atan2;const Math_exp=Math.exp;const Math_log=Math.log;const Math_sqrt=Math.sqrt;const Math_ceil=Math.ceil;const Math_floor=Math.floor;const Math_pow=Math.pow;const Math_imul=Math.imul;
const Math_fround=Math.fround;const Math_round=Math.round;const Math_min=Math.min;const Math_max=Math.max;const Math_clz32=Math.clz32;const Math_trunc=Math.trunc;let runDependencies=0;let runDependencyWatcher=null;let dependenciesFulfilled=null;function addRunDependency(id){runDependencies++;if(Module["monitorRunDependencies"])Module["monitorRunDependencies"](runDependencies)}function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"])Module["monitorRunDependencies"](runDependencies);
if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){const callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["preloadedImages"]={};Module["preloadedAudios"]={};const dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(filename){return String.prototype.startsWith?filename.startsWith(dataURIPrefix):filename.indexOf(dataURIPrefix)===0}function integrateWasmJS(){let wasmTextFile=
"libxkbcommon.wast";let wasmBinaryFile="libxkbcommon.wasm";let asmjsCodeFile="libxkbcommon.temp.asm.js";if(typeof Module["locateFile"]==="function"){if(!isDataURI(wasmTextFile))wasmTextFile=Module["locateFile"](wasmTextFile);if(!isDataURI(wasmBinaryFile))wasmBinaryFile=Module["locateFile"](wasmBinaryFile);if(!isDataURI(asmjsCodeFile))asmjsCodeFile=Module["locateFile"](asmjsCodeFile)}const wasmPageSize=64*1024;const info={"global":null,"env":null,"asm2wasm":{"f64-rem":function(x,y){return x%y},"debugger":function(){debugger}},
"parent":Module};let exports=null;function mergeMemory(newBuffer){const oldBuffer=Module["buffer"];if(newBuffer.byteLength<oldBuffer.byteLength)Module["printErr"]("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here");const oldView=new Int8Array(oldBuffer);const newView=new Int8Array(newBuffer);newView.set(oldView);updateGlobalBuffer(newBuffer);updateGlobalBufferViews()}function fixImports(imports){return imports}function getBinary(){try{if(Module["wasmBinary"])return new Uint8Array(Module["wasmBinary"]);
if(Module["readBinary"])return Module["readBinary"](wasmBinaryFile);else throw"on the web, we need the wasm binary to be preloaded and set on Module['wasmBinary']. emcc.py will do that for you when generating HTML (but not JS)";}catch(err){abort(err)}}function getBinaryPromise(){if(!Module["wasmBinary"]&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&typeof fetch==="function")return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(!response["ok"])throw"failed to load wasm binary file at '"+
wasmBinaryFile+"'";return response["arrayBuffer"]()}).catch(function(){return getBinary()});return new Promise(function(resolve,reject){resolve(getBinary())})}function doNativeWasm(global,env,providedBuffer){if(typeof window.WebAssembly!=="object"){Module["printErr"]("no native wasm support detected");return false}if(!(Module["wasmMemory"]instanceof window.WebAssembly.Memory)){Module["printErr"]("no native wasm Memory in use");return false}env["memory"]=Module["wasmMemory"];info["global"]={"NaN":NaN,
"Infinity":Infinity};info["global.Math"]=Math;info["env"]=env;function receiveInstance(instance,module){exports=instance.exports;if(exports.memory)mergeMemory(exports.memory);Module["asm"]=exports;Module["usingWasm"]=true;removeRunDependency("wasm-instantiate")}addRunDependency("wasm-instantiate");if(Module["instantiateWasm"])try{return Module["instantiateWasm"](info,receiveInstance)}catch(e){Module["printErr"]("Module.instantiateWasm callback failed with error: "+e);return false}function receiveInstantiatedSource(output){receiveInstance(output["instance"],
output["module"])}function instantiateArrayBuffer(receiver){getBinaryPromise().then(function(binary){return window.WebAssembly.instantiate(binary,info)}).then(receiver).catch(function(reason){Module["printErr"]("failed to asynchronously prepare wasm: "+reason);abort(reason)})}if(!Module["wasmBinary"]&&typeof window.WebAssembly.instantiateStreaming==="function"&&!isDataURI(wasmBinaryFile)&&typeof fetch==="function")window.WebAssembly.instantiateStreaming(fetch(wasmBinaryFile,{credentials:"same-origin"}),
info).then(receiveInstantiatedSource).catch(function(reason){Module["printErr"]("wasm streaming compile failed: "+reason);Module["printErr"]("falling back to ArrayBuffer instantiation");instantiateArrayBuffer(receiveInstantiatedSource)});else instantiateArrayBuffer(receiveInstantiatedSource);return{}}Module["asmPreload"]=Module["asm"];const asmjsReallocBuffer=Module["reallocBuffer"];const wasmReallocBuffer=function(size){const PAGE_MULTIPLE=Module["usingWasm"]?WASM_PAGE_SIZE:ASMJS_PAGE_SIZE;size=
alignUp(size,PAGE_MULTIPLE);const old=Module["buffer"];const oldSize=old.byteLength;if(Module["usingWasm"])try{const result=Module["wasmMemory"].grow((size-oldSize)/wasmPageSize);if(result!==(-1|0))return Module["buffer"]=Module["wasmMemory"].buffer;else return null}catch(e){return null}};Module["reallocBuffer"]=function(size){if(finalMethod==="asmjs")return asmjsReallocBuffer(size);else return wasmReallocBuffer(size)};var finalMethod="";Module["asm"]=function(global,env,providedBuffer){env=fixImports(env);
if(!env["table"]){let TABLE_SIZE=Module["wasmTableSize"];if(TABLE_SIZE===undefined)TABLE_SIZE=1024;const MAX_TABLE_SIZE=Module["wasmMaxTableSize"];if(typeof window.WebAssembly==="object"&&typeof window.WebAssembly.Table==="function")if(MAX_TABLE_SIZE!==undefined)env["table"]=new window.WebAssembly.Table({"initial":TABLE_SIZE,"maximum":MAX_TABLE_SIZE,"element":"anyfunc"});else env["table"]=new window.WebAssembly.Table({"initial":TABLE_SIZE,element:"anyfunc"});else env["table"]=new Array(TABLE_SIZE);
Module["wasmTable"]=env["table"]}if(!env["memoryBase"])env["memoryBase"]=Module["STATIC_BASE"];if(!env["tableBase"])env["tableBase"]=0;let exports;exports=doNativeWasm(global,env,providedBuffer);if(!exports)abort("no binaryen method succeeded. consider enabling more options, like interpreting, if you want that: https://github.com/kripken/emscripten/wiki/WebAssembly#binaryen-methods");return exports}}integrateWasmJS();STATIC_BASE=GLOBAL_BASE;STATICTOP=STATIC_BASE+101600;__ATINIT__.push();const STATIC_BUMP=
101600;Module["STATIC_BASE"]=STATIC_BASE;Module["STATIC_BUMP"]=STATIC_BUMP;STATICTOP+=16;function ___assert_fail(condition,filename,line,func){abort("Assertion failed: "+Pointer_stringify(condition)+", at: "+[filename?Pointer_stringify(filename):"unknown filename",line,func?Pointer_stringify(func):"unknown function"])}function ___lock(){}const SYSCALLS={varargs:0,get:function(varargs){SYSCALLS.varargs+=4;const ret=HEAP32[SYSCALLS.varargs-4>>2];return ret},getStr:function(){const ret=Pointer_stringify(SYSCALLS.get());
return ret},get64:function(){const low=SYSCALLS.get(),high=SYSCALLS.get();if(low>=0)assert(high===0);else assert(high===-1);return low},getZero:function(){assert(SYSCALLS.get()===0)}};function ___syscall140(which,varargs){SYSCALLS.varargs=varargs;try{const stream=SYSCALLS.getStreamFromFD(),offset_high=SYSCALLS.get(),offset_low=SYSCALLS.get(),result=SYSCALLS.get(),whence=SYSCALLS.get();const offset=offset_low;FS.llseek(stream,offset,whence);HEAP32[result>>2]=stream.position;if(stream.getdents&&offset===
0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall145(which,varargs){SYSCALLS.varargs=varargs;try{const stream=SYSCALLS.getStreamFromFD(),iov=SYSCALLS.get(),iovcnt=SYSCALLS.get();return SYSCALLS.doReadv(stream,iov,iovcnt)}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall146(which,varargs){SYSCALLS.varargs=varargs;try{const stream=SYSCALLS.get(),
iov=SYSCALLS.get(),iovcnt=SYSCALLS.get();let ret=0;if(!___syscall146.buffers){___syscall146.buffers=[null,[],[]];___syscall146.printChar=function(stream,curr){const buffer=___syscall146.buffers[stream];assert(buffer);if(curr===0||curr===10){(stream===1?Module["print"]:Module["printErr"])(UTF8ArrayToString(buffer,0));buffer.length=0}else buffer.push(curr)}}for(let i=0;i<iovcnt;i++){const ptr=HEAP32[iov+i*8>>2];const len=HEAP32[iov+(i*8+4)>>2];for(let j=0;j<len;j++)___syscall146.printChar(stream,HEAPU8[ptr+
j]);ret+=len}return ret}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall192(which,varargs){SYSCALLS.varargs=varargs;try{const addr=SYSCALLS.get(),len=SYSCALLS.get(),prot=SYSCALLS.get(),flags=SYSCALLS.get(),fd=SYSCALLS.get();let off=SYSCALLS.get();off<<=12;let ptr;let allocated=false;if(fd===-1){ptr=_memalign(PAGE_SIZE,len);if(!ptr)return-ERRNO_CODES.ENOMEM;_memset(ptr,0,len);allocated=true}else{let info=FS.getStream(fd);if(!info)return-ERRNO_CODES.EBADF;
const res=FS.mmap(info,HEAPU8,addr,len,off,prot,flags);ptr=res.ptr;allocated=res.allocated}SYSCALLS.mappings[ptr]={malloc:ptr,len:len,allocated:allocated,fd:fd,flags:flags};return ptr}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall195(which,varargs){SYSCALLS.varargs=varargs;try{const path=SYSCALLS.getStr(),buf=SYSCALLS.get();return SYSCALLS.doStat(FS.stat,path,buf)}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);
return-e.errno}}function ___syscall197(which,varargs){SYSCALLS.varargs=varargs;try{const stream=SYSCALLS.getStreamFromFD(),buf=SYSCALLS.get();return SYSCALLS.doStat(FS.stat,stream.path,buf)}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___setErrNo(value){if(Module["___errno_location"])HEAP32[Module["___errno_location"]()>>2]=value;return value}function ___syscall221(which,varargs){SYSCALLS.varargs=varargs;try{return 0}catch(e){if(typeof FS===
"undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall5(which,varargs){SYSCALLS.varargs=varargs;try{const pathname=SYSCALLS.getStr(),flags=SYSCALLS.get(),mode=SYSCALLS.get();const stream=FS.open(pathname,flags,mode);return stream.fd}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall54(which,varargs){SYSCALLS.varargs=varargs;try{return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);
return-e.errno}}function ___syscall6(which,varargs){SYSCALLS.varargs=varargs;try{const stream=SYSCALLS.getStreamFromFD();FS.close(stream);return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___syscall91(which,varargs){SYSCALLS.varargs=varargs;try{const addr=SYSCALLS.get(),len=SYSCALLS.get();let info=SYSCALLS.mappings[addr];if(!info)return 0;if(len===info.len){const stream=FS.getStream(info.fd);SYSCALLS.doMsync(addr,stream,len,info.flags);FS.munmap(stream);
SYSCALLS.mappings[addr]=null;if(info.allocated)_free(info.malloc)}return 0}catch(e){if(typeof FS==="undefined"||!(e instanceof FS.ErrnoError))abort(e);return-e.errno}}function ___unlock(){}function _abort(){Module["abort"]()}const _environ=STATICTOP;STATICTOP+=16;function ___buildEnvironment(env){const MAX_ENV_VALUES=64;const TOTAL_ENV_SIZE=1024;let poolPtr;let envPtr;if(!___buildEnvironment.called){___buildEnvironment.called=true;ENV["USER"]=ENV["LOGNAME"]="web_user";ENV["PATH"]="/";ENV["PWD"]="/";
ENV["HOME"]="/home/web_user";ENV["LANG"]="C.UTF-8";ENV["_"]=Module["thisProgram"];poolPtr=staticAlloc(TOTAL_ENV_SIZE);envPtr=staticAlloc(MAX_ENV_VALUES*4);HEAP32[envPtr>>2]=poolPtr;HEAP32[_environ>>2]=envPtr}else{envPtr=HEAP32[_environ>>2];poolPtr=HEAP32[envPtr>>2]}const strings=[];let totalSize=0;for(let key in env)if(typeof env[key]==="string"){var line=key+"="+env[key];strings.push(line);totalSize+=line.length}if(totalSize>TOTAL_ENV_SIZE)throw new Error("Environment size exceeded TOTAL_ENV_SIZE!");
const ptrSize=4;for(let i=0;i<strings.length;i++){var line=strings[i];writeAsciiToMemory(line,poolPtr);HEAP32[envPtr+i*ptrSize>>2]=poolPtr;poolPtr+=line.length+1}HEAP32[envPtr+strings.length*ptrSize>>2]=0}var ENV={};function _getenv(name){if(name===0)return 0;name=Pointer_stringify(name);if(!ENV.hasOwnProperty(name))return 0;if(_getenv.ret)_free(_getenv.ret);_getenv.ret=allocateUTF8(ENV[name]);return _getenv.ret}function _emscripten_memcpy_big(dest,src,num){HEAPU8.set(HEAPU8.subarray(src,src+num),
dest);return dest}___buildEnvironment(ENV);DYNAMICTOP_PTR=staticAlloc(4);STACK_BASE=STACKTOP=alignMemory(STATICTOP);STACK_MAX=STACK_BASE+TOTAL_STACK;DYNAMIC_BASE=alignMemory(STACK_MAX);HEAP32[DYNAMICTOP_PTR>>2]=DYNAMIC_BASE;staticSealed=true;Module["wasmTableSize"]=58;Module["wasmMaxTableSize"]=58;Module.asmGlobalArg={};Module.asmLibraryArg={"abort":abort,"enlargeMemory":enlargeMemory,"getTotalMemory":getTotalMemory,"abortOnCannotGrowMemory":abortOnCannotGrowMemory,"___assert_fail":___assert_fail,
"___lock":___lock,"___setErrNo":___setErrNo,"___syscall140":___syscall140,"___syscall145":___syscall145,"___syscall146":___syscall146,"___syscall192":___syscall192,"___syscall195":___syscall195,"___syscall197":___syscall197,"___syscall221":___syscall221,"___syscall5":___syscall5,"___syscall54":___syscall54,"___syscall6":___syscall6,"___syscall91":___syscall91,"___unlock":___unlock,"_abort":_abort,"_emscripten_memcpy_big":_emscripten_memcpy_big,"_getenv":_getenv,"DYNAMICTOP_PTR":DYNAMICTOP_PTR,"STACKTOP":STACKTOP};
const asm=Module["asm"](Module.asmGlobalArg,Module.asmLibraryArg,buffer);Module["asm"]=asm;var _free=Module["_free"]=function(){return Module["asm"]["_free"].apply(null,arguments)};var _malloc=Module["_malloc"]=function(){return Module["asm"]["_malloc"].apply(null,arguments)};var _memalign=Module["_memalign"]=function(){return Module["asm"]["_memalign"].apply(null,arguments)};var _memset=Module["_memset"]=function(){return Module["asm"]["_memset"].apply(null,arguments)};const _xkb_context_new=Module["_xkb_context_new"]=
function(){return Module["asm"]["_xkb_context_new"].apply(null,arguments)};const _xkb_keymap_get_as_string=Module["_xkb_keymap_get_as_string"]=function(){return Module["asm"]["_xkb_keymap_get_as_string"].apply(null,arguments)};const _xkb_keymap_new_from_string=Module["_xkb_keymap_new_from_string"]=function(){return Module["asm"]["_xkb_keymap_new_from_string"].apply(null,arguments)};const _xkb_state_new=Module["_xkb_state_new"]=function(){return Module["asm"]["_xkb_state_new"].apply(null,arguments)};
const _xkb_state_serialize_layout=Module["_xkb_state_serialize_layout"]=function(){return Module["asm"]["_xkb_state_serialize_layout"].apply(null,arguments)};const _xkb_state_serialize_mods=Module["_xkb_state_serialize_mods"]=function(){return Module["asm"]["_xkb_state_serialize_mods"].apply(null,arguments)};const _xkb_state_update_key=Module["_xkb_state_update_key"]=function(){return Module["asm"]["_xkb_state_update_key"].apply(null,arguments)};Module["asm"]=asm;Module["Pointer_stringify"]=Pointer_stringify;
Module["stringToUTF8"]=stringToUTF8;Module["lengthBytesUTF8"]=lengthBytesUTF8;Module["then"]=function(func){if(Module["calledRun"])func(Module);else{const old=Module["onRuntimeInitialized"];Module["onRuntimeInitialized"]=function(){if(old)old();func(Module)}}return Module};function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}ExitStatus.prototype=new Error;ExitStatus.prototype.constructor=ExitStatus;let initialStackTop;dependenciesFulfilled=
function runCaller(){if(!Module["calledRun"])run();if(!Module["calledRun"])dependenciesFulfilled=runCaller};function run(args){args=args||Module["arguments"];if(runDependencies>0)return;preRun();if(runDependencies>0)return;if(Module["calledRun"])return;function doRun(){if(Module["calledRun"])return;Module["calledRun"]=true;if(ABORT)return;ensureInitRuntime();preMain();if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");
setTimeout(function(){setTimeout(function(){Module["setStatus"]("")},1);doRun()},1)}else doRun()}Module["run"]=run;function exit(status,implicit){if(implicit&&Module["noExitRuntime"]&&status===0)return;if(Module["noExitRuntime"]);else{ABORT=true;EXITSTATUS=status;STACKTOP=initialStackTop;exitRuntime();if(Module["onExit"])Module["onExit"](status)}Module["quit"](status,new ExitStatus(status))}Module["exit"]=exit;function abort(what){if(Module["onAbort"])Module["onAbort"](what);if(what!==undefined){Module.print(what);
Module.printErr(what);what=JSON.stringify(what)}else what="";ABORT=true;EXITSTATUS=1;throw"abort("+what+"). Build with -s ASSERTIONS=1 for more info.";}Module["abort"]=abort;if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0)Module["preInit"].pop()()}Module["noExitRuntime"]=true;run();return Module};__webpack_exports__["default"]=Module()},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserRtcPeerConnectionFactory});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(37);var _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);
var _BrowserRtcPeerConnection__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45);class BrowserRtcPeerConnectionFactory extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(){return new BrowserRtcPeerConnectionFactory}constructor(){super(_protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default.a.RtcPeerConnectionFactory.name,1)}bindClient(client,id,version){const rtcPeerConnectionFactoryResource=new _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default.a.RtcPeerConnectionFactory(client,
id,version);rtcPeerConnectionFactoryResource.implementation=this}createRtcPeerConnection(resource,id){const rtcPeerConnectionResource=new _protocol_rtc_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default.a.RtcPeerConnection(resource.client,id,resource.version);_BrowserRtcPeerConnection__WEBPACK_IMPORTED_MODULE_2__["default"].create(rtcPeerConnectionResource)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);(function(process){__webpack_require__.d(__webpack_exports__,
"default",function(){return BrowserRtcPeerConnection});var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);var _BrowserRtcBlobTransfer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(47);class BrowserRtcPeerConnection{static create(rtcPeerConnectionResource){const browserRtcPeerConnection=
new BrowserRtcPeerConnection(rtcPeerConnectionResource);rtcPeerConnectionResource.implementation=browserRtcPeerConnection;return browserRtcPeerConnection}constructor(rtcPeerConnectionResource){this.rtcPeerConnectionResource=rtcPeerConnectionResource;this._delegate=null;this._peerConnectionResolve=null;this._peerConnectionPromise=new Promise((resolve)=>{this._peerConnectionResolve=resolve})}createBlobTransfer(resource,id,descriptor){const blobTransferResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrBlobTransfer"](resource.client,
id,resource.version);_BrowserRtcBlobTransfer__WEBPACK_IMPORTED_MODULE_1__["default"]._create(blobTransferResource,descriptor,this)}onPeerConnection(){return this._peerConnectionPromise}async ensureP2S(){if(this._delegate&&this._delegate._peerConnection)return;else if(this._delegate&&!this._delegate._peerConnection)throw new Error("Rtc peer connection already initialized in P2P mode.");this._delegate={_peerConnection:new window.RTCPeerConnection,clientIceCandidates:async(resource,description)=>{try{const signal=
JSON.parse(description);false&&console.log(`webrtc received remote ice candidate`);await this._delegate._peerConnection.addIceCandidate(new window.RTCIceCandidate(signal.candidate))}catch(error){console.error(error,error.stack)}},clientSdpReply:async(resource,description)=>{try{const signal=JSON.parse(description);false&&console.log(`webrtc received remote sdp answer`);await this._delegate._peerConnection.setRemoteDescription(new window.RTCSessionDescription(signal.sdp))}catch(error){console.error(error,
error.stack)}},clientSdpOffer:async(resource,description)=>{try{const signal=JSON.parse(description);false&&console.log(`webrtc received remote sdp offer`);await this._delegate._peerConnection.setRemoteDescription(new window.RTCSessionDescription(signal.sdp));const desc=await this._delegate._peerConnection.createAnswer();await this._delegate._peerConnection.setLocalDescription(desc);false&&console.log(`Child ${process.pid} webrtc sending local sdp answer`);await this.rtcPeerConnectionResource.serverSdpReply(JSON.stringify({"sdp":this._delegate._peerConnection.localDescription}))}catch(error){console.error(error,
error.stack)}}};false&&console.log(`webrtc created new peer connection with connection state: ${this._delegate._peerConnection.connectionState}`);this._delegate._peerConnection.onconnectionstatechange=()=>{false&&console.log(`webrtc peer connection connection state changed to: ${this._delegate._peerConnection.connectionState}`)};this._delegate._peerConnection.onicecandidate=(evt)=>{if(evt.candidate!==null){false&&console.log(`webrtc sending local ice candide`);this.rtcPeerConnectionResource.serverIceCandidates(JSON.stringify({"candidate":evt.candidate}))}};
this._delegate._peerConnection.onnegotiationneeded=()=>{false&&console.log(`webrtc negotiation needed`);this._sendOffer()};this._peerConnectionResolve(this._delegate._peerConnection)}async _sendOffer(){try{const desc=await this._delegate._peerConnection.createOffer({offerToReceiveAudio:false,offerToReceiveVideo:false,voiceActivityDetection:false,iceRestart:false});await this._delegate._peerConnection.setLocalDescription(desc);false&&console.log(`webrtc sending local sdp offer`);this.rtcPeerConnectionResource.serverSdpOffer(JSON.stringify({"sdp":this._delegate._peerConnection.localDescription}))}catch(error){console.error(error,
error.stack)}}ensureP2P(otherRtcPeerConnectionResource){if(this._delegate&&this._delegate._peerConnection)throw new Error("Rtc peer connection already initialized in P2S mode.");else if(this._delegate&&this._delegate.otherRtcPeerConnectionResource!==otherRtcPeerConnectionResource)throw new Error("Rtc peer connection already initialized with another peer.");else if(this._delegate&&this._delegate.otherRtcPeerConnectionResource===otherRtcPeerConnectionResource)return;this._delegate={otherRtcPeerConnectionResource:otherRtcPeerConnectionResource,
clientIceCandidates:(resource,description)=>{this._delegate.otherRtcPeerConnectionResource.serverIceCandidates(description)},clientSdpReply:(resource,description)=>{this._delegate.otherRtcPeerConnectionResource.serverSdpReply(description)},clientSdpOffer:(resource,description)=>{this._delegate.otherRtcPeerConnectionResource.serverSdpOffer(description)}};this.rtcPeerConnectionResource.init()}clientIceCandidates(resource,description){this._delegate.clientIceCandidates(resource,description)}clientSdpReply(resource,
description){this._delegate.clientSdpReply(resource,description)}clientSdpOffer(resource,description){this._delegate.clientSdpOffer(resource,description)}}}).call(this,__webpack_require__(46))},function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined");}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined");}(function(){try{if(typeof setTimeout==="function")cachedSetTimeout=
setTimeout;else cachedSetTimeout=defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function")cachedClearTimeout=clearTimeout;else cachedClearTimeout=defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,
0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=
[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue)return;draining=false;if(currentQueue.length)queue=currentQueue.concat(queue);else queueIndex=-1;if(queue.length)drainQueue()}function drainQueue(){if(draining)return;var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len)if(currentQueue)currentQueue[queueIndex].run();queueIndex=-1;len=queue.length}currentQueue=
null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args));if(queue.length===1&&!draining)runTimeout(drainQueue)};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions=
{};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported");};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported");};process.umask=function(){return 0}},
function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserRtcBlobTransfer});class BrowserRtcBlobTransfer{static _create(resource,blobDescriptor,browserRtcPeerConnection){const descriptorObj=JSON.parse(blobDescriptor);const browserRtcBlobTransfer=new BrowserRtcBlobTransfer(resource,descriptorObj,browserRtcPeerConnection);resource.implementation=browserRtcBlobTransfer;const blobTransferEntry=
this._blobTransferEntries[descriptorObj.label];if(blobTransferEntry)blobTransferEntry.resolve(browserRtcBlobTransfer);return browserRtcBlobTransfer}static _uuidv4(){return([1E7]+-1E3+-4E3+-8E3+-1E11).replace(/[018]/g,(c)=>(c^window.crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16))}static get(blobDescriptor){const descriptorObj=JSON.parse(blobDescriptor);const blobTransferEntry=this._blobTransferEntries[descriptorObj.label];if(blobTransferEntry)return blobTransferEntry.promise;else return null}static createDescriptor(reliable,
binaryType){const label=this._uuidv4();const blobTransferEntry={promise:null,resolve:null};blobTransferEntry.promise=new Promise((resolve)=>{blobTransferEntry.resolve=resolve});this._blobTransferEntries[label]=blobTransferEntry;return JSON.stringify({negotiated:true,maxRetransmits:reliable?null:0,id:-1,ordered:reliable,label:label,binaryType:binaryType})}constructor(resource,descriptorObj,browserRtcPeerConnection){this.resource=resource;this._descriptorObj=descriptorObj;this.browserRtcPeerConnection=
browserRtcPeerConnection;this._dataChannel=null;this._dataChannelResolve=null;this._dataChannelReject=null;this._dataChannelPromise=new Promise((resolve,reject)=>{this._dataChannelResolve=resolve;this._dataChannelReject=reject});this._peerConnectionPromise=null}open(){if(!this._peerConnectionPromise){this._peerConnectionPromise=this.browserRtcPeerConnection.onPeerConnection();this._peerConnectionPromise.then((peerConnection)=>{const dataChannelInitDict=Object.assign({},this._descriptorObj);const label=
dataChannelInitDict.label;const binaryType=dataChannelInitDict.binaryType;delete dataChannelInitDict.label;delete dataChannelInitDict.binaryType;this._dataChannel=peerConnection.createDataChannel(label,dataChannelInitDict);this._dataChannel.binaryType=binaryType;this._dataChannel.onopen=()=>{this._dataChannelResolve(this._dataChannel)}}).catch((error)=>{this._dataChannelReject(error)})}return this._dataChannelPromise}closeAndSeal(){if(this._dataChannelPromise)this._dataChannelPromise=null;if(this.resource){this.resource.release();
this.resource=null}if(this._dataChannel){this._dataChannel.close();this._dataChannel=null}}close(resource){this.closeAndSeal()}}BrowserRtcBlobTransfer._blobTransferEntries={}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserShell});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=
__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _BrowserShellSurface__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(49);class BrowserShell extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(browserSession,
userShell){return new BrowserShell(browserSession,userShell)}constructor(browserSession,userShell){super(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrShell"].name,1);this.browserSession=browserSession;this.userShell=userShell}bindClient(client,id,version){const grShellResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrShell"](client,id,version);grShellResource.implementation=this}getShellSurface(resource,id,surface){if(surface.implementation.role);
const grShellSurfaceResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrShellSurface"](resource.client,id,resource.version);_BrowserShellSurface__WEBPACK_IMPORTED_MODULE_2__["default"].create(grShellSurfaceResource,surface,this.browserSession,this.userShell)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserShellSurface});var _math_Point__WEBPACK_IMPORTED_MODULE_0__=
__webpack_require__(12);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _render_Renderer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(18);var _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(50);const {bottom,bottomLeft,bottomRight,left,none,right,top,topLeft,
topRight}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrShellSurface"].Resize;const {inactive}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrShellSurface"].Transient;const SurfaceStates={MAXIMIZED:"maximized",FULLSCREEN:"fullscreen",POPUP:"popup",TRANSIENT:"transient",TOP_LEVEL:"top_level"};class BrowserShellSurface extends _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_3__["default"]{static create(grShellSurfaceResource,grSurfaceResource,browserSession,
userShell){const browserShellSurface=new BrowserShellSurface(grShellSurfaceResource,grSurfaceResource,browserSession,userShell);grShellSurfaceResource.implementation=browserShellSurface;grSurfaceResource.onDestroy().then(()=>{grShellSurfaceResource.destroy()});grSurfaceResource.implementation.role=browserShellSurface;browserShellSurface._doPing(grShellSurfaceResource);grShellSurfaceResource.onDestroy().then(()=>{browserShellSurface._unmap();browserShellSurface._userShellSurface.destroy()});return browserShellSurface}constructor(grShellSurfaceResource,
grSurfaceResource,browserSession,userShell){super();this.resource=grShellSurfaceResource;this.grSurfaceResource=grSurfaceResource;this._title="";this._clazz="";this.state=null;this.browserSession=browserSession;this._userShell=userShell;this._pingTimeoutActive=false;this._userShellSurface=null;this._timeoutTimer=0;this._mapped=false}async onCommit(browserSurface,renderFrame,newState){const oldPosition=browserSurface.browserSurfaceChildSelf.position;browserSurface.browserSurfaceChildSelf.position=
_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(oldPosition.x+newState.dx,oldPosition.y+newState.dy);if(newState.bufferContents){if(!this._mapped)this._map()}else if(this._mapped)this._unmap();await browserSurface.render(renderFrame,newState);renderFrame.fire();await renderFrame;this.browserSession.flush()}_map(){this._mapped=true;if(this._userShellSurface)this._userShellSurface.mapped=true}_unmap(){this._mapped=false;if(this._userShellSurface)this._userShellSurface.mapped=false}pong(resource,
serial){if(this._pingTimeoutActive){this._removeClassRecursively(this.grSurfaceResource.implementation,"fadeToUnresponsive");this._pingTimeoutActive=false}window.clearTimeout(this._timeoutTimer);const doPingTimer=window.setTimeout(()=>{this._doPing(resource)},1E3);this.grSurfaceResource.onDestroy().then(()=>{window.clearTimeout(doPingTimer)})}_doPing(resource){this._timeoutTimer=window.setTimeout(()=>{if(!this._pingTimeoutActive){this._pingTimeoutActive=true;this._addClassRecursively(this.grSurfaceResource.implementation,
"fadeToUnresponsive")}},3E3);this.grSurfaceResource.onDestroy().then(()=>{window.clearTimeout(this._timeoutTimer)});resource.ping(0);this.browserSession.flush()}_removeClassRecursively(browserSurface,cssClass){browserSurface.browserSurfaceViews.forEach((view)=>{view.bufferedCanvas.removeCssClass(cssClass)});browserSurface.browserSurfaceChildren.forEach((browserSurfaceChild)=>{if(browserSurfaceChild.browserSurface!==browserSurface)this._removeClassRecursively(browserSurfaceChild.browserSurface,cssClass)})}_addClassRecursively(browserSurface,
cssClass){browserSurface.browserSurfaceViews.forEach((view)=>{view.bufferedCanvas.addCssClass(cssClass)});browserSurface.browserSurfaceChildren.forEach((browserSurfaceChild)=>{if(browserSurfaceChild.browserSurface!==browserSurface)this._addClassRecursively(browserSurfaceChild.browserSurface,cssClass)})}move(resource,seat,serial){if(this.state===SurfaceStates.FULLSCREEN||this.state===SurfaceStates.MAXIMIZED)return;const browserSeat=seat.implementation;const browserPointer=browserSeat.browserPointer;
const browserSurface=this.grSurfaceResource.implementation;const browserSurfaceChildSelf=browserSurface.browserSurfaceChildSelf;const origPosition=browserSurfaceChildSelf.position;if(browserSeat.serial===serial){const pointerX=browserPointer.x;const pointerY=browserPointer.y;const moveListener=()=>{const deltaX=browserPointer.x-pointerX;const deltaY=browserPointer.y-pointerY;browserSurfaceChildSelf.position=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(origPosition.x+deltaX,origPosition.y+
deltaY);const renderFrame=_render_Renderer__WEBPACK_IMPORTED_MODULE_2__["default"].createRenderFrame();browserSurface.browserSurfaceViews.forEach((view)=>{view.applyTransformations(renderFrame)});renderFrame.fire()};browserPointer.onButtonRelease().then(()=>{browserPointer.removeMouseMoveListener(moveListener)});browserPointer.addMouseMoveListener(moveListener)}}resize(resource,seat,serial,edges){if(this.state===SurfaceStates.FULLSCREEN||this.state===SurfaceStates.MAXIMIZED)return;const browserSeat=
seat.implementation;const browserPointer=browserSeat.browserPointer;if(browserSeat.serial===serial){let sizeAdjustment=(width,height,deltaX,deltaY)=>{};switch(edges){case bottomRight:{sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width+deltaX,h:height+deltaY}};break}case top:{sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width,h:height-deltaY}};break}case bottom:{sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width,h:height+deltaY}};break}case left:{sizeAdjustment=(width,
height,deltaX,deltaY)=>{return{w:width-deltaX,h:height}};break}case topLeft:{sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width-deltaX,h:height-deltaY}};break}case bottomLeft:{sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width-deltaX,h:height+deltaY}};break}case right:{sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width+deltaX,h:height}};break}case topRight:{sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width+deltaX,h:height-deltaY}};break}case none:default:{sizeAdjustment=
(width,height,deltaX,deltaY)=>{return{w:width,h:height}};break}}const pointerX=browserPointer.x;const pointerY=browserPointer.y;const {w:surfaceWidth,h:surfaceHeight}=this.grSurfaceResource.implementation.size;const resizeListener=()=>{const deltaX=browserPointer.x-pointerX;const deltaY=browserPointer.y-pointerY;const size=sizeAdjustment(surfaceWidth,surfaceHeight,deltaX,deltaY);this.resource.configure(edges,size.w,size.h)};browserPointer.onButtonRelease().then(()=>{browserPointer.removeMouseMoveListener(resizeListener)});
browserPointer.addMouseMoveListener(resizeListener)}}_createUserShellSurface(){this._userShellSurface=this._userShell.manage(this.grSurfaceResource.implementation);this._userShellSurface.onActivationRequest=()=>{this._userShellSurface.activationAck()};this._userShellSurface.onInactive=()=>{};this._userShellSurface.title=this._title;this._userShellSurface.appId=this._clazz;this._userShellSurface.mapped=this._mapped}setToplevel(resource){if(this.state===SurfaceStates.POPUP||this.state===SurfaceStates.TRANSIENT)return;
if(!this._userShellSurface)this._createUserShellSurface();this.state=SurfaceStates.TOP_LEVEL}setTransient(resource,parent,x,y,flags){if(this.state===SurfaceStates.POPUP||this.state===SurfaceStates.TOP_LEVEL)return;const parentPosition=parent.implementation.browserSurfaceChildSelf.position;const browserSurface=this.grSurfaceResource.implementation;const browserSurfaceChild=browserSurface.browserSurfaceChildSelf;browserSurfaceChild.position=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(parentPosition.x+
x,parentPosition.y+y);this.grSurfaceResource.implementation.hasKeyboardInput=(flags&inactive)===0;if(!this._userShellSurface)this._createUserShellSurface();this.state=SurfaceStates.TRANSIENT}setFullscreen(resource,method,framerate,output){this.state=SurfaceStates.FULLSCREEN;const browserSurface=this.grSurfaceResource.implementation;browserSurface.browserSurfaceChildSelf.position=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,0);this.resource.configure(none,window.innerWidth,window.innerHeight)}async setPopup(resource,
seat,serial,parent,x,y,flags){if(this.state)return;const browserSeat=seat.implementation;const browserPointer=browserSeat.browserPointer;if(browserSeat.serial===serial){this.state=SurfaceStates.POPUP;const browserSurface=this.grSurfaceResource.implementation;const browserSurfaceChild=browserSurface.browserSurfaceChildSelf;browserSurfaceChild.position=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(x,y);const onNewView=(view)=>{const renderFrame=_render_Renderer__WEBPACK_IMPORTED_MODULE_2__["default"].createRenderFrame();
view.applyTransformations(renderFrame);renderFrame.fire();view.onDestroy().then(()=>{view.detach()})};const views=parent.implementation.addChild(browserSurfaceChild);views.forEach(onNewView);browserSurface.onViewCreated=onNewView;this.grSurfaceResource.implementation.hasKeyboardInput=(flags&inactive)===0;await browserPointer.popupGrab(this.grSurfaceResource);resource.popupDone()}}setMaximized(resource,output){this.state=SurfaceStates.MAXIMIZED;const browserSurface=this.grSurfaceResource.implementation;
const x=0;const {height:y}=this._userShell.panel.getBoundingClientRect();const {width,height}=this._userShell.workspace.getBoundingClientRect();browserSurface.browserSurfaceChildSelf.position=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(x,y);this.resource.configure(none,width,height)}setTitle(resource,title){this._title=title;if(this._userShellSurface)this._userShellSurface.title=title}setClass(resource,clazz){this._clazz=clazz;if(this._userShellSurface)this._userShellSurface.appId=
clazz}captureRoleState(){}setRoleState(roleState){}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserSurfaceRole});class BrowserSurfaceRole{onCommit(browserSurface,renderFrame,newState){}captureRoleState(){}setRoleState(roleState){}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,
"default",function(){return BrowserSeat});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);
var _BrowserPointer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(52);var _BrowserKeyboard__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(53);var _BrowserTouch__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(55);var _BrowserDataDevice__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(56);const {keyboard,pointer,touch}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrSeat"].Capability;class BrowserSeat extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(browserSession){const browserDataDevice=
_BrowserDataDevice__WEBPACK_IMPORTED_MODULE_5__["default"].create();const browserKeyboard=_BrowserKeyboard__WEBPACK_IMPORTED_MODULE_3__["default"].create(browserSession,browserDataDevice);const browserPointer=_BrowserPointer__WEBPACK_IMPORTED_MODULE_2__["default"].create(browserSession,browserDataDevice,browserKeyboard);const browserTouch=_BrowserTouch__WEBPACK_IMPORTED_MODULE_4__["default"].create();const hasTouch="ontouchstart"in document.documentElement;const browserSeat=new BrowserSeat(browserDataDevice,
browserPointer,browserKeyboard,browserTouch,hasTouch);browserDataDevice.browserSeat=browserSeat;browserKeyboard.browserSeat=browserSeat;browserPointer.browserSeat=browserSeat;browserTouch.browserSeat=browserSeat;return browserSeat}constructor(browserDataDevice,browserPointer,browserKeyboard,browserTouch,hasTouch){super(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrSeat"].name,6);this.browserDataDevice=browserDataDevice;this.browserPointer=browserPointer;this.browserKeyboard=
browserKeyboard;this.browserTouch=browserTouch;this.hasTouch=hasTouch;this.resources=[];this._seatName="browser-seat0";this.serial=0;this._keyboardResourceListeners=[]}bindClient(client,id,version){const grSeatResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrSeat"](client,id,version);grSeatResource.implementation=this;this.resources.push(grSeatResource);grSeatResource.onDestroy().then((resource)=>{const index=this.resources.indexOf(resource);this.resources.splice(index,
1)});this._emitCapabilities(grSeatResource);this._emitName(grSeatResource)}_emitCapabilities(grSeatResource){let caps=pointer|keyboard;if(this.hasTouch)caps|=touch;grSeatResource.capabilities(caps)}_emitName(grSeatResource){if(grSeatResource.version>=2)grSeatResource.name(this._seatName)}nextSerial(){return++this.serial}getPointer(resource,id){const grPointerResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrPointer"](resource.client,id,resource.version);grPointerResource.implementation=
this.browserPointer;this.browserPointer.resources.push(grPointerResource);grPointerResource.onDestroy().then(()=>{const idx=this.browserPointer.resources.indexOf(grPointerResource);if(idx>-1)this.browserPointer.resources.splice(idx,1)})}getKeyboard(resource,id){const grKeyboardResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrKeyboard"](resource.client,id,resource.version);grKeyboardResource.implementation=this.browserKeyboard;this.browserKeyboard.resources.push(grKeyboardResource);
grKeyboardResource.onDestroy().then(()=>{const idx=this.browserKeyboard.resources.indexOf(grKeyboardResource);if(idx>-1)this.browserKeyboard.resources.splice(idx,1)});this.browserKeyboard.emitKeymap(grKeyboardResource);this.browserKeyboard.emitKeyRepeatInfo(grKeyboardResource);this._keyboardResourceListeners.forEach((listener)=>listener(grKeyboardResource))}addKeyboardResourceListener(listener){this._keyboardResourceListeners.push(listener)}removeKeyboardResourceListener(listener){const idx=this._keyboardResourceListeners.indexOf(listener);
if(idx>-1)this._keyboardResourceListeners.splice(idx,1)}getTouch(resource,id){if(this.hasTouch){const grTouchResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrTouch"](resource.client,id,resource.version);grTouchResource.implementation=this.browserTouch;this.browserTouch.resources.push(grTouchResource)}else;}release(resource){resource.destroy();const index=this.resources.indexOf(resource);if(index>-1)this.resources.splice(index,1)}}},function(module,__webpack_exports__,
__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserPointer});var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);var _math_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);var _BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__=
__webpack_require__(22);var _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(50);const {pressed,released}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrPointer"].ButtonState;const {horizontalScroll,verticalScroll}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrPointer"].Axis;const {wheel}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrPointer"].AxisSource;const linuxInput={0:272,1:274,2:273,3:278,4:277};class BrowserPointer extends _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_3__["default"]{static create(browserSession,
browserDataDevice){const browserPointer=new BrowserPointer(browserDataDevice);document.addEventListener("mousemove",(event)=>{if(browserPointer._handleMouseMove(event)){event.preventDefault();event.stopPropagation()}browserSession.flush()});document.addEventListener("mouseup",(event)=>{if(browserPointer._handleMouseUp(event)){event.preventDefault();event.stopPropagation()}browserSession.flush()});document.addEventListener("mousedown",(event)=>{if(browserPointer._handleMouseDown(event)){event.preventDefault();
event.stopPropagation()}browserSession.flush()});document.addEventListener("wheel",(event)=>{if(browserPointer._handleWheel(event)){event.preventDefault();event.stopPropagation()}browserSession.flush()});return browserPointer}constructor(browserDataDevice){super();this._browserDataDevice=browserDataDevice;this.resources=[];this.focus=null;this.grab=null;this._popupStack=[];this.x=0;this.y=0;this._cursorSurface=null;this._view=null;this._cursorDestroyListener=()=>{this._cursorSurface=null;this.setDefaultCursor()};
this._btnDwnCount=0;this._mouseMoveListeners=[];this.hotspotX=0;this.hotspotY=0;this._buttonPressPromise=null;this._buttonPressResolve=null;this._buttonReleasePromise=null;this._buttonReleaseResolve=null;this.browserSeat=null}onButtonPress(){if(!this._buttonPressPromise)this._buttonPressPromise=(new Promise((resolve)=>{this._buttonPressResolve=resolve})).then(()=>{this._buttonPressPromise=null;this._buttonPressResolve=null});return this._buttonPressPromise}onButtonRelease(){if(!this._buttonReleasePromise)this._buttonReleasePromise=
(new Promise((resolve)=>{this._buttonReleaseResolve=resolve})).then(()=>{this._buttonReleasePromise=null;this._buttonReleaseResolve=null});return this._buttonReleasePromise}async onCommit(browserSurface,renderFrame,newState){this.hotspotX-=newState.dx;this.hotspotY-=newState.dy;const hotspotX=this.hotspotX;const hotspotY=this.hotspotY;if(this._cursorSurface&&this._cursorSurface.implementation===browserSurface)if(newState.bufferContents){const fullFrame=_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__["default"].fullFrame(newState.bufferContents.encodingOptions);
const splitAlpha=_BrowserEncodingOptions__WEBPACK_IMPORTED_MODULE_2__["default"].splitAlpha(newState.bufferContents.encodingOptions);if(fullFrame&&!splitAlpha){await browserSurface.render(renderFrame,newState,true);const imageBlob=new window.Blob([newState.bufferContents.fragments[0].opaque],{"type":newState.bufferContents.encodingType});window.document.body.style.cursor=`url("${window.URL.createObjectURL(imageBlob)}") ${hotspotX} ${hotspotY}, pointer`;renderFrame.fire();await renderFrame}else{await browserSurface.render(renderFrame,
newState);const dataURL=this._view.bufferedCanvas.frontContext.canvas.toDataURL();window.document.body.style.cursor=`url("${dataURL}") ${hotspotX} ${hotspotY}, pointer`;renderFrame.fire();await renderFrame}}browserSurface.browserSession.flush()}setCursor(resource,serial,surface,hotspotX,hotspotY){if(this._browserDataDevice.dndSourceClient)return;if(serial!==this.browserSeat.serial)return;this.setCursorInternal(surface,hotspotX,hotspotY)}popupGrab(popup){let popupGrab=this.findPopupGrab(popup);if(this.findPopupGrab(popup))return popupGrab.promise;
let popupGrabEndResolve=null;let popupGrabEndPromise=new Promise((resolve)=>{popup.onDestroy().then(()=>{resolve()});popupGrabEndResolve=resolve});popupGrab={popup:popup,resolve:popupGrabEndResolve,promise:popupGrabEndPromise};this._popupStack.push(popupGrab);popupGrabEndPromise.then(()=>{const popupGrabIdx=this._popupStack.indexOf(popupGrab);if(popupGrabIdx>-1){const nestedPopupGrabs=this._popupStack.slice(popupGrabIdx);this._popupStack.splice(popupGrabIdx);nestedPopupGrabs.shift();nestedPopupGrabs.reverse().forEach((nestedPopupGrab)=>
{nestedPopupGrab.resolve()})}});this.grab=null;this._btnDwnCount=0;return popupGrabEndPromise}findPopupGrab(popup){const popupGrab=this._popupStack.find((popupGrab)=>{return popupGrab.popup===popup});return popupGrab||null}setCursorInternal(surface,hotspotX,hotspotY){this.hotspotX=hotspotX;this.hotspotY=hotspotY;if(this._cursorSurface){this._cursorSurface.removeDestroyListener(this._cursorDestroyListener);this._cursorSurface.implementation.role=null}this._cursorSurface=surface;if(surface){const browserSurface=
surface.implementation;if(browserSurface.role&&browserSurface.role!==this)return;if(this._view)this._view.destroy();this._view=browserSurface.createView();browserSurface.resource.addDestroyListener(this._cursorDestroyListener);browserSurface.role=this;browserSurface.inputRegion=null;browserSurface._pendingInputRegion=null}else window.document.body.style.cursor="none"}release(resource){resource.destroy();const index=this.resources.indexOf(resource);if(index>-1)this.resources.splice(index,1)}addMouseMoveListener(func){this._mouseMoveListeners.push(func)}removeMouseMoveListener(func){const index=
this._mouseMoveListeners.indexOf(func);if(index>-1)this._mouseMoveListeners.splice(index,1)}_focusFromEvent(event){const focusCandidate=event.target;if(focusCandidate.view&&!focusCandidate.view.destroyed&&focusCandidate.view.browserSurface&&focusCandidate.view.browserSurface.hasPointerInput)return focusCandidate.view;return null}_handleMouseMove(event){let consumed=false;this.x=event.clientX<0?0:event.clientX;this.y=event.clientY<0?0:event.clientY;let currentFocus=this._focusFromEvent(event);const nroPopups=
this._popupStack.length;if(nroPopups&&currentFocus&&currentFocus.browserSurface.resource.client!==this._popupStack[nroPopups-1].popup.client)currentFocus=null;if(this._browserDataDevice.dndSourceClient){this._browserDataDevice.onMouseMotion(currentFocus);return true}if(!this.grab)if(currentFocus!==this.focus){this.unsetFocus();if(currentFocus)this.setFocus(currentFocus);else this.setDefaultCursor()}this._mouseMoveListeners.forEach((listener)=>listener(this.focus));if(this.focus&&this.focus.browserSurface){consumed=
true;const surfacePoint=this._calculateSurfacePoint(this.focus);const surfaceResource=this.focus.browserSurface.resource;this._doPointerEventFor(surfaceResource,(pointerResource)=>{pointerResource.motion(event.timeStamp,Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["parseFixed"])(surfacePoint.x),Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["parseFixed"])(surfacePoint.y));if(pointerResource.version>=5)pointerResource.frame()})}return consumed}_doPointerEventFor(surfaceResource,
action){this.resources.forEach((pointerResource)=>{if(pointerResource.client===surfaceResource.client)action(pointerResource)})}_handleMouseUp(event){let consumed=false;if(this._browserDataDevice.dndSourceClient){this._browserDataDevice.onMouseUp();return true}const nroPopups=this._popupStack.length;if(this.focus&&this.focus.browserSurface){consumed=true;if(this.grab||nroPopups){const surfaceResource=this.focus.browserSurface.resource;this._doPointerEventFor(surfaceResource,(pointerResource)=>{pointerResource.button(this.browserSeat.nextSerial(),
event.timeStamp,linuxInput[event.button],released);if(pointerResource.version>=5)pointerResource.frame()})}if(this.grab){this._btnDwnCount--;if(this._btnDwnCount===0)this.grab=null}}else if(nroPopups){const focus=this._focusFromEvent(event);const popupGrab=this._popupStack[nroPopups-1];if(!focus||popupGrab.popup.implementation.state.bufferContents&&focus.browserSurface.resource.client!==popupGrab.popup.client)popupGrab.resolve()}if(this._buttonReleaseResolve)this._buttonReleaseResolve(event);return consumed}_handleMouseDown(event){let consumed=
this._handleMouseMove(event);if(this.focus&&this.focus.browserSurface){consumed=true;if(this.grab===null&&this._popupStack.length===0)this.grab=this.focus;if(!this._popupStack.length)this._btnDwnCount++;const surfaceResource=this.focus.browserSurface.resource;this._doPointerEventFor(surfaceResource,(pointerResource)=>{pointerResource.button(this.browserSeat.nextSerial(),event.timeStamp,linuxInput[event.button],pressed);if(pointerResource.version>=5)pointerResource.frame()})}if(this._buttonPressResolve)this._buttonPressResolve(event);
return consumed}_calculateSurfacePoint(browserSurfaceView){const mousePoint=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(this.x,this.y);return browserSurfaceView.toSurfaceSpace(mousePoint)}_isPointerWithinInputRegion(canvas){if(canvas.view){const browserSurfaceView=canvas.view;const surfacePoint=this._calculateSurfacePoint(browserSurfaceView);return browserSurfaceView.browserSurface.isWithinInputRegion(surfacePoint)}else return false}calculateFocus(){const focusCandidates=window.document.elementsFromPoint(this.x,
this.y);let zOrder=-1;let focus={view:null};focusCandidates.forEach((focusCandidate)=>{if(focusCandidate.view&&!focusCandidate.view.destroyed&&focusCandidate.view.browserSurface&&focusCandidate.view.browserSurface.hasPointerInput&&this._isPointerWithinInputRegion(focusCandidate)&&window.parseInt(focusCandidate.style.zIndex)>zOrder){zOrder=focusCandidate.style.zIndex;focus=focusCandidate}});return focus.view}setFocus(newFocus){this.focus=newFocus;const surfaceResource=this.focus.browserSurface.resource;
newFocus.onDestroy().then(()=>{if(!this.focus)return;if(newFocus!==this.focus)return;const focus=this.calculateFocus();if(focus)this.setFocus(focus);else{this.unsetFocus();this.setDefaultCursor()}});const surfacePoint=this._calculateSurfacePoint(newFocus);this._doPointerEventFor(surfaceResource,(pointerResource)=>{pointerResource.enter(this.browserSeat.nextSerial(),surfaceResource,Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["parseFixed"])(surfacePoint.x),Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["parseFixed"])(surfacePoint.y))})}unsetFocus(){if(this.focus&&
!this.focus.destroyed&&this.focus.browserSurface){const surfaceResource=this.focus.browserSurface.resource;this._doPointerEventFor(surfaceResource,(pointerResource)=>{pointerResource.leave(this.browserSeat.nextSerial(),surfaceResource);if(pointerResource.version>=5)pointerResource.frame()})}this.focus=null;this.grab=null;this.view=null;this._btnDwnCount=0;if(this._cursorSurface){this._cursorSurface.implementation.role=null;this._cursorSurface=null}}setDefaultCursor(){window.document.body.style.cursor=
"auto"}_handleWheel(event){let consumed=false;if(this.focus&&this.focus.browserSurface){consumed=true;let deltaTransform;switch(event.deltaMode){case event.DOM_DELTA_LINE:{deltaTransform=(delta)=>{return delta*18};break}case event.DOM_DELTA_PAGE:{deltaTransform=(delta,axis)=>{if(axis===verticalScroll)return delta*this.focus.browserSurface.size.h;else return delta*this.focus.browserSurface.size.w};break}case event.DOM_DELTA_PIXEL:default:{deltaTransform=(delta)=>{return delta};break}}const surfaceResource=
this.focus.browserSurface.resource;this._doPointerEventFor(surfaceResource,(pointerResource)=>{const deltaX=event.deltaX;if(deltaX){const xAxis=horizontalScroll;if(pointerResource.version>=5)pointerResource.axisDiscrete(xAxis,deltaX);const scrollAmount=deltaTransform(deltaX,xAxis);pointerResource.axis(event.timeStamp,xAxis,Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["parseFixed"])(scrollAmount))}const deltaY=event.deltaY;if(deltaY){const yAxis=verticalScroll;if(pointerResource.version>=
5)pointerResource.axisDiscrete(yAxis,deltaY);const scrollAmount=deltaTransform(deltaY,yAxis);pointerResource.axis(event.timeStamp,yAxis,Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["parseFixed"])(scrollAmount))}if(pointerResource.version>=5){pointerResource.axisSource(wheel);pointerResource.frame()}})}return consumed}captureRoleState(){}setRoleState(roleState){}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,
"default",function(){return BrowserKeyboard});var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);var _BrowserXkb__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(54);var _BrowserRtcBlobTransfer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(47);const {pressed,released}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrKeyboard"].KeyState;
const {xkbV1}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrKeyboard"].KeymapFormat;class BrowserKeyboard{static create(browserSession,browserDataDevice){const browserKeyboard=new BrowserKeyboard(browserDataDevice);browserKeyboard.updateKeymap("qwerty.xkb");document.addEventListener("keyup",(event)=>{if(browserKeyboard._handleKey(event,false)){event.preventDefault();event.stopPropagation()}browserSession.flush()});document.addEventListener("keydown",(event)=>{if(browserKeyboard._handleKey(event,
true)){event.preventDefault();event.stopPropagation()}browserSession.flush()});return browserKeyboard}constructor(browserDataDevice){this._browserDataDevice=browserDataDevice;this.resources=[];this._browserXkb=null;this._focus=null;this._keys=[];this._keyboardFocusListeners=[];this._keyboardFocusResolve=null;this._keyboardFocusPromise=null;this.browserSeat=null}addKeyboardFocusListener(listener){this._keyboardFocusListeners.push(listener)}removeKeyboardFocusListener(listener){const idx=this._keyboardFocusListeners.indexOf(listener);
if(idx>0)this._keyboardFocusListeners.splice(idx,1)}onKeyboardFocusChanged(){if(!this._keyboardFocusPromise)this._keyboardFocusPromise=(new Promise((resolve)=>{this._keyboardFocusResolve=resolve})).then(()=>{this._keyboardFocusPromise=null;this._keyboardFocusResolve=null});return this._keyboardFocusPromise}release(resource){resource.destroy();const index=this.resources.indexOf(resource);if(index>-1)this.resources.splice(index,1)}async updateKeymap(keymapFileName){const browserXkb=await _BrowserXkb__WEBPACK_IMPORTED_MODULE_1__["default"].createFromResource(keymapFileName);
if(this._browserXkb);this._browserXkb=browserXkb;this.resources.forEach(async(resource)=>{await this.emitKeymap(resource)})}async emitKeymap(resource){const keymapString=this._browserXkb.asString();const textEncoder=new window.TextEncoder("utf-8");const keymapBuffer=textEncoder.encode(keymapString);const keymapBufferLength=keymapBuffer.buffer.byteLength;const blobDescriptor=_BrowserRtcBlobTransfer__WEBPACK_IMPORTED_MODULE_2__["default"].createDescriptor(true,"arraybuffer");resource.keymap(xkbV1,blobDescriptor,
keymapBufferLength);const browserRtcBlobTransfer=await _BrowserRtcBlobTransfer__WEBPACK_IMPORTED_MODULE_2__["default"].get(blobDescriptor);browserRtcBlobTransfer.browserRtcPeerConnection.ensureP2S();const rtcDataChannel=await browserRtcBlobTransfer.open();const maxChunkSize=16*1E3;if(keymapBufferLength>maxChunkSize){const nroChunks=Math.ceil(keymapBufferLength/maxChunkSize);for(let i=0;i<nroChunks;i++){const chunk=keymapBuffer.slice(i*maxChunkSize,(i+1)*maxChunkSize);rtcDataChannel.send(chunk.buffer)}}else rtcDataChannel.send(keymapBuffer.buffer)}focusGained(focus){if(!focus.hasKeyboardInput||
this.focus===focus)return;if(this.focus)this.focusLost();if(focus){this.focus=focus;this._browserDataDevice.onKeyboardFocusGained(focus);focus.resource.onDestroy().then(()=>{if(this.focus===focus)this.focus=null});const serial=this.browserSeat.nextSerial();const surface=this.focus.resource;const keys=(new Uint8Array(this._keys)).buffer;this.resources.filter((resource)=>{return resource.client===this.focus.resource.client}).forEach((resource)=>{resource.enter(serial,surface,keys)});if(this._keyboardFocusResolve)this._keyboardFocusResolve();
this._keyboardFocusListeners.forEach((listener)=>{listener()})}}focusLost(){if(this.focus){const serial=this.browserSeat.nextSerial();const surface=this.focus.resource;this.resources.filter((resource)=>{return resource.client===this.focus.resource.client}).forEach((resource)=>{resource.leave(serial,surface)});this.focus=null}}set focus(browserSurface){this._focus=browserSurface;if(this._keyboardFocusResolve)this._keyboardFocusResolve();this._keyboardFocusListeners.forEach((listener)=>{listener()})}get focus(){return this._focus}_handleKey(event,
down){let consumed=false;const keyCode=event.code;const linuxKeyCode=_BrowserXkb__WEBPACK_IMPORTED_MODULE_1__["default"].linuxKeycode[keyCode];if(down&&this._keys.includes(linuxKeyCode))return false;const modsUpdate=down?this._browserXkb.keyDown(linuxKeyCode):this._browserXkb.keyUp(linuxKeyCode);if(down)this._keys.push(linuxKeyCode);else{const index=this._keys.indexOf(linuxKeyCode);if(index>-1)this._keys.splice(index,1)}if(this.focus){consumed=true;const serial=this.browserSeat.nextSerial();const time=
event.timeStamp;const evdevKeyCode=linuxKeyCode-8;const state=down?pressed:released;const modsDepressed=this._browserXkb.modsDepressed;const modsLatched=this._browserXkb.modsLatched;const modsLocked=this._browserXkb.modsLocked;const group=this._browserXkb.group;this.resources.filter((resource)=>{return resource.client===this.focus.resource.client}).forEach((resource)=>{resource.key(serial,time,evdevKeyCode,state);if(modsUpdate)resource.modifiers(serial,modsDepressed,modsLatched,modsLocked,group)})}return consumed}emitKeyRepeatInfo(resource){if(resource.version>=
4)resource.repeatInfo(40,400)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserXkb});var _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(43);const XKB_KEYMAP_FORMAT_TEXT_V1=1;const XKB_CONTEXT_NO_DEFAULT_INCLUDES=1<<0;const XKB_CONTEXT_NO_ENVIRONMENT_NAMES=1<<1;const XKB_KEYMAP_COMPILE_NO_FLAGS=0;const XKB_KEY_UP=0;const XKB_KEY_DOWN=1;const XKB_STATE_MODS_DEPRESSED=
1<<0;const XKB_STATE_MODS_LATCHED=1<<1;const XKB_STATE_MODS_LOCKED=1<<2;const XKB_STATE_LAYOUT_EFFECTIVE=1<<7;class BrowserXkb{static createFromResource(resource){return new Promise((resolve,reject)=>{const xhr=new window.XMLHttpRequest;xhr.onreadystatechange=()=>{if(xhr.readyState===window.XMLHttpRequest.DONE&&xhr.status===200){const mappingFile=xhr.responseText;try{const browserXkb=BrowserXkb.create(mappingFile);resolve(browserXkb)}catch(error){reject(error)}}};xhr.open("GET",`/keymaps/${resource}`);
xhr.send()})}static create(keymapLayout){const keymapLayoutPtr=_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._malloc(_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"].lengthBytesUTF8(keymapLayout)+1);_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"].stringToUTF8(keymapLayout,keymapLayoutPtr,_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"].lengthBytesUTF8(keymapLayout)+1);const xkbContext=_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_context_new(XKB_CONTEXT_NO_DEFAULT_INCLUDES|
XKB_CONTEXT_NO_ENVIRONMENT_NAMES);const keymap=_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_keymap_new_from_string(xkbContext,keymapLayoutPtr,XKB_KEYMAP_FORMAT_TEXT_V1,XKB_KEYMAP_COMPILE_NO_FLAGS);const state=_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_state_new(keymap);_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._free(keymapLayoutPtr);return new BrowserXkb(xkbContext,keymap,state)}constructor(xkbContext,keymap,state){this.xkbContext=xkbContext;this.keymap=
keymap;this.state=state;this._stateComponentMask=0}asString(){const keymapStringPtr=_lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_keymap_get_as_string(this.keymap,XKB_KEYMAP_FORMAT_TEXT_V1);return _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"].Pointer_stringify(keymapStringPtr)}keyUp(linuxKeyCode){return _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_state_update_key(this.state,linuxKeyCode,XKB_KEY_UP)!==0}keyDown(linuxKeyCode){return _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_state_update_key(this.state,
linuxKeyCode,XKB_KEY_DOWN)!==0}get modsDepressed(){return _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_state_serialize_mods(this.state,XKB_STATE_MODS_DEPRESSED)}get modsLatched(){return _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_state_serialize_mods(this.state,XKB_STATE_MODS_LATCHED)}get modsLocked(){return _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_state_serialize_mods(this.state,XKB_STATE_MODS_LOCKED)}get group(){return _lib_libxkbcommon__WEBPACK_IMPORTED_MODULE_0__["default"]._xkb_state_serialize_layout(this.state,
XKB_STATE_LAYOUT_EFFECTIVE)}}BrowserXkb.linuxKeycode={"Escape":9,"Digit1":10,"Digit2":11,"Digit3":12,"Digit4":13,"Digit5":14,"Digit6":15,"Digit7":16,"Digit8":17,"Digit9":18,"Digit0":19,"Minus":20,"Equal":21,"Backspace":22,"Tab":23,"KeyQ":24,"KeyW":25,"KeyE":26,"KeyR":27,"KeyT":28,"KeyY":29,"KeyU":30,"KeyI":31,"KeyO":32,"KeyP":33,"BracketLeft":34,"BracketRight":35,"Enter":36,"ControlLeft":37,"KeyA":38,"KeyS":39,"KeyD":40,"KeyF":41,"KeyG":42,"KeyH":43,"KeyJ":44,"KeyK":45,"KeyL":46,"Semicolon":47,"Quote":48,
"Backquote":49,"ShiftLeft":50,"Backslash":51,"KeyZ":52,"KeyX":53,"KeyC":54,"KeyV":55,"KeyB":56,"KeyN":57,"KeyM":58,"Comma":59,"Period":60,"Slash":61,"ShiftRight":62,"NumpadMultiply":63,"AltLeft":64,"Space":65,"CapsLock":66,"F1":67,"F2":68,"F3":69,"F4":70,"F5":71,"F6":72,"F7":73,"F8":74,"F9":75,"F10":76,"NumLock":77,"ScrollLock":78,"Numpad7":79,"Numpad8":80,"Numpad9":81,"NumpadSubtract":82,"Numpad4":83,"Numpad5":84,"Numpad6":85,"NumpadAdd":86,"Numpad1":87,"Numpad2":88,"Numpad3":89,"Numpad0":90,"NumpadDecimal":91,
"IntlBackslash":94,"F11":95,"F12":96,"IntlRo":97,"Convert":100,"KanaMode":101,"NonConvert":102,"NumpadEnter":104,"ControlRight":105,"NumpadDivide":106,"PrintScreen":107,"AltRight":108,"Home":110,"ArrowUp":111,"PageUp":112,"ArrowLeft":113,"ArrowRight":114,"End":115,"ArrowDown":116,"PageDown":117,"Insert":118,"Delete":119,"NumpadEqual":125,"Pause":127,"IntlYen":132,"OSLeft":133,"OSRight":134,"ContextMenu":135}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserTouch});class BrowserTouch{static create(){return new BrowserTouch}constructor(){this.resources=[];this.browserSeat=null}release(resource){resource.destroy();const index=this.resources.indexOf(resource);if(index>-1)this.resources.splice(index,1)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserDataDevice});
var _math_Point__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _BrowserDataOffer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(57);const DndAction=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrDataDeviceManager"].DndAction;
class BrowserDataDevice{static create(){return new BrowserDataDevice}constructor(){this.resources=[];this.browserSeat=null;this.dndSource=null;this.selectionSource=null;this.dndFocus=null;this.dndSourceClient=null;this._selectionFocus=null;this._dndSourceDestroyListener=()=>{this._handleDndSourceDestroy()};this._selectionSourceDestroyListener=()=>{this._handleSelectionSourceDestroy()}}_dataDeviceForClient(client){const dataDeviceResource=this.resources.find((dataDeviceResource)=>{return dataDeviceResource.client===
client});return dataDeviceResource==null?null:dataDeviceResource}_handleDndSourceDestroy(){const dataDeviceResource=this._dataDeviceForClient(this.dndSourceClient);if(dataDeviceResource===null)return;dataDeviceResource.leave();this.dndSourceClient=null}_handleSelectionSourceDestroy(){if(this._selectionFocus===null)return;const surfaceResource=this._selectionFocus.resource;const client=surfaceResource.client;const dataDeviceResource=this._dataDeviceForClient(client);if(dataDeviceResource==null)return;
dataDeviceResource.selection(null);this.selectionSource=null}startDrag(resource,source,origin,icon,serial){const browserPointer=this.browserSeat.browserPointer;if(this.browserSeat.serial!==serial)return;if(browserPointer.grab.browserSurface.resource!==origin)return;const dndFocus=browserPointer.focus;browserPointer.unsetFocus();if(icon!==null)browserPointer.setCursorInternal(icon,0,0);this.dndSourceClient=resource.client;if(this.dndSource)this.dndSource.removeDestroyListener(this._dndSourceDestroyListener);
this.dndSource=source;if(this.dndSource)this.dndSource.addDestroyListener(this._dndSourceDestroyListener);if(dndFocus)this._onFocusGained(dndFocus)}onMouseMotion(focus){if(this.dndFocus!==focus){if(this.dndFocus)this._onFocusLost();if(focus)this._onFocusGained(focus)}this.dndFocus=focus;if(!this.dndFocus)return;const surfaceResource=this.dndFocus.browserSurface.resource;const client=surfaceResource.client;if(this.dndSource===null&&client!==this.dndSourceClient)return;const browserPointer=this.browserSeat.browserPointer;
const mousePoint=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(browserPointer.x,browserPointer.y);const surfacePoint=this.dndFocus.toSurfaceSpace(mousePoint);this.resources.filter((dataDeviceResource)=>{return dataDeviceResource.client===client}).forEach((dataDeviceResource)=>{dataDeviceResource.motion(Date.now(),Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["parseFixed"])(surfacePoint.x),Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["parseFixed"])(surfacePoint.y))})}_onFocusGained(browserSurfaceView){this.dndFocus=
browserSurfaceView;if(!this.dndSourceClient)return;const surfaceResource=browserSurfaceView.browserSurface.resource;const client=surfaceResource.client;if(this.dndSource===null&&client!==this.dndSourceClient)return;const browserPointer=this.browserSeat.browserPointer;const mousePoint=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(browserPointer.x,browserPointer.y);const surfacePoint=browserSurfaceView.toSurfaceSpace(mousePoint);const serial=this.browserSeat.nextSerial();const x=Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["parseFixed"])(surfacePoint.x);
const y=Object(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["parseFixed"])(surfacePoint.y);const dataDeviceResource=this._dataDeviceForClient(client);if(dataDeviceResource===null)return;let grDataOffer=null;if(this.dndSource){grDataOffer=this._createDataOffer(this.dndSource,dataDeviceResource);grDataOffer.implementation.updateAction();this.dndSource.accepted=false}dataDeviceResource.enter(serial,surfaceResource,x,y,grDataOffer);if(grDataOffer){const dndActions=this.dndSource.implementation.dndActions;
if(grDataOffer.version>=3)grDataOffer.sourceActions(dndActions)}}_onFocusLost(){if(!this.dndSourceClient)return;const surfaceResource=this.dndFocus.browserSurface.resource;const client=surfaceResource.client;if(this.dndSource===null&&client!==this.dndSourceClient)return;const dataDeviceResource=this._dataDeviceForClient(client);if(dataDeviceResource)dataDeviceResource.leave();this.dndFocus=null}onMouseUp(){if(this.dndSource&&this.dndFocus){const surfaceResource=this.dndFocus.browserSurface.resource;
const client=surfaceResource.client;const dataDeviceResource=this._dataDeviceForClient(client);if(dataDeviceResource){if(this.dndSource.implementation.accepted&&this.dndSource.implementation.currentDndAction){dataDeviceResource.drop();if(this.dndSource.version>=3)this.dndSource.dndDropPerformed();this.dndSource.implementation.grDataOffer.implementation.inAsk=this.dndSource.currentDndAction===DndAction.ask}else if(this.dndSource&&this.dndSource.version>=3)this.dndSource.cancelled();dataDeviceResource.leave()}}this.dndSourceClient=
null;const browserPointer=this.browserSeat.browserPointer;if(this.dndFocus)browserPointer.setFocus(this.dndFocus);else browserPointer.setDefaultCursor()}_createDataOffer(source,dataDeviceResource){const offerId=dataDeviceResource.dataOffer();const browserDataOffer=_BrowserDataOffer__WEBPACK_IMPORTED_MODULE_2__["default"].create(source,offerId,dataDeviceResource);source.implementation.grDataOffer=browserDataOffer.resource;source.implementation.mimeTypes.forEach((mimeType)=>{browserDataOffer.resource.offer(mimeType)});
return browserDataOffer.resource}setSelection(resource,source,serial){if(source&&source.implementation.dndActions)return;if(this.selectionSource){this.selectionSource.removeDestroyListener(this._selectionSourceDestroyListener);this.selectionSource.cancelled()}this.selectionSource=source;if(this._selectionFocus){this.selectionSource.addDestroyListener(this._selectionSourceDestroyListener);this.onKeyboardFocusGained(this._selectionFocus)}}onKeyboardFocusGained(newSelectionFocus){this._selectionFocus=
newSelectionFocus;const surfaceResource=this._selectionFocus.resource;const client=surfaceResource.client;const dataDeviceResource=this._dataDeviceForClient(client);if(dataDeviceResource==null)return;if(this.selectionSource===null)dataDeviceResource.selection(null);else{const grDataOffer=this._createDataOffer(this.selectionSource,dataDeviceResource);dataDeviceResource.selection(grDataOffer);this.selectionSource.implementation.grDataOffer=grDataOffer}}release(resource){if(this.dndSource)this.dndSource.removeDestroyListener(this._dndSourceDestroyListener);
const index=this.resources.indexOf(resource);if(index>-1)this.resources.splice(index,1);resource.destroy()}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserDataOffer});var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);
const {copy,move,ask,none}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrDataDeviceManager"].DndAction;const ALL_ACTIONS=copy|move|ask;class BrowserDataOffer{static create(source,offerId,dataDeviceResource){const browserDataOffer=new BrowserDataOffer(source);const grDataOffer=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrDataOffer"](dataDeviceResource.client,offerId,dataDeviceResource.version);grDataOffer.implementation=browserDataOffer;browserDataOffer.resource=
grDataOffer;grDataOffer.onDestroy().then(()=>{browserDataOffer._handleDestroy()});return browserDataOffer}constructor(source){this.resource=null;this.acceptMimeType=null;this.preferredAction=null;this.dndActions=none;this.grDataSource=source;this._finished=false;this.inAsk=false}_handleDestroy(){if(!this.grDataSource)return;if(this.grDataSource.implementation.grDataOffer!==this.resource)return;if(this.resource<3)this.grDataSource.implementation.notifyFinish();else if(this.grDataSource.resource&&this.grDataSource.resource.version>=
3)this.grDataSource.resource.cancelled();this.grDataSource.implementation.grDataOffer=null}accept(resource,serial,mimeType){if(!this.grDataSource||!this.grDataSource.implementation.grDataOffer)return;if(this._finished);this.acceptMimeType=mimeType;this.grDataSource.target(mimeType);this.grDataSource.implementation.accepted=mimeType!==null}receive(resource,mimeType,fd){if(this._finished);if(this.grDataSource)this.grDataSource.send(mimeType,fd);else this.grDataSource.send("",-1)}destroy(resource){resource.destroy()}finish(resource){if(this.grDataSource||
!this.preferredAction)return;if(!this.acceptMimeType||this._finished)return;if(!this.grDataSource.implementation.accepted)return;switch(this.grDataSource.implementation.currentDndAction){case none:case ask:return;default:break}this.grDataSource.implementation.notifyFinish()}_bitCount(u){const uCount=u-(u>>1&3681400539)-(u>>2&1227133513);return(uCount+(uCount>>3)&3340530119)%63}setActions(resource,dndActions,preferredAction){if(!this.grDataSource)return;if(this._finished);if(dndActions&~ALL_ACTIONS)return;
if(preferredAction&&(!(preferredAction&dndActions)||this._bitCount(preferredAction)>1))return;this.dndActions=dndActions;this.preferredAction=preferredAction;this.updateAction()}updateAction(){if(!this.grDataSource)return;const action=this._chooseAction();if(this.grDataSource.implementation.currentDndAction===action)return;this.grDataSource.implementation.currentDndAction=action;if(this.inAsk)return;if(this.grDataSource.version>=3)this.grDataSource.action(action);if(this.resource.version>=3)this.resource.action(action)}_chooseAction(){let offerActions=
none;let preferredAction=none;if(this.resource>=3){offerActions=this.dndActions;preferredAction=this.preferredAction}else offerActions=copy;let sourceActions=none;if(this.grDataSource.version>=3)sourceActions=this.grDataSource.implementation.dndActions;else sourceActions=copy;const availableActions=offerActions&sourceActions;if(!availableActions)return none;if((preferredAction&availableActions)!==0)return preferredAction;return 1<<Math.floor(Math.log2(availableActions))-1}}},function(module,__webpack_exports__,
__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserDataDeviceManager});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=
__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _BrowserDataSource__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(59);class BrowserDataDeviceManager extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(){return new BrowserDataDeviceManager}constructor(){super(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrDataDeviceManager"].name,3)}bindClient(client,id,version){const grDataDeviceManagerResource=
new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrDataDeviceManager"](client,id,version);grDataDeviceManagerResource.implementation=this}createDataSource(resource,id){const grDataSourceResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrDataSource"](resource.client,id,resource.version);_BrowserDataSource__WEBPACK_IMPORTED_MODULE_2__["default"].create(grDataSourceResource)}getDataDevice(resource,id,seat){const grDataDeviceResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrDataDevice"](resource.client,
id,resource.version);grDataDeviceResource.implementation=seat.implementation.browserDataDevice;seat.implementation.browserDataDevice.resources.push(grDataDeviceResource)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserDataSource});var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=
__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);const {copy,move,ask,none}=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["GrDataDeviceManager"].DndAction;const ALL_ACTIONS=copy|move|ask;class BrowserDataSource{static create(grDataSource){const browserDataSource=new BrowserDataSource(grDataSource);grDataSource.implementation=browserDataSource;return browserDataSource}constructor(grDataSource){this.resource=grDataSource;this.mimeTypes=[];
this.dndActions=0;this._actionsSet=false;this.currentDndAction=none;this.accepted=false;this.grDataOffer=null}offer(resource,mimeType){this.mimeTypes.push(mimeType);if(this.grDataOffer)this.grDataOffer.offer(mimeType)}destroy(resource){resource.destroy()}setActions(resource,dndActions){if(this._actionsSet)return;if(this.dndActions&~ALL_ACTIONS)return;this.dndActions=dndActions;this._actionsSet=true}notifyFinish(){if(!this.dndActions)return;if(this.grDataOffer.implementation.inAsk&&this.resource.version>=
3)this.resource.action(this.currentDndAction);if(this.resource>=3)this.resource.dndFinished();this.grDataOffer=null}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserOutput});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);
var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);class BrowserOutput extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(){return new BrowserOutput}constructor(){super(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].name,3)}bindClient(client,
id,version){const grOutputResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"](client,id,version);grOutputResource.implementation=this;this.emitSpecs(grOutputResource)}emitSpecs(grOutputResource){this._emitGeomtry(grOutputResource);this._emitMode(grOutputResource);if(grOutputResource.version>=2)grOutputResource.done()}_emitMode(grOutputResource){const flags=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].Mode.current;const width=
Math.ceil(window.innerWidth*window.devicePixelRatio);const height=Math.ceil(window.innerHeight*window.devicePixelRatio);const refresh=60;grOutputResource.mode(flags,width,height,refresh)}_emitGeomtry(grOutputResource){const x=0;const y=0;const physicalWidth=Math.ceil(window.innerWidth*.2646);const physicalHeight=Math.ceil(window.innerHeight*.2646);const subpixel=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].Subpixel.unknown;const make="Greenfield";const model=window.navigator.userAgent;
const orientation=window.screen.orientation.type;let transform=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].Transform.normal;switch(orientation){case "portrait-primary":{transform=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].Transform.normal;break}case "portrait-secondary":{transform=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].Transform["180"];break}case "landscape-primary":{transform=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].Transform.normal;
break}case "landscape-secondary":{transform=_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrOutput"].Transform["180"];break}}grOutputResource.geometry(x,y,physicalWidth,physicalHeight,subpixel,make,model,transform)}release(resource){}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserSubcompositor});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=
__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);var _BrowserSubsurface__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(62);
class BrowserSubcompositor extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(){return new BrowserSubcompositor}constructor(){super(_protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrSubcompositor"].name,1)}bindClient(client,id,version){const grSubcompositorResource=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrSubcompositor"](client,id,version);grSubcompositorResource.implementation=this}getSubsurface(resource,id,surface,
parent){const browserSurface=surface.implementation;if(browserSurface.role);const grSubsurface=new _protocol_greenfield_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["GrSubsurface"](resource.client,id,resource.version);_BrowserSubsurface__WEBPACK_IMPORTED_MODULE_2__["default"].create(parent,surface,grSubsurface);const parentBrowserSurface=parent.implementation;const views=parentBrowserSurface.addSubsurface(browserSurface.browserSurfaceChildSelf);const onNewView=(view)=>{view.onDestroy().then(()=>
{view.detach()})};views.forEach(onNewView);browserSurface.onViewCreated=onNewView}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserSubsurface});var _math_Point__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);var _render_Renderer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(18);var _BrowserSurface__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8);var _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_3__=
__webpack_require__(50);class BrowserSubsurface extends _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_3__["default"]{static create(parentGrSurfaceResource,grSurfaceResource,grSubsurfaceResource){const browserSubsurface=new BrowserSubsurface(parentGrSurfaceResource,grSurfaceResource,grSubsurfaceResource);grSubsurfaceResource.implementation=browserSubsurface;grSurfaceResource.onDestroy().then(()=>{browserSubsurface._inert=true});parentGrSurfaceResource.onDestroy().then(()=>{});grSurfaceResource.implementation.role=
browserSubsurface;return browserSubsurface}constructor(parentGrSurfaceResource,grSurfaceResource,grSubsurfaceResource){super();this.parentGrSurfaceResource=parentGrSurfaceResource;this.grSurfaceResource=grSurfaceResource;this.resource=grSubsurfaceResource;this._sync=true;this.pendingPosition=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,0);this._cachedState=grSurfaceResource.implementation.state;this._inert=false}onParentCommit(parentBrowserSurface,renderFrame){if(this._inert)return;
const browserSurface=this.grSurfaceResource.implementation;if(this._effectiveSync&&this._cachedState){browserSurface.render(renderFrame,this._cachedState);this._cachedState=null}}async onCommit(browserSurface,renderFrame,newState){if(this._inert)return;if(this._effectiveSync){if(!this._cachedState)this._cachedState=browserSurface.state;_BrowserSurface__WEBPACK_IMPORTED_MODULE_2__["default"].mergeState(this._cachedState,newState)}else{if(this._cachedState){_BrowserSurface__WEBPACK_IMPORTED_MODULE_2__["default"].mergeState(newState,
this._cachedState);this._cachedState=null}await browserSurface.render(renderFrame,newState);renderFrame.fire();await renderFrame;browserSurface.browserSession.flush()}}destroy(resource){resource.destroy()}setPosition(resource,x,y){if(this._inert)return;this.pendingPosition=_math_Point__WEBPACK_IMPORTED_MODULE_0__["default"].create(x,y)}placeAbove(resource,sibling){if(this._inert)return;const parentBrowserSurface=this.parentGrSurfaceResource.implementation;const browserSurface=this.grSurfaceResource.implementation;
const currentIdx=parentBrowserSurface.pendingBrowserSubsurfaceChildren.indexOf(browserSurface.browserSurfaceChildSelf);parentBrowserSurface.pendingBrowserSubsurfaceChildren.splice(currentIdx,1);const siblingIdx=parentBrowserSurface.pendingBrowserSubsurfaceChildren.indexOf(sibling.implementation.browserSurface.browserSurfaceChildSelf);const newIdx=siblingIdx+1;parentBrowserSurface.pendingBrowserSubsurfaceChildren.splice(newIdx,0,browserSurface.browserSurfaceChildSelf)}placeBelow(resource,sibling){if(this._inert)return;
const parentBrowserSurface=this.parentGrSurfaceResource.implementation;const browserSurface=this.grSurfaceResource.implementation;const currentIdx=parentBrowserSurface.pendingBrowserSubsurfaceChildren.indexOf(browserSurface.browserSurfaceChildSelf);parentBrowserSurface.pendingBrowserSubsurfaceChildren.splice(currentIdx,1);const newIdx=parentBrowserSurface.pendingBrowserSubsurfaceChildren.indexOf(sibling.implementation.browserSurface.browserSurfaceChildSelf);parentBrowserSurface.pendingBrowserSubsurfaceChildren.splice(newIdx,
0,browserSurface.browserSurfaceChildSelf)}get _effectiveSync(){return this._sync||this._parentEffectiveSync}get _parentEffectiveSync(){let parentEffectiveSync=false;const parentRole=this.parentGrSurfaceResource.implementation.role;if(parentRole&&parentRole instanceof BrowserSubsurface)parentEffectiveSync=parentRole._effectiveSync;return parentEffectiveSync}setSync(resource){if(this._inert)return;this._sync=true}async setDesync(resource){if(this._inert)return;this._sync=false;if(!this._effectiveSync&&
this._cachedState){const browserSurface=this.grSurfaceResource.implementation;const renderFrame=_render_Renderer__WEBPACK_IMPORTED_MODULE_1__["default"].createRenderFrame();browserSurface.render(renderFrame,this._cachedState);this._cachedState=null;renderFrame.fire();await renderFrame;browserSurface.browserSession.flush()}}captureRoleState(){}setRoleState(roleState){}}},function(module,exports,__webpack_require__){var content=__webpack_require__(64);if(typeof content==="string")content=[[module.i,
content,""]];var transform;var insertInto;var options={"hmr":true};options.transform=transform;options.insertInto=undefined;var update=__webpack_require__(66)(content,options);if(content.locals)module.exports=content.locals;if(false);},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(65)(false);exports.push([module.i,"body {\n    margin: 0;\n    padding: 0;\n    height: 100vh;\n    min-height: 100vh;\n}\n\n#workspace {\n    z-index: -65535;\n}\n\ncanvas {\n    will-change: transform, contents, display;\n    transform-origin: top left;\n    pointer-events: none;\n    position: absolute;\n    transition: inherit;\n    visibility: inherit;\n    opacity: inherit;\n}\n\n.fadeToHidden {\n    visibility: hidden;\n    opacity: 0;\n    transition: visibility 200ms, opacity 200ms ease-in-out;\n}\n\n.fadeToUnresponsive {\n    filter: grayscale(0.9) brightness(0.6) contrast(1.3) blur(1px);\n    transition: filter 1000ms ease-in-out;\n}\n\n.inputRegion {\n    transform-origin: top left;\n    position: absolute;\n    display: inline-block;\n    transform: inherit;\n}",
""])},function(module,exports){module.exports=function(useSourceMap){var list=[];list.toString=function toString(){return this.map(function(item){var content=cssWithMappingToString(item,useSourceMap);if(item[2])return"@media "+item[2]+"{"+content+"}";else return content}).join("")};list.i=function(modules,mediaQuery){if(typeof modules==="string")modules=[[null,modules,""]];var alreadyImportedModules={};for(var i=0;i<this.length;i++){var id=this[i][0];if(typeof id==="number")alreadyImportedModules[id]=
true}for(i=0;i<modules.length;i++){var item=modules[i];if(typeof item[0]!=="number"||!alreadyImportedModules[item[0]]){if(mediaQuery&&!item[2])item[2]=mediaQuery;else if(mediaQuery)item[2]="("+item[2]+") and ("+mediaQuery+")";list.push(item)}}};return list};function cssWithMappingToString(item,useSourceMap){var content=item[1]||"";var cssMapping=item[3];if(!cssMapping)return content;if(useSourceMap&&typeof btoa==="function"){var sourceMapping=toComment(cssMapping);var sourceURLs=cssMapping.sources.map(function(source){return"/*# sourceURL="+
cssMapping.sourceRoot+source+" */"});return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}return[content].join("\n")}function toComment(sourceMap){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));var data="sourceMappingURL=data:application/json;charset=utf-8;base64,"+base64;return"/*# "+data+" */"}},function(module,exports,__webpack_require__){var stylesInDom={};var memoize=function(fn){var memo;return function(){if(typeof memo==="undefined")memo=fn.apply(this,
arguments);return memo}};var isOldIE=memoize(function(){return window&&document&&document.all&&!window.atob});var getTarget=function(target,parent){if(parent)return parent.querySelector(target);return document.querySelector(target)};var getElement=function(fn){var memo={};return function(target,parent){if(typeof target==="function")return target();if(typeof memo[target]==="undefined"){var styleTarget=getTarget.call(this,target,parent);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement)try{styleTarget=
styleTarget.contentDocument.head}catch(e){styleTarget=null}memo[target]=styleTarget}return memo[target]}}();var singleton=null;var singletonCounter=0;var stylesInsertedAtTop=[];var fixUrls=__webpack_require__(67);module.exports=function(list,options){if(false);options=options||{};options.attrs=typeof options.attrs==="object"?options.attrs:{};if(!options.singleton&&typeof options.singleton!=="boolean")options.singleton=isOldIE();if(!options.insertInto)options.insertInto="head";if(!options.insertAt)options.insertAt=
"bottom";var styles=listToStyles(list,options);addStylesToDom(styles,options);return function update(newList){var mayRemove=[];for(var i=0;i<styles.length;i++){var item=styles[i];var domStyle=stylesInDom[item.id];domStyle.refs--;mayRemove.push(domStyle)}if(newList){var newStyles=listToStyles(newList,options);addStylesToDom(newStyles,options)}for(var i=0;i<mayRemove.length;i++){var domStyle=mayRemove[i];if(domStyle.refs===0){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}}};
function addStylesToDom(styles,options){for(var i=0;i<styles.length;i++){var item=styles[i];var domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j],options))}else{var parts=[];for(var j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j],options));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function listToStyles(list,options){var styles=
[];var newStyles={};for(var i=0;i<list.length;i++){var item=list[i];var id=options.base?item[0]+options.base:item[0];var css=item[1];var media=item[2];var sourceMap=item[3];var part={css:css,media:media,sourceMap:sourceMap};if(!newStyles[id])styles.push(newStyles[id]={id:id,parts:[part]});else newStyles[id].parts.push(part)}return styles}function insertStyleElement(options,style){var target=getElement(options.insertInto);if(!target)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");
var lastStyleElementInsertedAtTop=stylesInsertedAtTop[stylesInsertedAtTop.length-1];if(options.insertAt==="top"){if(!lastStyleElementInsertedAtTop)target.insertBefore(style,target.firstChild);else if(lastStyleElementInsertedAtTop.nextSibling)target.insertBefore(style,lastStyleElementInsertedAtTop.nextSibling);else target.appendChild(style);stylesInsertedAtTop.push(style)}else if(options.insertAt==="bottom")target.appendChild(style);else if(typeof options.insertAt==="object"&&options.insertAt.before){var nextSibling=
getElement(options.insertAt.before,target);target.insertBefore(style,nextSibling)}else throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");}function removeStyleElement(style){if(style.parentNode===null)return false;style.parentNode.removeChild(style);var idx=stylesInsertedAtTop.indexOf(style);if(idx>=0)stylesInsertedAtTop.splice(idx,1)}function createStyleElement(options){var style=
document.createElement("style");if(options.attrs.type===undefined)options.attrs.type="text/css";if(options.attrs.nonce===undefined){var nonce=getNonce();if(nonce)options.attrs.nonce=nonce}addAttrs(style,options.attrs);insertStyleElement(options,style);return style}function createLinkElement(options){var link=document.createElement("link");if(options.attrs.type===undefined)options.attrs.type="text/css";options.attrs.rel="stylesheet";addAttrs(link,options.attrs);insertStyleElement(options,link);return link}
function addAttrs(el,attrs){Object.keys(attrs).forEach(function(key){el.setAttribute(key,attrs[key])})}function getNonce(){if(false);return __webpack_require__.nc}function addStyle(obj,options){var style,update,remove,result;if(options.transform&&obj.css){result=typeof options.transform==="function"?options.transform(obj.css):options.transform.default(obj.css);if(result)obj.css=result;else return function(){}}if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=createStyleElement(options));
update=applyToSingletonTag.bind(null,style,styleIndex,false);remove=applyToSingletonTag.bind(null,style,styleIndex,true)}else if(obj.sourceMap&&typeof URL==="function"&&typeof URL.createObjectURL==="function"&&typeof URL.revokeObjectURL==="function"&&typeof Blob==="function"&&typeof btoa==="function"){style=createLinkElement(options);update=updateLink.bind(null,style,options);remove=function(){removeStyleElement(style);if(style.href)URL.revokeObjectURL(style.href)}}else{style=createStyleElement(options);
update=applyToTag.bind(null,style);remove=function(){removeStyleElement(style)}}update(obj);return function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}var replaceText=function(){var textStore=[];return function(index,replacement){textStore[index]=replacement;return textStore.filter(Boolean).join("\n")}}();function applyToSingletonTag(style,index,remove,obj){var css=remove?"":obj.css;if(style.styleSheet)style.styleSheet.cssText=
replaceText(index,css);else{var cssNode=document.createTextNode(css);var childNodes=style.childNodes;if(childNodes[index])style.removeChild(childNodes[index]);if(childNodes.length)style.insertBefore(cssNode,childNodes[index]);else style.appendChild(cssNode)}}function applyToTag(style,obj){var css=obj.css;var media=obj.media;if(media)style.setAttribute("media",media);if(style.styleSheet)style.styleSheet.cssText=css;else{while(style.firstChild)style.removeChild(style.firstChild);style.appendChild(document.createTextNode(css))}}
function updateLink(link,options,obj){var css=obj.css;var sourceMap=obj.sourceMap;var autoFixUrls=options.convertToAbsoluteUrls===undefined&&sourceMap;if(options.convertToAbsoluteUrls||autoFixUrls)css=fixUrls(css);if(sourceMap)css+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */";var blob=new Blob([css],{type:"text/css"});var oldSrc=link.href;link.href=URL.createObjectURL(blob);if(oldSrc)URL.revokeObjectURL(oldSrc)}},function(module,
exports){module.exports=function(css){var location=typeof window!=="undefined"&&window.location;if(!location)throw new Error("fixUrls requires window.location");if(!css||typeof css!=="string")return css;var baseUrl=location.protocol+"//"+location.host;var currentDir=baseUrl+location.pathname.replace(/\/[^\/]*$/,"/");var fixedCss=css.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(fullMatch,origUrl){var unquotedOrigUrl=origUrl.trim().replace(/^"(.*)"$/,function(o,$1){return $1}).replace(/^'(.*)'$/,
function(o,$1){return $1});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(unquotedOrigUrl))return fullMatch;var newUrl;if(unquotedOrigUrl.indexOf("//")===0)newUrl=unquotedOrigUrl;else if(unquotedOrigUrl.indexOf("/")===0)newUrl=baseUrl+unquotedOrigUrl;else newUrl=currentDir+unquotedOrigUrl.replace(/^\.\//,"");return"url("+JSON.stringify(newUrl)+")"});return fixedCss}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,
"default",function(){return BrowserXdgWmBase});var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3);var westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__);var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(69);var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_1__);
var _BrowserXdgSurface__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(70);var _BrowserXdgPositioner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(73);class BrowserXdgWmBase extends westfield_runtime_server__WEBPACK_IMPORTED_MODULE_0__["Global"]{static create(browserSession,userShell,browserSeat){return new BrowserXdgWmBase(browserSession,userShell,browserSeat)}constructor(browserSession,userShell,browserSeat){super(_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["XdgWmBase"].name,
1);this._browserSession=browserSession;this._userShell=userShell;this._browserSeat=browserSeat;this._timeoutTimer=0;this._pingTimeoutActive=false;this._doPingTimer=0;this._pingSerial=0;this._grSurfaceResources=[]}bindClient(client,id,version){const xdgWmBaseResource=new _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["XdgWmBase"](client,id,version);xdgWmBaseResource.implementation=this;xdgWmBaseResource.onDestroy().then(()=>{window.clearTimeout(this._timeoutTimer)});xdgWmBaseResource.onDestroy().then(()=>
{window.clearTimeout(this._doPingTimer)})}destroy(resource){if(this._grSurfaceResources.length>0)return;resource.destroy()}createPositioner(resource,id){const xdgPositionerResource=new _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["XdgPositioner"](resource.client,id,resource.version);_BrowserXdgPositioner__WEBPACK_IMPORTED_MODULE_3__["default"].create(xdgPositionerResource)}getXdgSurface(resource,id,surface){if(surface.implementation.pendingGrBuffer||surface.implementation.state.bufferContents)return;
const xdgSurfaceResource=new _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_1__["XdgSurface"](resource.client,id,resource.version);_BrowserXdgSurface__WEBPACK_IMPORTED_MODULE_2__["default"].create(xdgSurfaceResource,surface,this._browserSession,this._userShell,this._browserSeat);this._grSurfaceResources.push(surface);surface.onDestroy().then(()=>{const index=this._grSurfaceResources.indexOf(surface);if(index>-1)this._grSurfaceResources.splice(index,1)})}pong(resource,serial){if(this._pingTimeoutActive){this._grSurfaceResources.forEach((grSurfaceResource)=>
{this._removeClassRecursively(grSurfaceResource.implementation,"fadeToUnresponsive")});this._pingTimeoutActive=false}window.clearTimeout(this._timeoutTimer);this._doPingTimer=window.setTimeout(()=>{this._doPing(resource)},1E3)}_doPing(resource){this._timeoutTimer=window.setTimeout(()=>{if(!this._pingTimeoutActive){this._pingTimeoutActive=true;this._grSurfaceResources.forEach((grSurfaceResource)=>{this._addClassRecursively(grSurfaceResource.implementation,"fadeToUnresponsive")})}},3E3);this._pingSerial++;
resource.ping(this._pingSerial);this.browserSession.flush()}_removeClassRecursively(browserSurface,cssClass){browserSurface.browserSurfaceViews.forEach((view)=>{view.bufferedCanvas.removeCssClass(cssClass)});browserSurface.browserSurfaceChildren.forEach((browserSurfaceChild)=>{if(browserSurfaceChild.browserSurface!==browserSurface)this._removeClassRecursively(browserSurfaceChild.browserSurface,cssClass)})}_addClassRecursively(browserSurface,cssClass){browserSurface.browserSurfaceViews.forEach((view)=>
{view.bufferedCanvas.addCssClass(cssClass)});browserSurface.browserSurfaceChildren.forEach((browserSurfaceChild)=>{if(browserSurfaceChild.browserSurface!==browserSurface)this._addClassRecursively(browserSurfaceChild.browserSurface,cssClass)})}}},function(module,exports,__webpack_require__){const wfs=__webpack_require__(3);wfs.XdgWmBase=class XdgWmBase extends wfs.Resource{ping(serial){this.client._marshall(this.id,1,[wfs._uint(serial)])}constructor(client,id,version){super(client,id,version,{destroy(resource){},
createPositioner(resource,id){},getXdgSurface(resource,id,surface){},pong(resource,serial){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.createPositioner.call(this.implementation,this,args[0])}[3](message){const args=this.client._unmarshallArgs(message,"no");this.implementation.getXdgSurface.call(this.implementation,this,args[0],args[1])}[4](message){const args=
this.client._unmarshallArgs(message,"u");this.implementation.pong.call(this.implementation,this,args[0])}};wfs.XdgWmBase.Error={role:0,defunctSurfaces:1,notTheTopmostPopup:2,invalidPopupParent:3,invalidSurfaceState:4,invalidPositioner:5};wfs.XdgPositioner=class XdgPositioner extends wfs.Resource{constructor(client,id,version){super(client,id,version,{destroy(resource){},setSize(resource,width,height){},setAnchorRect(resource,x,y,width,height){},setAnchor(resource,anchor){},setGravity(resource,gravity){},
setConstraintAdjustment(resource,constraintAdjustment){},setOffset(resource,x,y){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"ii");this.implementation.setSize.call(this.implementation,this,args[0],args[1])}[3](message){const args=this.client._unmarshallArgs(message,"iiii");this.implementation.setAnchorRect.call(this.implementation,this,args[0],args[1],args[2],
args[3])}[4](message){const args=this.client._unmarshallArgs(message,"u");this.implementation.setAnchor.call(this.implementation,this,args[0])}[5](message){const args=this.client._unmarshallArgs(message,"u");this.implementation.setGravity.call(this.implementation,this,args[0])}[6](message){const args=this.client._unmarshallArgs(message,"u");this.implementation.setConstraintAdjustment.call(this.implementation,this,args[0])}[7](message){const args=this.client._unmarshallArgs(message,"ii");this.implementation.setOffset.call(this.implementation,
this,args[0],args[1])}};wfs.XdgPositioner.Error={invalidInput:0};wfs.XdgPositioner.Anchor={none:0,top:1,bottom:2,left:3,right:4,topLeft:5,bottomLeft:6,topRight:7,bottomRight:8};wfs.XdgPositioner.Gravity={none:0,top:1,bottom:2,left:3,right:4,topLeft:5,bottomLeft:6,topRight:7,bottomRight:8};wfs.XdgPositioner.ConstraintAdjustment={none:0,slideX:1,slideY:2,flipX:4,flipY:8,resizeX:16,resizeY:32};wfs.XdgSurface=class XdgSurface extends wfs.Resource{configure(serial){this.client._marshall(this.id,1,[wfs._uint(serial)])}constructor(client,
id,version){super(client,id,version,{destroy(resource){},getToplevel(resource,id){},getPopup(resource,id,parent,positioner){},setWindowGeometry(resource,x,y,width,height){},ackConfigure(resource,serial){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"n");this.implementation.getToplevel.call(this.implementation,this,args[0])}[3](message){const args=this.client._unmarshallArgs(message,
"n?oo");this.implementation.getPopup.call(this.implementation,this,args[0],args[1],args[2])}[4](message){const args=this.client._unmarshallArgs(message,"iiii");this.implementation.setWindowGeometry.call(this.implementation,this,args[0],args[1],args[2],args[3])}[5](message){const args=this.client._unmarshallArgs(message,"u");this.implementation.ackConfigure.call(this.implementation,this,args[0])}};wfs.XdgSurface.Error={notConstructed:1,alreadyConstructed:2,unconfiguredBuffer:3};wfs.XdgToplevel=class XdgToplevel extends wfs.Resource{configure(width,
height,states){this.client._marshall(this.id,1,[wfs._int(width),wfs._int(height),wfs._array(states)])}close(){this.client._marshall(this.id,2,[])}constructor(client,id,version){super(client,id,version,{destroy(resource){},setParent(resource,parent){},setTitle(resource,title){},setAppId(resource,appId){},showWindowMenu(resource,seat,serial,x,y){},move(resource,seat,serial){},resize(resource,seat,serial,edges){},setMaxSize(resource,width,height){},setMinSize(resource,width,height){},setMaximized(resource){},
unsetMaximized(resource){},setFullscreen(resource,output){},unsetFullscreen(resource){},setMinimized(resource){}})}[1](message){const args=this.client._unmarshallArgs(message,"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"?o");this.implementation.setParent.call(this.implementation,this,args[0])}[3](message){const args=this.client._unmarshallArgs(message,"s");this.implementation.setTitle.call(this.implementation,this,args[0])}[4](message){const args=
this.client._unmarshallArgs(message,"s");this.implementation.setAppId.call(this.implementation,this,args[0])}[5](message){const args=this.client._unmarshallArgs(message,"ouii");this.implementation.showWindowMenu.call(this.implementation,this,args[0],args[1],args[2],args[3])}[6](message){const args=this.client._unmarshallArgs(message,"ou");this.implementation.move.call(this.implementation,this,args[0],args[1])}[7](message){const args=this.client._unmarshallArgs(message,"ouu");this.implementation.resize.call(this.implementation,
this,args[0],args[1],args[2])}[8](message){const args=this.client._unmarshallArgs(message,"ii");this.implementation.setMaxSize.call(this.implementation,this,args[0],args[1])}[9](message){const args=this.client._unmarshallArgs(message,"ii");this.implementation.setMinSize.call(this.implementation,this,args[0],args[1])}[10](message){const args=this.client._unmarshallArgs(message,"");this.implementation.setMaximized.call(this.implementation,this)}[11](message){const args=this.client._unmarshallArgs(message,
"");this.implementation.unsetMaximized.call(this.implementation,this)}[12](message){const args=this.client._unmarshallArgs(message,"?o");this.implementation.setFullscreen.call(this.implementation,this,args[0])}[13](message){const args=this.client._unmarshallArgs(message,"");this.implementation.unsetFullscreen.call(this.implementation,this)}[14](message){const args=this.client._unmarshallArgs(message,"");this.implementation.setMinimized.call(this.implementation,this)}};wfs.XdgToplevel.ResizeEdge={none:0,
top:1,bottom:2,left:4,topLeft:5,bottomLeft:6,right:8,topRight:9,bottomRight:10};wfs.XdgToplevel.State={maximized:1,fullscreen:2,resizing:3,activated:4};wfs.XdgPopup=class XdgPopup extends wfs.Resource{configure(x,y,width,height){this.client._marshall(this.id,1,[wfs._int(x),wfs._int(y),wfs._int(width),wfs._int(height)])}popupDone(){this.client._marshall(this.id,2,[])}constructor(client,id,version){super(client,id,version,{destroy(resource){},grab(resource,seat,serial){}})}[1](message){const args=this.client._unmarshallArgs(message,
"");this.implementation.destroy.call(this.implementation,this)}[2](message){const args=this.client._unmarshallArgs(message,"ou");this.implementation.grab.call(this.implementation,this,args[0],args[1])}};wfs.XdgPopup.Error={invalidGrab:0};module.exports=wfs},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserXdgSurface});var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=
__webpack_require__(69);var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);var _BrowserXdgToplevel__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(71);var _BrowserXdgPopup__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(72);var _math_Rect__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(13);var _render_Renderer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(18);class BrowserXdgSurface{static create(xdgSurfaceResource,
grSurfaceResource,browserSession,userShell,browserSeat){const browserXdgSurface=new BrowserXdgSurface(xdgSurfaceResource,grSurfaceResource,browserSession,userShell,browserSeat);xdgSurfaceResource.implementation=browserXdgSurface;const browserSurface=grSurfaceResource.implementation;browserSurface.hasKeyboardInput=true;browserSurface.hasPointerInput=true;browserSurface.hasTouchInput=true;return browserXdgSurface}constructor(xdgSurfaceResource,grSurfaceResource,browserSession,userShell,browserSeat){this.xdgSurfaceResource=
xdgSurfaceResource;this.grSurfaceResource=grSurfaceResource;this._browserSession=browserSession;this._userShell=userShell;this._browserSeat=browserSeat;this.pendingWindowGeometry=_math_Rect__WEBPACK_IMPORTED_MODULE_3__["default"].create(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);this.configureSerial=0;this.windowGeometry=_math_Rect__WEBPACK_IMPORTED_MODULE_3__["default"].create(0,0,0,0)}destroy(resource){resource.destroy()}getToplevel(resource,
id){const browserSurface=this.grSurfaceResource.implementation;if(browserSurface.role)return;const xdgToplevelResource=new _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["XdgToplevel"](resource.client,id,resource.version);const browserXdgToplevel=_BrowserXdgToplevel__WEBPACK_IMPORTED_MODULE_1__["default"].create(xdgToplevelResource,this,this._browserSession,this._userShell);this.ackConfigure=(resource,serial)=>{browserXdgToplevel.ackConfigure(serial)}}getPopup(resource,id,parent,
positioner){const browserSurface=this.grSurfaceResource.implementation;if(browserSurface.role);const browserXdgPositioner=positioner.implementation;if(browserXdgPositioner.size===null);if(browserXdgPositioner.anchorRect===null);const positionerState=browserXdgPositioner.createStateCopy();const xdgPopupResource=new _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["XdgPopup"](resource.client,id,resource.version);const browserXdgPopup=_BrowserXdgPopup__WEBPACK_IMPORTED_MODULE_2__["default"].create(xdgPopupResource,
this,parent,positionerState,this._browserSession,this._browserSeat);this.ackConfigure=(resource,serial)=>{browserXdgPopup.ackConfigure(serial)};const onNewView=(view)=>{const renderFrame=_render_Renderer__WEBPACK_IMPORTED_MODULE_4__["default"].createRenderFrame();view.applyTransformations(renderFrame);renderFrame.fire();view.onDestroy().then(()=>{view.detach()})};if(parent){const views=parent.implementation.grSurfaceResource.implementation.addChild(browserSurface.browserSurfaceChildSelf);views.forEach(onNewView)}else{const view=
browserSurface.createView();onNewView(view)}browserSurface.onViewCreated=onNewView}setWindowGeometry(resource,x,y,width,height){if(width<=0||height<=0);this.pendingWindowGeometry=_math_Rect__WEBPACK_IMPORTED_MODULE_3__["default"].create(x,y,x+width,y+height)}updateWindowGeometry(windowGeometry){this.windowGeometry=this._createBoundingRectangle().intersect(windowGeometry)}_createBoundingRectangle(){const xs=[0];const ys=[0];const browserSurface=this.grSurfaceResource.implementation;const size=browserSurface.size;
xs.push(size.w);ys.push(size.h);browserSurface.browserSubsurfaceChildren.forEach((browserSubsurfaceChild)=>{const subsurfacePosition=browserSubsurfaceChild.position;const subsurfaceSize=browserSubsurfaceChild.browserSurface.size;xs.push(subsurfacePosition.x);ys.push(subsurfacePosition.y);xs.push(subsurfacePosition.x+subsurfaceSize.w);ys.push(subsurfacePosition.y+subsurfaceSize.h)});const minX=Math.min(...xs);const maxX=Math.max(...xs);const minY=Math.min(...ys);const maxY=Math.max(...ys);return _math_Rect__WEBPACK_IMPORTED_MODULE_3__["default"].create(minX,
minY,maxX,maxY)}ackConfigure(resource,serial){}emitConfigureDone(){this.xdgSurfaceResource.configure(++this.configureSerial)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserXdgToplevel});var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(69);var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);
var _math_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);var _Size__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(14);var _render_Renderer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(18);var _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(50);const {none,bottom,bottomLeft,bottomRight,left,right,top,topLeft,topRight}=_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["XdgToplevel"].ResizeEdge;const {fullscreen,activated,maximized,resizing}=_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["XdgToplevel"].State;
class BrowserXdgToplevel extends _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_4__["default"]{static create(xdgToplevelResource,browserXdgSurface,browserSession,userShell){const userShellSurface=userShell.manage(browserXdgSurface.grSurfaceResource.implementation);const browserXdgToplevel=new BrowserXdgToplevel(xdgToplevelResource,browserXdgSurface,browserSession,userShellSurface);xdgToplevelResource.implementation=browserXdgToplevel;browserXdgSurface.grSurfaceResource.implementation.role=browserXdgToplevel;
xdgToplevelResource.onDestroy().then(()=>{if(browserXdgToplevel._userShellSurface)browserXdgToplevel._userShellSurface.destroy()});userShellSurface.onActivationRequest=()=>{if(!browserXdgToplevel._activationRequested){browserXdgToplevel._activationRequested=true;browserXdgToplevel._emitConfigure(xdgToplevelResource,browserXdgToplevel._configureState.width,browserXdgToplevel._configureState.height,[activated],none)}};userShellSurface.onInactive=()=>{browserXdgToplevel._emitConfigure(xdgToplevelResource,
browserXdgToplevel._configureState.width,browserXdgToplevel._configureState.height,[],none)};return browserXdgToplevel}constructor(xdgToplevelResource,browserXdgSurface,browserSession,userShellSurface){super();this.resource=xdgToplevelResource;this.browserXdgSurface=browserXdgSurface;this._browserSession=browserSession;this._userShellSurface=userShellSurface;this._parent=null;this._title="";this._appId="";this._pendingMaxSize=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(Number.MAX_SAFE_INTEGER,
Number.MAX_SAFE_INTEGER);this._maxSize=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);this._pendingMinSize=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,0);this._minSize=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,0);this._pendingConfigureStates=[];this._unfullscreenConfigureState=null;this._ackedConfigureState={serial:0,state:[],width:0,height:0,resizeEdge:0};this._configureState={serial:0,state:[],width:0,
height:0,resizeEdge:0};this._previousGeometry=null;this.mapped=false;this._activationRequested=false}captureRoleState(){return{windowGeometry:this.browserXdgSurface.pendingWindowGeometry,maxSize:this._pendingMaxSize,minSize:this._pendingMinSize,configureState:this._ackedConfigureState}}setRoleState(roleState){this._maxSize=roleState.maxSize;this._minSize=roleState.minSize;this._configureState=roleState.configureState;this.browserXdgSurface.updateWindowGeometry(roleState.windowGeometry);if(this._activationRequested&&
this._configureState.state.includes(activated)){this._activationRequested=false;this._userShellSurface.activationAck()}}async onCommit(browserSurface,renderFrame,newState){if(newState.bufferContents){if(!this.mapped)this._map(browserSurface);if(newState.roleState.configureState.state.includes(resizing))this._resizingCommit(browserSurface,renderFrame,newState);else if(newState.roleState.configureState.state.includes(maximized))this._maximizedCommit(browserSurface,renderFrame,newState);else if(newState.roleState.configureState.state.includes(fullscreen))this._fullscreenCommit(browserSurface,
renderFrame,newState);else if(newState.roleState.configureState.state.includes(activated))this._normalCommit(browserSurface,renderFrame,newState)}else if(this.mapped)this._unmap();await browserSurface.render(renderFrame,newState);renderFrame.fire();await renderFrame;this._browserSession.flush()}_map(browserSurface){this.mapped=true;this._userShellSurface.mapped=true}_unmap(){this.mapped=false;this._configureState={state:[],width:0,height:0,resizeEdge:0};this._userShellSurface.mapped=false}_resizingCommit(browserSurface,
renderFrame,newState){const roleState=newState.roleState;const {w:newSurfaceWidth,h:newSurfaceHeight}=roleState.windowGeometry.size;if(newSurfaceWidth>roleState.configureState.width||newSurfaceHeight>roleState.configureState.height);const {w:oldSurfaceWidth,h:oldSurfaceHeight}=this.browserXdgSurface.windowGeometry.size;let dx=0;let dy=0;const edges=this._configureState.resizeEdge;switch(edges){case topRight:case top:{dy=oldSurfaceHeight-newSurfaceHeight;break}case bottomLeft:case left:{dx=oldSurfaceWidth-
newSurfaceWidth;break}case topLeft:{dx=oldSurfaceWidth-newSurfaceWidth;dy=oldSurfaceHeight-newSurfaceHeight;break}default:{break}}if(dx||dy){const {x,y}=browserSurface.browserSurfaceChildSelf.position;browserSurface.browserSurfaceChildSelf.position=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x+dx,y+dy);browserSurface.browserSurfaceViews.forEach((value)=>{value.applyTransformations(renderFrame)})}}_maximizedCommit(browserSurface,renderFrame,newState){const roleState=newState.roleState;
const {w:newSurfaceWidth,h:newSurfaceHeight}=roleState.windowGeometry.size;if(newSurfaceWidth!==roleState.configureState.width||newSurfaceHeight!==roleState.configureState.height);if(!this._previousGeometry)this._storePreviousGeometry();if(this._unfullscreenConfigureState)this._unfullscreenConfigureState=null;const x=0;const {y}=document.getElementById("workspace").getBoundingClientRect();const windowGeoPositionOffset=newState.roleState.windowGeometry.position;browserSurface.browserSurfaceChildSelf.position=
_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x-windowGeoPositionOffset.x,y-windowGeoPositionOffset.y);browserSurface.browserSurfaceViews.forEach((value)=>{value.applyTransformations(renderFrame)})}_fullscreenCommit(browserSurface,renderFrame,newState){const bufferSize=newState.bufferContents.size;const {x:newSurfaceWidth,y:newSurfaceHeight}=browserSurface.toSurfaceSpace(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(bufferSize.w,bufferSize.h));if(newSurfaceWidth>this._configureState.width||
newSurfaceHeight>this._configureState.height);if(!this._unfullscreenConfigureState)this._unfullscreenConfigureState=this._configureState;if(!this._previousGeometry)this._storePreviousGeometry();const x=(window.innerWidth-newSurfaceWidth)/2;const y=(window.innerHeight-newSurfaceHeight)/2;browserSurface.browserSurfaceChildSelf.position=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y);browserSurface.browserSurfaceViews.forEach((value)=>{value.applyTransformations(renderFrame)})}_normalCommit(browserSurface,
renderFrame,newState){if(this._previousGeometry){const browserSurface=this.browserXdgSurface.grSurfaceResource.implementation;browserSurface.browserSurfaceChildSelf.position=this._previousGeometry.position;browserSurface.browserSurfaceViews.forEach((value)=>{value.applyTransformations(renderFrame)});this._previousGeometry=null}if(this._unfullscreenConfigureState)this._unfullscreenConfigureState=null}ackConfigure(serial){this._pendingConfigureStates=this._pendingConfigureStates.filter((pendingConfigureState)=>
{if(pendingConfigureState.serial<serial)return false;else if(pendingConfigureState.serial===serial){this._ackedConfigureState=pendingConfigureState;return false}return true})}_storePreviousGeometry(){this._previousGeometry=this.browserXdgSurface.windowGeometry}destroy(resource){this._unmap();resource.destroy()}setParent(resource,parent){if(this._parent){const oldParentBrowserXdgSurface=this._parent.implementation.browserXdgSurface;const oldParentBrowserSurface=oldParentBrowserXdgSurface.grSurfaceResource.implementation;
const browserSurface=this.browserXdgSurface.grSurfaceResource.implementation;oldParentBrowserSurface.removeChild(browserSurface.browserSurfaceChildSelf)}if(parent){const parentBrowserXdgSurface=parent.implementation.browserXdgSurface;const parentBrowserSurface=parentBrowserXdgSurface.grSurfaceResource.implementation;const browserSurface=this.browserXdgSurface.grSurfaceResource.implementation;parentBrowserSurface.addToplevelChild(browserSurface.browserSurfaceChildSelf)}this._parent=parent}setTitle(resource,
title){this._title=title;this._userShellSurface.title=title}setAppId(resource,appId){this._appId=appId;this._userShellSurface.appId=appId}showWindowMenu(resource,seat,serial,x,y){const browserSeat=seat.implementation;if(serial!==browserSeat.serial)return;this._showWindowMenuAt(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y))}_showWindowMenuAt(point){}move(resource,seat,serial){if(this._configureState.state.includes(fullscreen)||this._configureState.state.includes(maximized))return;
const browserSeat=seat.implementation;const browserPointer=browserSeat.browserPointer;const browserSurface=this.browserXdgSurface.grSurfaceResource.implementation;const browserSurfaceChildSelf=browserSurface.browserSurfaceChildSelf;const origPosition=browserSurfaceChildSelf.position;const pointerX=browserPointer.x;const pointerY=browserPointer.y;const moveListener=()=>{if(!this.mapped){browserPointer.removeMouseMoveListener(moveListener);return}const deltaX=browserPointer.x-pointerX;const deltaY=
browserPointer.y-pointerY;browserSurfaceChildSelf.position=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(origPosition.x+deltaX,origPosition.y+deltaY);const renderFrame=_render_Renderer__WEBPACK_IMPORTED_MODULE_3__["default"].createRenderFrame();browserSurface.browserSurfaceViews.forEach((view)=>{view.applyTransformations(renderFrame)});renderFrame.fire()};browserPointer.onButtonRelease().then(()=>{this.browserXdgSurface.grSurfaceResource.implementation.hasPointerInput=true;browserPointer.removeMouseMoveListener(moveListener);
browserPointer.setDefaultCursor()});this.browserXdgSurface.grSurfaceResource.implementation.hasPointerInput=false;browserPointer.unsetFocus();browserPointer.addMouseMoveListener(moveListener);window.document.body.style.cursor="move"}resize(resource,seat,serial,edges){if(this._configureState.state.includes(fullscreen)||this._configureState.state.includes(maximized))return;const browserSeat=seat.implementation;const browserPointer=browserSeat.browserPointer;let sizeAdjustment=(width,height,deltaX,deltaY)=>
{};switch(edges){case bottomRight:{window.document.body.style.cursor="nwse-resize";sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width+deltaX,h:height+deltaY}};break}case top:{window.document.body.style.cursor="ns-resize";sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width,h:height-deltaY}};break}case bottom:{window.document.body.style.cursor="ns-resize";sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width,h:height+deltaY}};break}case left:{window.document.body.style.cursor=
"ew-resize";sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width-deltaX,h:height}};break}case topLeft:{window.document.body.style.cursor="nwse-resize";sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width-deltaX,h:height-deltaY}};break}case bottomLeft:{window.document.body.style.cursor="nesw-resize";sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width-deltaX,h:height+deltaY}};break}case right:{window.document.body.style.cursor="ew-resize";sizeAdjustment=(width,height,deltaX,
deltaY)=>{return{w:width+deltaX,h:height}};break}case topRight:{window.document.body.style.cursor="nesw-resize";sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width+deltaX,h:height-deltaY}};break}case none:default:{browserPointer.setDefaultCursor();sizeAdjustment=(width,height,deltaX,deltaY)=>{return{w:width,h:height}};break}}const pointerX=browserPointer.x;const pointerY=browserPointer.y;const {width:windowGeometryWidth,height:windowGeometryHeight}=this.browserXdgSurface.windowGeometry;const sizeCalculation=
()=>{const deltaX=browserPointer.x-pointerX;const deltaY=browserPointer.y-pointerY;const size=sizeAdjustment(windowGeometryWidth,windowGeometryHeight,deltaX,deltaY);const width=Math.max(this._minSize.x,Math.min(size.w,this._maxSize.x));const height=Math.max(this._minSize.y,Math.min(size.h,this._maxSize.y));return _Size__WEBPACK_IMPORTED_MODULE_2__["default"].create(width,height)};const resizeListener=()=>{if(!this.mapped){browserPointer.removeMouseMoveListener(resizeListener);return}const {w:width,
h:height}=sizeCalculation();this._emitConfigure(resource,width,height,[activated,resizing],edges)};browserPointer.onButtonRelease().then(()=>{this.browserXdgSurface.grSurfaceResource.implementation.hasPointerInput=true;browserPointer.removeMouseMoveListener(resizeListener);browserPointer.setDefaultCursor();const {w:width,h:height}=sizeCalculation();this._emitConfigure(resource,width,height,[activated],none)});this.browserXdgSurface.grSurfaceResource.implementation.hasPointerInput=false;browserPointer.unsetFocus();
browserPointer.addMouseMoveListener(resizeListener)}_emitConfigure(resource,width,height,states,resizeEdge){resource.configure(width,height,Uint32Array.from(states));this.browserXdgSurface.emitConfigureDone();this._pendingConfigureStates.push({serial:this.browserXdgSurface.configureSerial,state:states,width:width,height:height,resizeEdge:resizeEdge})}setMaxSize(resource,width,height){if(width<0||height<0||width<this._minSize.x||height<this._minSize.y);this._pendingMaxSize=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(width===
0?Number.MAX_SAFE_INTEGER:width,height===0?Number.MAX_SAFE_INTEGER:height)}setMinSize(resource,width,height){if(width<0||height<0||width>this._maxSize.x||height>this._maxSize.y);this._pendingMinSize=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(width,height)}setMaximized(resource){if(this._configureState.state.includes(resizing))return;const {width:workspaceWidth,height:workspaceHeight}=document.getElementById("workspace").getBoundingClientRect();const maxWidth=Math.round(workspaceWidth);
const maxHeight=Math.round(workspaceHeight);if(this._configureState.state.includes(fullscreen))this._unfullscreenConfigureState={state:[maximized,activated],width:maxWidth,height:maxHeight};else this._emitConfigure(resource,maxWidth,maxHeight,[maximized,activated],none)}unsetMaximized(resource){if(this._configureState.state.includes(resizing))return;if(this._configureState.state.includes(fullscreen)&&this._previousGeometry)this._unfullscreenConfigureState={state:[activated],width:this._previousGeometry.width,
height:this._previousGeometry.height};else if(this._configureState.state.includes(maximized)&&this._previousGeometry)this._emitConfigure(resource,this._previousGeometry.width,this._previousGeometry.height,[activated],none);else this._emitConfigure(resource,0,0,[activated],none)}setFullscreen(resource,output){this._emitConfigure(resource,window.innerWidth,window.innerHeight,[fullscreen,activated],none)}unsetFullscreen(resource){if(this._configureState.state.includes(fullscreen))if(this._unfullscreenConfigureState)this._emitConfigure(resource,
this._unfullscreenConfigureState.width,this._unfullscreenConfigureState.height,this._unfullscreenConfigureState.state,none);else if(this._previousGeometry)this._emitConfigure(resource,this._previousGeometry.width,this._previousGeometry.height,[activated],none);else this._emitConfigure(resource,0,0,[activated],none)}setMinimized(resource){this._userShellSurface.minimize()}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,
"default",function(){return BrowserXdgPopup});var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(69);var _protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__);var _math_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);var _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(50);const {none,slideX,slideY,flipX,flipY,resizeX,resizeY}=
_protocol_xdg_shell_browser_protocol__WEBPACK_IMPORTED_MODULE_0__["XdgPositioner"].ConstraintAdjustment;const inverseY={0:0,1:2,2:1,3:3,4:4,5:6,6:5,7:8,8:7};const inverseX={0:0,1:1,2:2,3:4,4:3,5:7,6:8,7:5,8:6};class BrowserXdgPopup extends _BrowserSurfaceRole__WEBPACK_IMPORTED_MODULE_2__["default"]{static create(xdgPopupResource,browserXdgSurface,parent,positionerState,browserSession,browserSeat){const browserXdgPopup=new BrowserXdgPopup(xdgPopupResource,browserXdgSurface,parent,positionerState,browserSession,
browserSeat);xdgPopupResource.implementation=browserXdgPopup;browserXdgSurface.grSurfaceResource.implementation.role=browserXdgPopup;browserXdgPopup.ensureGeometryConstraints(parent,positionerState);browserXdgSurface.emitConfigureDone();return browserXdgPopup}constructor(xdgPopupResource,browserXdgSurface,parent,positionerState,browserSession,browserSeat){super();this.resource=xdgPopupResource;this.browserXdgSurface=browserXdgSurface;this.parent=parent;this.positionerState=positionerState;this.mapped=
false;this.dismissed=false;this._browserSession=browserSession;this._browserSeat=browserSeat}captureRoleState(){return{windowGeometry:this.browserXdgSurface.pendingWindowGeometry}}setRoleState(roleState){this.browserXdgSurface.updateWindowGeometry(roleState.windowGeometry)}async onCommit(browserSurface,renderFrame,newState){if(this.dismissed)return;if(newState.bufferContents){if(!this.mapped)this._map(browserSurface,newState)}else if(this.mapped)this._dismiss();await browserSurface.render(renderFrame,
newState);renderFrame.fire();await renderFrame;this._browserSession.flush()}_map(browserSurface,newState){this.mapped=true;const parentBrowserSurface=this.parent.implementation.grSurfaceResource.implementation;browserSurface.browserSurfaceChildSelf.position=this.positionerState.surfaceSpaceAnchorPoint(this.parent.implementation).minus(newState.roleState.windowGeometry.position);parentBrowserSurface.addChild(browserSurface.browserSurfaceChildSelf)}_dismiss(){if(!this.dismissed){this.dismissed=true;
if(this._browserSeat.browserPointer){const popupGrab=this._browserSeat.browserPointer.findPopupGrab(this.browserXdgSurface.grSurfaceResource);if(popupGrab)popupGrab.resolve()}this.resource.popupDone();const parentBrowserSurface=this.parent.implementation.grSurfaceResource.implementation;parentBrowserSurface.removeChild(this.browserXdgSurface.grSurfaceResource.implementation.browserSurfaceChildSelf);this._browserSeat.browserKeyboard.focusGained(parentBrowserSurface)}}_updatePopupKeyboardFocus(){this._browserSeat.browserKeyboard.focusGained(this.browserXdgSurface.grSurfaceResource.implementation);
this._browserSeat.browserKeyboard.onKeyboardFocusChanged().then(()=>{if(!this._browserSeat.browserKeyboard.focus||this._browserSeat.browserKeyboard.focus.resource.client!==this.resource.client)this._dismiss()})}destroy(resource){const browserSurface=this.browserXdgSurface.grSurfaceResource.implementation;for(const browserSurfaceChild of browserSurface.browserSurfaceChildren)if(browserSurfaceChild!==browserSurface.browserSurfaceChildSelf&&browserSurfaceChild.browserSurface.role instanceof BrowserXdgPopup)return;
this._dismiss();resource.destroy()}async grab(resource,seat,serial){const browserSeat=seat.implementation;const browserPointer=browserSeat.browserPointer;const parentGrSurface=this.parent.implementation.grSurfaceResource;if(parentGrSurface.implementation.role instanceof BrowserXdgPopup)if(!browserPointer.findPopupGrab(parentGrSurface))return;this._updatePopupKeyboardFocus();await browserPointer.popupGrab(this.browserXdgSurface.grSurfaceResource);this._dismiss()}ackConfigure(serial){}ensureGeometryConstraints(parent,
positionerState){if(positionerState.constraintAdjustment===none)return;const parentBrowserXdgSurface=parent.implementation;const parentBrowserSurface=parentBrowserXdgSurface.grSurfaceResource.implementation;const parentBrowserSurfaceView=parentBrowserSurface.browserSurfaceViews.find((parentBrowserSurfaceView)=>parentBrowserSurfaceView.primary);let violations=positionerState.checkScreenConstraints(parentBrowserXdgSurface,parentBrowserSurfaceView);if(!(violations.topViolation||violations.rightViolation||
violations.bottomViolation||violations.leftViolation))return;const canFlipX=(positionerState.constraintAdjustment|flipX)!==0;const canFlipY=(positionerState.constraintAdjustment|flipY)!==0;const canSlideX=(positionerState.constraintAdjustment|slideX)!==0;const canSlideY=(positionerState.constraintAdjustment|slideY)!==0;const canResizeX=(positionerState.constraintAdjustment|resizeX)!==0;const canResizeY=(positionerState.constraintAdjustment|resizeY)!==0;if((violations.leftViolation||violations.rightViolation)&&
positionerState.size.width<window.document.body.clientWidth){if(canFlipX){const oldAnchor=positionerState.anchor;const oldGravity=positionerState.gravity;positionerState.anchor=inverseX[oldAnchor];positionerState.gravity=inverseX[oldGravity];violations=positionerState.checkScreenConstraints(parentBrowserXdgSurface,parentBrowserSurfaceView);if(violations.leftViolation||violations.rightViolation){positionerState.anchor=oldAnchor;positionerState.gravity=oldGravity}}violations=positionerState.checkScreenConstraints(parentBrowserXdgSurface,
parentBrowserSurfaceView);if((violations.leftViolation||violations.rightViolation)&&canSlideX){const newXDeltaOffset=violations.rightViolation?-violations.rightViolation:violations.leftViolation;const oldOffset=positionerState.offset;positionerState.offset=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(oldOffset.x+newXDeltaOffset,oldOffset.y)}}violations=positionerState.checkScreenConstraints(parentBrowserXdgSurface,parentBrowserSurfaceView);if((violations.leftViolation||violations.rightViolation)&&
canResizeX){if(violations.leftViolation){const oldOffset=positionerState.offset;positionerState.offset=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(oldOffset.x+violations.leftViolation,oldOffset.y);positionerState.size.x1=positionerState.size.x1-violations.leftViolation}if(violations.rightViolation)positionerState.size.x1=positionerState.size.x1-violations.rightViolation}violations=positionerState.checkScreenConstraints(parentBrowserXdgSurface,parentBrowserSurfaceView);if((violations.topViolation||
violations.bottomViolation)&&positionerState.size.height<window.document.body.clientHeight){if(canFlipY){const oldAnchor=positionerState.anchor;const oldGravity=positionerState.gravity;positionerState.anchor=inverseY[oldAnchor];positionerState.gravity=inverseY[oldGravity];violations=positionerState.checkScreenConstraints(parentBrowserXdgSurface,parentBrowserSurfaceView);if(violations.topViolation||violations.bottomViolation){positionerState.anchor=oldAnchor;positionerState.gravity=oldGravity}}violations=
positionerState.checkScreenConstraints(parentBrowserXdgSurface,parentBrowserSurfaceView);if((violations.topViolation||violations.bottomViolation)&&canSlideY){const newYDeltaOffset=violations.bottomViolation?-violations.bottomViolation:violations.topViolation;const oldOffset=positionerState.offset;positionerState.offset=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(oldOffset.x,oldOffset.y+newYDeltaOffset)}}violations=positionerState.checkScreenConstraints(parentBrowserXdgSurface,parentBrowserSurfaceView);
if((violations.topViolation||violations.bottomViolation)&&canResizeY){if(violations.topViolation){const oldOffset=positionerState.offset;positionerState.offset=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(oldOffset.x,oldOffset.y+violations.topViolation);positionerState.size.y1=positionerState.size.y1-violations.topViolation}if(violations.bottomViolation)positionerState.size.y1=positionerState.size.y1-violations.bottomViolation}const {x0:x,y0:y,width,height}=positionerState.size;this.resource.configure(x,
y,width,height)}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return BrowserXdgPositioner});var _math_Rect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13);var _math_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);const anchorCalculation={0:(anchorRect)=>{const x=Math.round((anchorRect.x0+anchorRect.width)/2);const y=Math.round((anchorRect.y0+anchorRect.height)/2);
return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)},1:(anchorRect)=>{const x=Math.round((anchorRect.x0+anchorRect.width)/2);const y=anchorRect.y0;return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)},2:(anchorRect)=>{const x=Math.round((anchorRect.x0+anchorRect.width)/2);const y=anchorRect.y1;return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)},3:(anchorRect)=>{const x=anchorRect.x0;const y=Math.round((anchorRect.y0+anchorRect.height)/2);return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,
y)},4:(anchorRect)=>{const x=anchorRect.x1;const y=Math.round((anchorRect.y0+anchorRect.height)/2);return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)},5:(anchorRect)=>{const x=anchorRect.x0;const y=anchorRect.y0;return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)},6:(anchorRect)=>{const x=anchorRect.x0;const y=anchorRect.y1;return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)},7:(anchorRect)=>{const x=anchorRect.x1;const y=anchorRect.y0;return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,
y)},8:(anchorRect)=>{const x=anchorRect.x1;const y=anchorRect.y1;return _math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)}};const offsetCalculation={0:(anchor,offset,windowGeometry)=>{const x=Math.round(windowGeometry.x0+windowGeometry.width/2);const y=Math.round(windowGeometry.y0+windowGeometry.height/2);return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y))},1:(anchor,offset,windowGeometry)=>{const x=Math.round(windowGeometry.x0+windowGeometry.width/2);
const y=windowGeometry.y1;return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,offset.y))},2:(anchor,offset,windowGeometry)=>{const x=Math.round(windowGeometry.x0+windowGeometry.width/2);const y=windowGeometry.y0;return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).plus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,offset.y))},3:(anchor,offset,windowGeometry)=>
{const x=windowGeometry.x1;const y=Math.round(windowGeometry.y0+windowGeometry.height/2);return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(offset.x,0))},4:(anchor,offset,windowGeometry)=>{const x=windowGeometry.x0;const y=Math.round(windowGeometry.y0+windowGeometry.height/2);return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).plus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(offset.x,
0))},5:(anchor,offset,windowGeometry)=>{const x=windowGeometry.x1;const y=windowGeometry.y1;return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).minus(offset)},6:(anchor,offset,windowGeometry)=>{const x=windowGeometry.x1;const y=windowGeometry.y0;return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).plus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(-offset.x,offset.y))},7:(anchor,offset,windowGeometry)=>{const x=windowGeometry.x0;
const y=windowGeometry.y1;return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).plus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(offset.x,-offset.y))},8:(anchor,offset,windowGeometry)=>{const x=windowGeometry.x0;const y=windowGeometry.y0;return anchor.minus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)).plus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(offset.x,offset.y))}};class BrowserXdgPositioner{static create(xdgPositionerResource){const browserXdgPositioner=
new BrowserXdgPositioner;xdgPositionerResource.implementation=browserXdgPositioner;return browserXdgPositioner}constructor(){this.size=null;this.anchorRect=null;this.anchor=0;this.gravity=0;this.constraintAdjustment=0;this.offset=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,0)}destroy(resource){resource.destroy()}setSize(resource,width,height){if(width<=0||height<=0);this.size=_math_Rect__WEBPACK_IMPORTED_MODULE_0__["default"].create(0,0,width,height)}setAnchorRect(resource,x,y,width,
height){if(width<=0||height<=0);this.anchorRect=_math_Rect__WEBPACK_IMPORTED_MODULE_0__["default"].create(x,y,x+width,y+height)}setAnchor(resource,anchor){this.anchor=anchor}setGravity(resource,gravity){this.gravity=gravity}setConstraintAdjustment(resource,constraintAdjustment){this.constraintAdjustment=constraintAdjustment}setOffset(resource,x,y){this.offset=_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(x,y)}createStateCopy(){const selfSize=this.size;const selfAnchorRect=this.anchorRect;
const selfAnchor=this.anchor;const selfGravity=this.gravity;const selfConstraintAdjustment=this.constraintAdjustment;const selfOffset=this.offset;return{size:selfSize,anchorRect:selfAnchorRect,anchor:selfAnchor,gravity:selfGravity,constraintAdjustment:selfConstraintAdjustment,offset:selfOffset,surfaceSpaceAnchorPoint:function(parent){const parentWindowGeometry=parent.windowGeometry;const surfaceSpaceAnchorRectPosition=parentWindowGeometry.position.plus(this.anchorRect.position);const {x,y}=surfaceSpaceAnchorRectPosition;
const surfaceSpaceAnchorRect=_math_Rect__WEBPACK_IMPORTED_MODULE_0__["default"].create(x,y,x+this.anchorRect.width,y+this.anchorRect.height);const surfaceSpaceAnchorPoint=anchorCalculation[this.anchor](surfaceSpaceAnchorRect);return offsetCalculation[this.gravity](surfaceSpaceAnchorPoint,this.offset,this.size)},checkScreenConstraints:function(parent,parentSurfaceView){const surfaceSpaceAnchorPoint=this.surfaceSpaceAnchorPoint(parent);const surfaceSpaceWinGeoMin=surfaceSpaceAnchorPoint.plus(this.size.position);
const surfaceSpaceWinGeoMax=surfaceSpaceAnchorPoint.plus(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(this.size.x1,this.size.y1));const surfaceSpaceMinBound=parentSurfaceView.toSurfaceSpace(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(0,0));const surfaceSpaceMaxBound=parentSurfaceView.toSurfaceSpace(_math_Point__WEBPACK_IMPORTED_MODULE_1__["default"].create(window.document.body.clientWidth,window.document.body.clientHeight));let topViolation=0;let rightViolation=0;let bottomViolation=
0;let leftViolation=0;if(surfaceSpaceWinGeoMin.x<surfaceSpaceMinBound.x)leftViolation=Math.abs(surfaceSpaceMinBound.x-surfaceSpaceWinGeoMin.x);if(surfaceSpaceWinGeoMin.y<surfaceSpaceMinBound.y)topViolation=Math.abs(surfaceSpaceMinBound.y-surfaceSpaceWinGeoMin.y);if(surfaceSpaceWinGeoMax.x>surfaceSpaceMaxBound.x)rightViolation=surfaceSpaceWinGeoMax.x-surfaceSpaceMaxBound.x;if(surfaceSpaceWinGeoMax.y>surfaceSpaceMaxBound.y)bottomViolation=surfaceSpaceWinGeoMax.y-surfaceSpaceMaxBound.y;return{topViolation:topViolation,
rightViolation:rightViolation,bottomViolation:bottomViolation,leftViolation:leftViolation}}}}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return DesktopUserShell});var _DesktopUserShellSurface__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(75);var _DesktopShellMenu__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(77);var _desktopshell_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(78);
var _desktopshell_css__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_desktopshell_css__WEBPACK_IMPORTED_MODULE_2__);var _DesktopShellAppMenu__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(80);class DesktopUserShell{static create(browserSession,browserSeat){const body=document.body;const workspace=document.getElementById("workspace");const panel=document.createElement("div");panel.classList.add("hpanel");body.insertAdjacentElement("afterbegin",panel);const entryContainer=document.createElement("div");
entryContainer.classList.add("entry-container");panel.appendChild(entryContainer);const desktopShellAppMenu=_DesktopShellAppMenu__WEBPACK_IMPORTED_MODULE_3__["default"].create(browserSession);panel.appendChild(desktopShellAppMenu.divElementAppMenuButton);const desktopShellMenu=_DesktopShellMenu__WEBPACK_IMPORTED_MODULE_1__["default"].create();panel.appendChild(desktopShellMenu.divElementMenuButton);const desktopUserShell=new DesktopUserShell(body,workspace,panel,entryContainer,browserSeat);browserSeat.addKeyboardResourceListener((grKeyboard)=>
{desktopUserShell._keyboardAvailable(grKeyboard)});return desktopUserShell}constructor(body,workspace,panel,entryContainer,browserSeat){this.body=body;this.workspace=workspace;this.panel=panel;this.entryContainer=entryContainer;this._browserSeat=browserSeat}manage(browserSurface){const desktopShellEntry=_DesktopUserShellSurface__WEBPACK_IMPORTED_MODULE_0__["default"].create(browserSurface,this._browserSeat);this.entryContainer.appendChild(desktopShellEntry.divElement);return desktopShellEntry}_keyboardAvailable(grKeyboard){_DesktopUserShellSurface__WEBPACK_IMPORTED_MODULE_0__["default"].desktopUserShellSurfaces.forEach((desktopUserShellSurface)=>
{if(desktopUserShellSurface.mainView.browserSurface.resource.client===grKeyboard.client)desktopUserShellSurface.grKeyboard=grKeyboard})}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return DesktopUserShellSurface});var _UserShellSurface__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(76);class DesktopUserShellSurface extends _UserShellSurface__WEBPACK_IMPORTED_MODULE_0__["default"]{static create(browserSurface,
browserSeat){const mainView=browserSurface.createView();this._fadeOutAndDetachViewOnDestroy(mainView);mainView.attachTo(document.body);const divElement=document.createElement("div");divElement.style.display="none";divElement.classList.add("entry");this._fadeOutAndDetachEntryOnDestroy(mainView,divElement);const desktopUserShellSurface=new DesktopUserShellSurface(mainView,divElement,browserSeat);desktopUserShellSurface._activateOnPointerButton();divElement.addEventListener("mousedown",()=>{desktopUserShellSurface._activeCallback()});
browserSurface.resource.onDestroy().then(()=>{desktopUserShellSurface.destroy()});DesktopUserShellSurface.desktopUserShellSurfaces.push(desktopUserShellSurface);return desktopUserShellSurface}static _fadeOutAndDetachEntryOnDestroy(view,entry){view.onDestroy().then(()=>{entry.addEventListener("transitionend",()=>{if(entry.parentElement)entry.parentElement.removeChild(entry)});entry.classList.add("entry-removed")})}static _fadeOutAndDetachViewOnDestroy(view){view.onDestroy().then(()=>{view.bufferedCanvas.containerDiv.addEventListener("transitionend",
()=>{view.detach()});view.fadeOut()})}constructor(mainView,divElement,browserSeat){super();this.mainView=mainView;this.divElement=divElement;this._activeCallback=null;this._inactivateCallback=()=>{};this._grKeyboard=null;this.active=false;this._browserSeat=browserSeat}_activateOnPointerButton(){this._browserSeat.browserPointer.onButtonPress().then(()=>{if(this.mainView.destroyed)return;if(!this.active&&this._browserSeat.browserPointer.focus&&this._browserSeat.browserPointer.focus.browserSurface===
this.mainView.browserSurface)this._activeCallback();this._activateOnPointerButton()})}activationAck(){if(this.mainView.destroyed)return;if(!this.active){this.active=true;this.mainView.show();this.mainView.raise();this.divElement.classList.add("entry-focus");if(this._grKeyboard)this._giveKeyboardFocus();DesktopUserShellSurface.desktopUserShellSurfaces.forEach((desktopUserShellSurface)=>{if(desktopUserShellSurface!==this)desktopUserShellSurface._deactivate()})}}set grKeyboard(grKeyboard){if(this.mainView.destroyed)return;
if(this.active&&this._grKeyboard&&this._grKeyboard.implementation.focus!==this.mainView.browserSurface)this._giveKeyboardFocus();this._grKeyboard=grKeyboard;this._grKeyboard.onDestroy().then(()=>{this._grKeyboard=null})}_giveKeyboardFocus(){const browserKeyboard=this._grKeyboard.implementation;browserKeyboard.focusGained(this.mainView.browserSurface)}_deactivate(){if(this.active){this.active=false;this.divElement.classList.remove("entry-focus");this._inactivateCallback()}}set mapped(mapped){if(mapped){this.divElement.style.display=
"inline";this.divElement.classList.remove("entry-removed")}else{this.divElement.addEventListener("transitionend",()=>{this.divElement.style.display="none"});this.divElement.classList.add("entry-removed")}}set onActivationRequest(activeCallback){this._activeCallback=activeCallback;if(!this.active)this._activeCallback()}set onInactive(inactivateCallback){this._inactivateCallback=inactivateCallback}set appId(appId){}set title(title){this.divElement.textContent=title}minimize(){if(this.mainView.destroyed)return;
this.mainView.fadeOut()}destroy(){const idx=DesktopUserShellSurface.desktopUserShellSurfaces.indexOf(this);if(idx>-1)DesktopUserShellSurface.desktopUserShellSurfaces.splice(idx,1)}}DesktopUserShellSurface.desktopUserShellSurfaces=[]},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return UserShellSurface});class UserShellSurface{set title(title){}set appId(appId){}set mapped(mapped){}set unresponsive(unresponsive){}set onActivationRequest(activeCallback){}set onInactive(inactivateCallback){}activationAck(){}destroy(){}minimize(){}}
},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return DesktopShellMenu});class DesktopShellMenu{static create(){const divElementMenuButton=this._createDivElementMenuButton();const divElementMenuContainer=this._createDivElementMenuContainer();const divElementMenu=this._createDivElementMenu();divElementMenuContainer.appendChild(divElementMenu);const searchBar=this._createSearchBar(divElementMenuContainer);
divElementMenu.appendChild(searchBar.divElementSearchContainer);const desktopShellMenu=new DesktopShellMenu(divElementMenuButton,divElementMenuContainer,divElementMenu,searchBar);this._addEventListeners(desktopShellMenu);return desktopShellMenu}static _createDivElementMenuButton(){const divElementMenuButton=document.createElement("div");divElementMenuButton.classList.add("menu-button");divElementMenuButton.classList.add("config");return divElementMenuButton}static _createDivElementMenuContainer(){const divElementMenuContainer=
document.createElement("div");divElementMenuContainer.classList.add("menu-container");divElementMenuContainer.classList.add("config");window.document.body.appendChild(divElementMenuContainer);const divElementMenuTriangleUp=document.createElement("div");divElementMenuTriangleUp.classList.add("menu-triangle-up");divElementMenuTriangleUp.classList.add("config");divElementMenuContainer.appendChild(divElementMenuTriangleUp);return divElementMenuContainer}static _createDivElementMenu(){const divElementMenu=
document.createElement("div");divElementMenu.classList.add("menu");divElementMenu.classList.add("config");return divElementMenu}static _createSearchBar(divElementMenuContainer){const divElementSearchContainer=document.createElement("div");const divElementSearchIcon=document.createElement("div");const inputElementSearchInput=document.createElement("input");inputElementSearchInput.setAttribute("type","text");inputElementSearchInput.setAttribute("name","search");inputElementSearchInput.setAttribute("placeholder",
"...");divElementSearchContainer.appendChild(divElementSearchIcon);divElementSearchContainer.appendChild(inputElementSearchInput);divElementSearchContainer.classList.add("search-container");divElementSearchIcon.classList.add("search-icon");inputElementSearchInput.classList.add("search-input");return{divElementSearchContainer:divElementSearchContainer,divElementSearchIcon:divElementSearchIcon,inputElementSearchInput:inputElementSearchInput}}static _addEventListeners(desktopShellMenu){desktopShellMenu.divElementMenuButton.addEventListener("mousedown",
()=>{desktopShellMenu.showMenu()});window.document.addEventListener("mousedown",(event)=>{if(event.target!==desktopShellMenu.divElementMenu&&event.target!==desktopShellMenu.divElementMenuButton)desktopShellMenu.hideMenu()});desktopShellMenu.searchBar.inputElementSearchInput.addEventListener("input",(inputEvent)=>{const searchText=inputEvent.data})}constructor(divElementMenuButton,divElementMenuContainer,divElementMenu,searchBar){this.divElementMenuButton=divElementMenuButton;this.divElementMenuContainer=
divElementMenuContainer;this.divElementMenu=divElementMenu;this.searchBar=searchBar}showMenu(){this.divElementMenuContainer.addEventListener("transitionend",()=>{this.searchBar.inputElementSearchInput.classList.add("enable-default");this.searchBar.inputElementSearchInput.focus()});this.divElementMenuContainer.style.visibility="visible";this.divElementMenu.classList.add("menu-active");this.divElementMenuButton.classList.add("menu-button-active")}hideMenu(){this.searchBar.inputElementSearchInput.blur();
this.searchBar.inputElementSearchInput.classList.remove("enable-default");this.searchBar.inputElementSearchInput.value="";this.divElementMenuContainer.style.visibility="hidden";this.divElementMenu.classList.remove("menu-active");this.divElementMenuButton.classList.remove("menu-button-active")}}},function(module,exports,__webpack_require__){var content=__webpack_require__(79);if(typeof content==="string")content=[[module.i,content,""]];var transform;var insertInto;var options={"hmr":true};options.transform=
transform;options.insertInto=undefined;var update=__webpack_require__(66)(content,options);if(content.locals)module.exports=content.locals;if(false);},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(65)(false);exports.push([module.i,"body {\n    display: flex;\n    flex-direction: column;\n}\n\n#workspace {\n    flex-grow: 1;\n    display: inline;\n    background-image: url(/assets/pattern_light.png);\n    background-size: auto;\n}\n\n.hpanel {\n    z-index: 0;\n    background-color: rgb(200, 200, 200);\n\n    display: flex;\n    flex-wrap: nowrap;\n    flex-direction: row;\n\n    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.75);\n}\n\n.entry-container {\n    flex-grow: 1;\n    display: flex;\n    flex-wrap: wrap;\n    flex-direction: row;\n    align-items: center;\n}\n\n.entry {\n    flex-grow: 1;\n    min-width: 100px;\n    max-width: 20vw;\n    height: 3.6vh;\n\n    background: rgb(150, 150, 150);\n\n    font-family: sans-serif;\n    font-size: medium;\n    text-align: left;\n    padding-left: 1vh;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    vertical-align: middle;\n    line-height: 4vh;\n    color: black;\n\n    box-shadow: inset 0 0.6vh 0.1vh -0.3vh rgba(252, 104, 42, 0.20);\n\n    transition: all 200ms ease-in-out;\n}\n\n.entry-removed {\n    opacity: 0;\n}\n\n.entry-focus {\n    box-shadow: inset 0 0.6vh 0.1vh -0.3vh rgba(42, 190, 252, 1);\n    background: rgb(230, 230, 230);\n}\n\n.entry:hover:not(.entry-focus) {\n    box-shadow: inset 0 0.6vh 0.1vh -0.3vh rgba(252, 104, 42, 0.60);\n    background: rgb(210, 210, 210);\n    transition: all 150ms linear;\n}\n\n.menu-button {\n    min-height: 3vh;\n    height: 3vh;\n    min-width: 3vh;\n    width: 3vh;\n    margin: 0.3vh;\n    transition: all 200ms ease-in-out;\n    position: relative;\n}\n\n.menu-button.config {\n    background: url(/assets/menu.svg) no-repeat center;\n    background-size: 0.5vh 3.1vh;\n}\n\n.menu-button.apps {\n    background: url(/assets/menu-apps.svg) no-repeat center;\n    background-size: 1.3vh 1.3vh;\n}\n\n.menu-button:hover {\n    border-radius: 0.5vh;\n    background-color: rgb(215, 215, 215);\n    box-shadow: 0 0 1px 0 rgba(0, 0, 0, 0.75);\n}\n\n.menu-button-active {\n    border-radius: 0.5vh;\n    box-shadow: 0 0 1px 0 rgba(0, 0, 0, 0.75);\n}\n\n.menu-button-active.config {\n    background: rgb(220, 220, 220) url(/assets/menu-active.svg) no-repeat center;\n    background-size: 2.5vh 3vh;\n}\n\n.menu-button-active.apps {\n    background: rgb(220, 220, 220) url(/assets/menu-apps-active.svg) no-repeat center;\n    background-size: 2.4vh 2.4vh;\n}\n\n.menu {\n    display: flex;\n    flex-direction: column;\n    position: absolute;\n    right: 0.5vh;\n    top: 4.5vh;\n\n    border-radius: 0.5vh;\n    opacity: 0;\n    background: rgb(210, 210, 210);\n    box-shadow: 0 0 3px 0 rgba(0, 0, 0, 0.75);\n\n    transition: all 200ms ease-in-out;\n\n    pointer-events: auto;\n}\n\n.menu.config {\n    width: 42vh;\n    height: calc(100% - 6vh);\n}\n\n.menu.apps {\n    width: 42vh;\n    height: 41vh;\n}\n\n.menu-active {\n    opacity: 1;\n    transition: all 200ms ease-in-out;\n}\n\n.menu-container {\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 65534;\n    visibility: hidden;\n    pointer-events: none;\n}\n\n.menu-triangle-up {\n    position: absolute;\n    top: 3.1vh;\n    width: 0;\n    height: 0;\n    z-index: 65535;\n    border-left: 1vh solid transparent;\n    border-right: 1vh solid transparent;\n\n    border-bottom: 1.4vh solid rgb(210, 210, 210);\n}\n\n.menu-triangle-up.config {\n    right: 0.7vh;\n}\n\n.menu-triangle-up.apps {\n    right: 4.5vh;\n}\n\n.search-container {\n    margin: 2vh;\n    display: flex;\n\n    border-radius: 2vh;\n    background: rgb(150, 150, 150);\n}\n\n.search-icon {\n    margin: 0.25vh;\n    min-height: 2vh;\n    height: 2vh;\n    min-width: 2vh;\n    width: 2vh;\n\n    background: url(/assets/search.svg) no-repeat center;\n    background-size: 2vh 2vh;\n}\n\n.search-input {\n    background: transparent;\n    width: 100%;\n    outline-style: none;\n    box-shadow: none;\n    border-color: transparent;\n    font-family: sans-serif;\n    color: white;\n}\n\ninput::placeholder {\n    color: white;\n    opacity: 1;\n}\n\n.app-menu-item {\n    display: flex;\n    flex-direction: column;\n\n    width: 9vh;\n    margin: 1vh;\n    padding: 1vh;\n}\n\n.app-menu-item:hover, .app-menu-item.search-match {\n    border-radius: 0.5vh;\n    box-shadow: 0 0 3px 0 rgba(0, 0, 0, 0.75);\n    background: rgb(220, 220, 220);\n    transition: all 200ms ease-in-out;\n}\n\n.app-menu-item img {\n    width: 9vh;\n    height: 9vh;\n}\n\n.app-menu-item .name {\n    text-align: center;\n\n    font-family: sans-serif;\n    vertical-align: middle;\n    line-height: 2vh;\n    color: black;\n}\n\n.app-menu-item-container {\n    display: flex;\n    flex-wrap: wrap;\n    overflow-y: auto;\n    scroll-behavior: smooth;\n}\n\n",
""])},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return DesktopShellAppMenu});var _DesktopShellAppMenuItem__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(81);class DesktopShellAppMenu{static create(browserSession){const divElementAppMenuButton=this._createDivElementAppMenuButton();const divElementAppMenuContainer=this._createDivElementAppMenuContainer();const divElementAppMenu=
this._createDivElementAppMenu();const divElementAppMenuAppsContainer=this._createDivElementAppMenuAppsContainer();divElementAppMenuContainer.appendChild(divElementAppMenu);const searchBar=this._createSearchBar(divElementAppMenuContainer);divElementAppMenu.appendChild(searchBar.divElementSearchContainer);divElementAppMenu.appendChild(divElementAppMenuAppsContainer);const desktopShellAppMenu=new DesktopShellAppMenu(divElementAppMenuButton,divElementAppMenuContainer,divElementAppMenu,searchBar,divElementAppMenuAppsContainer,
browserSession);this._addEventListeners(desktopShellAppMenu);desktopShellAppMenu._setupWebsocketConnection(browserSession);return desktopShellAppMenu}static _createDivElementAppMenuButton(){const divElementMenuButton=document.createElement("div");divElementMenuButton.classList.add("menu-button");divElementMenuButton.classList.add("apps");return divElementMenuButton}static _createDivElementAppMenuContainer(){const divElementMenuContainer=document.createElement("div");divElementMenuContainer.classList.add("menu-container");
divElementMenuContainer.classList.add("apps");window.document.body.appendChild(divElementMenuContainer);const divElementMenuTriangleUp=document.createElement("div");divElementMenuTriangleUp.classList.add("menu-triangle-up");divElementMenuTriangleUp.classList.add("apps");divElementMenuContainer.appendChild(divElementMenuTriangleUp);return divElementMenuContainer}static _createDivElementAppMenu(){const divElementMenu=document.createElement("div");divElementMenu.classList.add("menu");divElementMenu.classList.add("apps");
return divElementMenu}static _createDivElementAppMenuAppsContainer(){const divElementAppsContainer=document.createElement("div");divElementAppsContainer.classList.add("app-menu-item-container");return divElementAppsContainer}static _createSearchBar(divElementAppMenuContainer){const divElementSearchContainer=document.createElement("div");const divElementSearchIcon=document.createElement("div");const inputElementSearchInput=document.createElement("input");inputElementSearchInput.setAttribute("type",
"text");inputElementSearchInput.setAttribute("name","search");inputElementSearchInput.setAttribute("placeholder","...");divElementSearchContainer.appendChild(divElementSearchIcon);divElementSearchContainer.appendChild(inputElementSearchInput);divElementSearchContainer.classList.add("search-container");divElementSearchIcon.classList.add("search-icon");inputElementSearchInput.classList.add("search-input");return{divElementSearchContainer:divElementSearchContainer,divElementSearchIcon:divElementSearchIcon,
inputElementSearchInput:inputElementSearchInput}}static _addEventListeners(desktopShellAppMenu){desktopShellAppMenu.divElementAppMenuButton.addEventListener("mousedown",()=>{desktopShellAppMenu.showMenu()});window.document.addEventListener("mousedown",(event)=>{if(event.target!==desktopShellAppMenu.divElementAppMenu&&event.target!==desktopShellAppMenu.divElementAppMenuButton&&event.target!==desktopShellAppMenu.searchBar.inputElementSearchInput&&event.target!==desktopShellAppMenu.searchBar.divElementSearchContainer&&
event.target!==desktopShellAppMenu.searchBar.divElementSearchIcon)desktopShellAppMenu.hideMenu()});desktopShellAppMenu.searchBar.inputElementSearchInput.addEventListener("input",()=>{const searchText=desktopShellAppMenu.searchBar.inputElementSearchInput.value;desktopShellAppMenu._desktopShellAppMenuItems.forEach((desktopShellAppMenuItem)=>{desktopShellAppMenuItem.divElementItem.classList.remove("search-match")});if(searchText)for(const desktopShellAppMenuItem of desktopShellAppMenu._desktopShellAppMenuItems){const candidateString=
`${desktopShellAppMenuItem.name}`;if(candidateString.toLowerCase().includes(searchText.toLowerCase())){desktopShellAppMenuItem.divElementItem.classList.add("search-match");desktopShellAppMenuItem.divElementItem.scrollIntoView({block:"end",behavior:"smooth"});break}}})}constructor(divElementAppMenuButton,divElementAppMenuContainer,divElementAppMenu,searchBar,divElementAppMenuAppsContainer,browserSession){this.divElementAppMenuButton=divElementAppMenuButton;this.divElementAppMenuContainer=divElementAppMenuContainer;
this.divElementAppMenu=divElementAppMenu;this.searchBar=searchBar;this.divElementAppMenuAppsContainer=divElementAppMenuAppsContainer;this._browserSession=browserSession;this._ws=null;this._desktopShellAppMenuItems=[]}_setupWebsocketConnection(browserSession){const sessionId=browserSession.sessionId;const websocketProtocol=window.location.protocol==="https:"?"wss":"ws";const url=`${websocketProtocol}://${window.location.host}/${sessionId}/apps`;const ws=new window.WebSocket(url);ws.onerror=()=>{console.error(`Apps web socket is in error.`)};
ws.onclose=(event)=>{false&&console.log(`Apps web socket is closed: ${event.code}: ${event.reason}`)};ws.onopen=()=>{false&&console.log("Apps web socket is open.");this._setupWebsocket(ws);ws.send(JSON.stringify({action:"_query",data:""}))};this._ws=ws}_setupWebsocket(ws){ws.onmessage=(event)=>{try{const message=JSON.parse(event.data);const action=message.action;this[action](message.data)}catch(error){console.trace(`Apps web socket failed to handle incoming message: $${JSON.stringify(event)}\n${event.message}\n${error.stack}`);
this._ws.close(4007,"Apps web socket received an illegal message")}}}_query(appsList){this._desktopShellAppMenuItems.forEach((desktopShellAppMenuItem)=>{if(desktopShellAppMenuItem.divElementItem.parentElement)desktopShellAppMenuItem.divElementItem.parentElement.removeChild(desktopShellAppMenuItem.divElementItem)});this._desktopShellAppMenuItems=[];appsList.forEach((appDescription)=>{const executable=appDescription.executable;const name=appDescription.name;const description=appDescription.description;
const iconPath=appDescription.icon;const iconUrl=`${window.location.protocol}/${iconPath}`;const desktopShellAppMenuItem=_DesktopShellAppMenuItem__WEBPACK_IMPORTED_MODULE_0__["default"].create(this._ws,executable,iconUrl,name,description);this._desktopShellAppMenuItems.push(desktopShellAppMenuItem);this.divElementAppMenuAppsContainer.appendChild(desktopShellAppMenuItem.divElementItem)})}showMenu(){this.divElementAppMenuContainer.addEventListener("transitionend",()=>{this.searchBar.inputElementSearchInput.classList.add("enable-default");
this.searchBar.inputElementSearchInput.focus()});this.divElementAppMenuContainer.style.visibility="visible";this.divElementAppMenu.classList.add("menu-active");this.divElementAppMenuButton.classList.add("menu-button-active")}hideMenu(){this.searchBar.inputElementSearchInput.blur();this.searchBar.inputElementSearchInput.classList.remove("enable-default");this.searchBar.inputElementSearchInput.value="";this.divElementAppMenuContainer.style.visibility="hidden";this.divElementAppMenu.classList.remove("menu-active");
this.divElementAppMenuButton.classList.remove("menu-button-active")}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",function(){return DesktopShellAppMenuItem});class DesktopShellAppMenuItem{static create(ws,executable,iconUrl,name,description){const divElementItem=this._createDivElementItem(description);const imageElementIcon=this._createImageElementIcon(iconUrl);const divElementName=this._createDivElementName(name);
divElementItem.appendChild(imageElementIcon);divElementItem.appendChild(divElementName);this._setupEventHandlers(ws,divElementItem,executable);return new DesktopShellAppMenuItem(divElementItem,name)}static _createDivElementItem(description){const divElementItem=document.createElement("div");divElementItem.setAttribute("title",description);divElementItem.classList.add("app-menu-item");return divElementItem}static _createImageElementIcon(iconUrl){const imageElementIcon=new window.Image;imageElementIcon.src=
iconUrl;return imageElementIcon}static _createDivElementName(name){const divElementName=document.createElement("div");divElementName.classList.add("name");divElementName.textContent=name;return divElementName}static _setupEventHandlers(ws,itemDiv,executable){itemDiv.addEventListener("mousedown",()=>{ws.send(JSON.stringify({action:"_launch",data:executable}))})}constructor(divElementItem,name){this.divElementItem=divElementItem;this.name=name}}}]);
